/*

 This is a generated file. DO NOT EDIT.

 Copyright (C) 2010-2014 KO GmbH <copyright@kogmbh.com>

 @licstart
 This file is the compiled version of the WebODF library.

 WebODF is free software: you can redistribute it and/or modify it
 under the terms of the GNU Affero General Public License (GNU AGPL)
 as published by the Free Software Foundation, either version 3 of
 the License, or (at your option) any later version.

 WebODF is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.

 You should have received a copy of the GNU Affero General Public License
 along with WebODF.  If not, see <http://www.gnu.org/licenses/>.
 @licend

 @source: http://www.webodf.org/
 @source: https://github.com/kogmbh/WebODF/
*/
var webodf_version="0.4.2-2481-g69672c6-dirty";function Runtime(){}Runtime.prototype.getVariable=function(f){};Runtime.prototype.toJson=function(f){};Runtime.prototype.fromJson=function(f){};Runtime.prototype.byteArrayFromString=function(f,g){};Runtime.prototype.byteArrayToString=function(f,g){};Runtime.prototype.read=function(f,g,d,c){};Runtime.prototype.readFile=function(f,g,d){};Runtime.prototype.readFileSync=function(f,g){};Runtime.prototype.loadXML=function(f,g){};Runtime.prototype.writeFile=function(f,g,d){};
Runtime.prototype.isFile=function(f,g){};Runtime.prototype.getFileSize=function(f,g){};Runtime.prototype.deleteFile=function(f,g){};Runtime.prototype.log=function(f,g){};Runtime.prototype.setTimeout=function(f,g){};Runtime.prototype.clearTimeout=function(f){};Runtime.prototype.libraryPaths=function(){};Runtime.prototype.currentDirectory=function(){};Runtime.prototype.setCurrentDirectory=function(f){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};
Runtime.prototype.parseXML=function(f){};Runtime.prototype.exit=function(f){};Runtime.prototype.getWindow=function(){};Runtime.prototype.requestAnimationFrame=function(f){};Runtime.prototype.cancelAnimationFrame=function(f){};Runtime.prototype.assert=function(f,g,d){};var IS_COMPILED_CODE=!0;
Runtime.byteArrayToString=function(f,g){function d(c){var d="",e,f=c.length;for(e=0;e<f;e+=1)d+=String.fromCharCode(c[e]&255);return d}function c(c){var d="",e,f=c.length,n=[],r,b,a,l;for(e=0;e<f;e+=1)r=c[e],128>r?n.push(r):(e+=1,b=c[e],194<=r&&224>r?n.push((r&31)<<6|b&63):(e+=1,a=c[e],224<=r&&240>r?n.push((r&15)<<12|(b&63)<<6|a&63):(e+=1,l=c[e],240<=r&&245>r&&(r=(r&7)<<18|(b&63)<<12|(a&63)<<6|l&63,r-=65536,n.push((r>>10)+55296,(r&1023)+56320))))),1E3<=n.length&&(d+=String.fromCharCode.apply(null,
n),n.length=0);return d+String.fromCharCode.apply(null,n)}var e;"utf8"===g?e=c(f):("binary"!==g&&this.log("Unsupported encoding: "+g),e=d(f));return e};Runtime.getVariable=function(f){try{return eval(f)}catch(g){}};Runtime.toJson=function(f){return JSON.stringify(f)};Runtime.fromJson=function(f){return JSON.parse(f)};Runtime.getFunctionName=function(f){return void 0===f.name?(f=/function\s+(\w+)/.exec(f))&&f[1]:f.name};
function BrowserRuntime(f){function g(c){var b=c.length,a,l,k=0;for(a=0;a<b;a+=1)l=c.charCodeAt(a),k+=1+(128<l)+(2048<l),55040<l&&57344>l&&(k+=1,a+=1);return k}function d(c,b,a){var l=c.length,k,d;b=new Uint8Array(new ArrayBuffer(b));a?(b[0]=239,b[1]=187,b[2]=191,d=3):d=0;for(a=0;a<l;a+=1)k=c.charCodeAt(a),128>k?(b[d]=k,d+=1):2048>k?(b[d]=192|k>>>6,b[d+1]=128|k&63,d+=2):55040>=k||57344<=k?(b[d]=224|k>>>12&15,b[d+1]=128|k>>>6&63,b[d+2]=128|k&63,d+=3):(a+=1,k=(k-55296<<10|c.charCodeAt(a)-56320)+65536,
b[d]=240|k>>>18&7,b[d+1]=128|k>>>12&63,b[d+2]=128|k>>>6&63,b[d+3]=128|k&63,d+=4);return b}function c(c){var b=c.length,a=new Uint8Array(new ArrayBuffer(b)),l;for(l=0;l<b;l+=1)a[l]=c.charCodeAt(l)&255;return a}function e(c,b){var a,l,k;void 0!==b?k=c:b=c;f?(l=f.ownerDocument,k&&(a=l.createElement("span"),a.className=k,a.appendChild(l.createTextNode(k)),f.appendChild(a),f.appendChild(l.createTextNode(" "))),a=l.createElement("span"),0<b.length&&"<"===b[0]?a.innerHTML=b:a.appendChild(l.createTextNode(b)),
f.appendChild(a),f.appendChild(l.createElement("br"))):console&&console.log(b);"alert"===k&&alert(b)}function m(r,b,a){if(0!==a.status||a.responseText)if(200===a.status||0===a.status){if(a.response&&"string"!==typeof a.response)"binary"===b?(a=a.response,a=new Uint8Array(a)):a=String(a.response);else if("binary"===b)if(null!==a.responseBody&&"undefined"!==String(typeof VBArray)){a=(new VBArray(a.responseBody)).toArray();var l=a.length,k=new Uint8Array(new ArrayBuffer(l));for(b=0;b<l;b+=1)k[b]=a[b];
a=k}else{(b=a.getResponseHeader("Content-Length"))&&(b=parseInt(b,10));if(b&&b!==a.responseText.length)a:{var l=a.responseText,k=!1,e=g(l);if("number"===typeof b){if(b!==e&&b!==e+3){l=void 0;break a}k=e+3===b;e=b}l=d(l,e,k)}void 0===l&&(l=c(a.responseText));a=l}else a=a.responseText;n[r]=a;r={err:null,data:a}}else r={err:a.responseText||a.statusText,data:null};else r={err:"File "+r+" is empty.",data:null};return r}function h(c,b,a){var l=new XMLHttpRequest;l.open("GET",c,a);l.overrideMimeType&&("binary"!==
b?l.overrideMimeType("text/plain; charset="+b):l.overrideMimeType("text/plain; charset=x-user-defined"));return l}function p(c,b,a){function l(){var l;4===k.readyState&&(l=m(c,b,k),a(l.err,l.data))}if(n.hasOwnProperty(c))a(null,n[c]);else{var k=h(c,b,!0);k.onreadystatechange=l;try{k.send(null)}catch(d){a(d.message,null)}}}var q=this,n={};this.byteArrayFromString=function(e,b){var a;"utf8"===b?a=d(e,g(e),!1):("binary"!==b&&q.log("unknown encoding: "+b),a=c(e));return a};this.byteArrayToString=Runtime.byteArrayToString;
this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=p;this.read=function(c,b,a,l){p(c,"binary",function(k,c){var d=null;if(c){if("string"===typeof c)throw"This should not happen.";d=c.subarray(b,b+a)}l(k,d)})};this.readFileSync=function(c,b){var a=h(c,b,!1),l;try{a.send(null);l=m(c,b,a);if(l.err)throw l.err;if(null===l.data)throw"No data read from "+c+".";}catch(k){throw k;}return l.data};this.writeFile=function(c,b,a){n[c]=b;var l=new XMLHttpRequest,
k;l.open("PUT",c,!0);l.onreadystatechange=function(){4===l.readyState&&(0!==l.status||l.responseText?200<=l.status&&300>l.status||0===l.status?a(null):a("Status "+String(l.status)+": "+l.responseText||l.statusText):a("File "+c+" is empty."))};k=b.buffer&&!l.sendAsBinary?b.buffer:q.byteArrayToString(b,"binary");try{l.sendAsBinary?l.sendAsBinary(k):l.send(k)}catch(d){q.log("HUH? "+d+" "+b),a(d.message)}};this.deleteFile=function(c,b){delete n[c];var a=new XMLHttpRequest;a.open("DELETE",c,!0);a.onreadystatechange=
function(){4===a.readyState&&(200>a.status&&300<=a.status?b(a.responseText):b(null))};a.send(null)};this.loadXML=function(c,b){var a=new XMLHttpRequest;a.open("GET",c,!0);a.overrideMimeType&&a.overrideMimeType("text/xml");a.onreadystatechange=function(){4===a.readyState&&(0!==a.status||a.responseText?200===a.status||0===a.status?b(null,a.responseXML):b(a.responseText,null):b("File "+c+" is empty.",null))};try{a.send(null)}catch(l){b(l.message,null)}};this.isFile=function(c,b){q.getFileSize(c,function(a){b(-1!==
a)})};this.getFileSize=function(c,b){if(n.hasOwnProperty(c)&&"string"!==typeof n[c])b(n[c].length);else{var a=new XMLHttpRequest;a.open("HEAD",c,!0);a.onreadystatechange=function(){if(4===a.readyState){var l=a.getResponseHeader("Content-Length");l?b(parseInt(l,10)):p(c,"binary",function(a,l){a?b(-1):b(l.length)})}};a.send(null)}};this.log=e;this.assert=function(c,b,a){if(!c)throw e("alert","ASSERTION FAILED:\n"+b),a&&a(),b;};this.setTimeout=function(c,b){return setTimeout(function(){c()},b)};this.clearTimeout=
function(c){clearTimeout(c)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.currentDirectory=function(){return""};this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};this.parseXML=function(c){return(new DOMParser).parseFromString(c,"text/xml")};this.exit=function(c){e("Calling exit with code "+String(c)+", but exit() is not implemented.")};this.getWindow=function(){return window};this.requestAnimationFrame=
function(c){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,a=0;if(b)b.bind(window),a=b(c);else return setTimeout(c,15);return a};this.cancelAnimationFrame=function(c){var b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;b?(b.bind(window),b(c)):clearTimeout(c)}}
function NodeJSRuntime(){function f(c){var d=c.length,e,b=new Uint8Array(new ArrayBuffer(d));for(e=0;e<d;e+=1)b[e]=c[e];return b}function g(d,h,p){function b(a,b){if(a)return p(a,null);if(!b)return p("No data for "+d+".",null);if("string"===typeof b)return p(a,b);p(a,f(b))}d=e.resolve(m,d);"binary"!==h?c.readFile(d,h,b):c.readFile(d,null,b)}var d=this,c=require("fs"),e=require("path"),m="",h,p;this.byteArrayFromString=function(c,d){var e=new Buffer(c,d),b,a=e.length,l=new Uint8Array(new ArrayBuffer(a));
for(b=0;b<a;b+=1)l[b]=e[b];return l};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=g;this.loadXML=function(c,e){g(c,"utf-8",function(h,b){if(h)return e(h,null);if(!b)return e("No data for "+c+".",null);e(null,d.parseXML(b))})};this.writeFile=function(d,h,f){h=new Buffer(h);d=e.resolve(m,d);c.writeFile(d,h,"binary",function(b){f(b||null)})};this.deleteFile=function(d,h){d=e.resolve(m,d);
c.unlink(d,h)};this.read=function(d,h,p,b){d=e.resolve(m,d);c.open(d,"r+",666,function(a,l){if(a)b(a,null);else{var k=new Buffer(p);c.read(l,k,0,p,h,function(a){c.close(l);b(a,f(k))})}})};this.readFileSync=function(d,e){var h;h=c.readFileSync(d,"binary"===e?null:e);if(null===h)throw"File "+d+" could not be read.";"binary"===e&&(h=f(h));return h};this.isFile=function(d,h){d=e.resolve(m,d);c.stat(d,function(c,b){h(!c&&b.isFile())})};this.getFileSize=function(d,h){d=e.resolve(m,d);c.stat(d,function(c,
b){c?h(-1):h(b.size)})};this.log=function(c,d){var e;void 0!==d?e=c:d=c;"alert"===e&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(d+"\n");"alert"===e&&process.stderr.write("!!!!! ALERT !!!!!\n")};this.assert=function(c,d,e){c||(process.stderr.write("ASSERTION FAILED: "+d),e&&e())};this.setTimeout=function(c,d){return setTimeout(function(){c()},d)};this.clearTimeout=function(c){clearTimeout(c)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(c){m=
c};this.currentDirectory=function(){return m};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return p};this.parseXML=function(c){return h.parseFromString(c,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};this.requestAnimationFrame=function(c){return setTimeout(c,15)};this.cancelAnimationFrame=function(c){clearTimeout(c)};h=new (require("xmldom").DOMParser);p=d.parseXML("<a/>").implementation}
function RhinoRuntime(){function f(c,d){var e;void 0!==d?e=c:d=c;"alert"===e&&print("\n!!!!! ALERT !!!!!");print(d);"alert"===e&&print("!!!!! ALERT !!!!!")}var g=this,d={},c=d.javax.xml.parsers.DocumentBuilderFactory.newInstance(),e,m,h="";c.setValidating(!1);c.setNamespaceAware(!0);c.setExpandEntityReferences(!1);c.setSchema(null);m=d.org.xml.sax.EntityResolver({resolveEntity:function(c,e){var h=new d.java.io.FileReader(e);return new d.org.xml.sax.InputSource(h)}});e=c.newDocumentBuilder();e.setEntityResolver(m);
this.byteArrayFromString=function(c,d){var e,h=c.length,b=new Uint8Array(new ArrayBuffer(h));for(e=0;e<h;e+=1)b[e]=c.charCodeAt(e)&255;return b};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.loadXML=function(c,h){var f=new d.java.io.File(c),g=null;try{g=e.parse(f)}catch(b){return print(b),h(b,null)}h(null,g)};this.readFile=function(c,e,f){h&&(c=h+"/"+c);var m=new d.java.io.File(c),b="binary"===e?
"latin1":e;m.isFile()?((c=readFile(c,b))&&"binary"===e&&(c=g.byteArrayFromString(c,"binary")),f(null,c)):f(c+" is not a file.",null)};this.writeFile=function(c,e,f){h&&(c=h+"/"+c);c=new d.java.io.FileOutputStream(c);var g,b=e.length;for(g=0;g<b;g+=1)c.write(e[g]);c.close();f(null)};this.deleteFile=function(c,e){h&&(c=h+"/"+c);var f=new d.java.io.File(c),g=c+Math.random(),g=new d.java.io.File(g);f.rename(g)?(g.deleteOnExit(),e(null)):e("Could not delete "+c)};this.read=function(c,e,f,g){h&&(c=h+"/"+
c);var b;b=c;var a="binary";(new d.java.io.File(b)).isFile()?("binary"===a&&(a="latin1"),b=readFile(b,a)):b=null;b?g(null,this.byteArrayFromString(b.substring(e,e+f),"binary")):g("Cannot read "+c,null)};this.readFileSync=function(c,d){if(!d)return"";var e=readFile(c,d);if(null===e)throw"File could not be read.";return e};this.isFile=function(c,e){h&&(c=h+"/"+c);var f=new d.java.io.File(c);e(f.isFile())};this.getFileSize=function(c,e){h&&(c=h+"/"+c);var f=new d.java.io.File(c);e(f.length())};this.log=
f;this.assert=function(c,d,e){c||(f("alert","ASSERTION FAILED: "+d),e&&e())};this.setTimeout=function(c){c();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(c){h=c};this.currentDirectory=function(){return h};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return e.getDOMImplementation()};this.parseXML=function(c){c=new d.java.io.StringReader(c);c=new d.org.xml.sax.InputSource(c);return e.parse(c)};
this.exit=quit;this.getWindow=function(){return null};this.requestAnimationFrame=function(c){c();return 0};this.cancelAnimationFrame=function(){}}Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime(window.document.getElementById("logoutput")):"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};
(function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"})();
(function(){function f(c,d,e){var h=c+"/manifest.json",b,a;runtime.log("Loading manifest: "+h);try{b=runtime.readFileSync(h,"utf-8")}catch(l){if(e)runtime.log("No loadable manifest found.");else throw console.log(String(l)),l;return}e=JSON.parse(b);for(a in e)e.hasOwnProperty(a)&&(d[a]={dir:c,deps:e[a]})}function g(c,d,e){function h(k){if(!l[k]&&!e(k)){if(a[k])throw"Circular dependency detected for "+k+".";a[k]=!0;if(!d[k])throw"Missing dependency information for class "+k+".";var c=d[k],f=c.deps,
g,m=f.length;for(g=0;g<m;g+=1)h(f[g]);a[k]=!1;l[k]=!0;b.push(c.dir+"/"+k.replace(".","/")+".js")}}var b=[],a={},l={};c.forEach(h);return b}function d(c,d){return d=d+("\n//# sourceURL="+c)+("\n//@ sourceURL="+c)}function c(c){var e,h;for(e=0;e<c.length;e+=1)h=runtime.readFileSync(c[e],"utf-8"),h=d(c[e],h),eval(h)}function e(c){c=c.split(".");var d,e=h,f=c.length;for(d=0;d<f;d+=1){if(!e.hasOwnProperty(c[d]))return!1;e=e[c[d]]}return!0}var m,h={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=
function(d,h){if(IS_COMPILED_CODE||0===d.length)return h&&h();var n;if(!(n=m)){n=[];var r=runtime.libraryPaths(),b;runtime.currentDirectory()&&-1===r.indexOf(runtime.currentDirectory())&&f(runtime.currentDirectory(),n,!0);for(b=0;b<r.length;b+=1)f(r[b],n)}m=n;d=g(d,m,e);if(0===d.length)return h&&h();if("BrowserRuntime"===runtime.type()&&h){n=d;r=document.currentScript||document.documentElement.lastChild;b=document.createDocumentFragment();var a,l;for(l=0;l<n.length;l+=1)a=document.createElement("script"),
a.type="text/javascript",a.charset="utf-8",a.async=!1,a.setAttribute("src",n[l]),b.appendChild(a);h&&(a.onload=h);r.parentNode.insertBefore(b,r)}else c(d),h&&h()};runtime.loadClass=function(c,d){runtime.loadClasses([c],d)}})();(function(){var f=function(f){return f};runtime.getTranslator=function(){return f};runtime.setTranslator=function(g){f=g};runtime.tr=function(g){var d=f(g);return d&&"string"===String(typeof d)?d:g}})();
(function(f){function g(d){if(d.length){var c=d[0];runtime.readFile(c,"utf8",function(e,f){function h(){var c;(c=eval(q))&&runtime.exit(c)}var g="",g=c.lastIndexOf("/"),q=f,g=-1!==g?c.substring(0,g):".";runtime.setCurrentDirectory(g);e?(runtime.log(e),runtime.exit(1)):null===q?(runtime.log("No code found for "+c),runtime.exit(1)):h.apply(null,d)})}}f=f?Array.prototype.slice.call(f):[];"NodeJSRuntime"===runtime.type()?g(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?g(f):g(f.slice(1))})("undefined"!==
String(typeof arguments)&&arguments);(function(){core.Async=function(){return{forEach:function(f,g,d){function c(c){h!==m&&(c?(h=m,d(c)):(h+=1,h===m&&d(null)))}var e,m=f.length,h=0;for(e=0;e<m;e+=1)g(f[e],c)},destroyAll:function(f,g){function d(c,e){if(e)g(e);else if(c<f.length)f[c](function(e){d(c+1,e)});else g()}d(0,void 0)}}}()})();function makeBase64(){function f(a){var b,l=a.length,k=new Uint8Array(new ArrayBuffer(l));for(b=0;b<l;b+=1)k[b]=a.charCodeAt(b)&255;return k}function g(a){var b,l="",k,c=a.length-2;for(k=0;k<c;k+=3)b=a[k]<<16|a[k+1]<<8|a[k+2],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>18],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>12&63],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>6&63],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b&
63];k===c+1?(b=a[k]<<4,l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>6],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b&63],l+="=="):k===c&&(b=a[k]<<10|a[k+1]<<2,l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>12],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>6&63],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b&63],l+="=");return l}function d(a){a=a.replace(/[^A-Za-z0-9+\/]+/g,
"");var b=a.length,l=new Uint8Array(new ArrayBuffer(3*b)),c=a.length%4,d=0,e,h;for(e=0;e<b;e+=4)h=(k[a.charAt(e)]||0)<<18|(k[a.charAt(e+1)]||0)<<12|(k[a.charAt(e+2)]||0)<<6|(k[a.charAt(e+3)]||0),l[d]=h>>16,l[d+1]=h>>8&255,l[d+2]=h&255,d+=3;b=3*b-[0,0,2,1][c];return l.subarray(0,b)}function c(a){var b,l,k=a.length,c=0,d=new Uint8Array(new ArrayBuffer(3*k));for(b=0;b<k;b+=1)l=a[b],128>l?d[c++]=l:(2048>l?d[c++]=192|l>>>6:(d[c++]=224|l>>>12&15,d[c++]=128|l>>>6&63),d[c++]=128|l&63);return d.subarray(0,
c)}function e(a){var b,l,k,c,d=a.length,e=new Uint8Array(new ArrayBuffer(d)),h=0;for(b=0;b<d;b+=1)l=a[b],128>l?e[h++]=l:(b+=1,k=a[b],224>l?e[h++]=(l&31)<<6|k&63:(b+=1,c=a[b],e[h++]=(l&15)<<12|(k&63)<<6|c&63));return e.subarray(0,h)}function m(a){return g(f(a))}function h(a){return String.fromCharCode.apply(String,d(a))}function p(a){return e(f(a))}function q(a){a=e(a);for(var b="",l=0;l<a.length;)b+=String.fromCharCode.apply(String,a.subarray(l,l+45E3)),l+=45E3;return b}function n(a,b,l){var k,c,
d,e="";for(d=b;d<l;d+=1)b=a.charCodeAt(d)&255,128>b?e+=String.fromCharCode(b):(d+=1,k=a.charCodeAt(d)&255,224>b?e+=String.fromCharCode((b&31)<<6|k&63):(d+=1,c=a.charCodeAt(d)&255,e+=String.fromCharCode((b&15)<<12|(k&63)<<6|c&63)));return e}function r(a,b){function l(){var d=c+1E5;d>a.length&&(d=a.length);k+=n(a,c,d);c=d;d=c===a.length;b(k,d)&&!d&&runtime.setTimeout(l,0)}var k="",c=0;1E5>a.length?b(n(a,0,a.length),!0):("string"!==typeof a&&(a=a.slice()),l())}function b(a){return c(f(a))}function a(a){return String.fromCharCode.apply(String,
c(a))}function l(a){return String.fromCharCode.apply(String,c(f(a)))}var k=function(a){var b={},l,k;l=0;for(k=a.length;l<k;l+=1)b[a.charAt(l)]=l;return b}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),t,s,w=runtime.getWindow(),x,v;w&&w.btoa?(x=w.btoa,t=function(a){return x(l(a))}):(x=m,t=function(a){return g(b(a))});w&&w.atob?(v=w.atob,s=function(a){a=v(a);return n(a,0,a.length)}):(v=h,s=function(a){return q(d(a))});core.Base64=function(){this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=
g;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=d;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=c;this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=e;this.convertUTF8StringToBase64=m;this.convertBase64ToUTF8String=h;this.convertUTF8StringToUTF16Array=p;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=q;this.convertUTF8StringToUTF16String=r;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=b;this.convertUTF16ArrayToUTF8String=
a;this.convertUTF16StringToUTF8String=l;this.convertUTF16StringToBase64=t;this.convertBase64ToUTF16String=s;this.fromBase64=h;this.toBase64=m;this.atob=v;this.btoa=x;this.utob=l;this.btou=r;this.encode=t;this.encodeURI=function(a){return t(a).replace(/[+\/]/g,function(a){return"+"===a?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(a){return s(a.replace(/[\-_]/g,function(a){return"-"===a?"+":"/"}))};return this};return core.Base64}core.Base64=makeBase64();core.ByteArray=function(f){this.pos=0;this.data=f;this.readUInt32LE=function(){this.pos+=4;var f=this.data,d=this.pos;return f[--d]<<24|f[--d]<<16|f[--d]<<8|f[--d]};this.readUInt16LE=function(){this.pos+=2;var f=this.data,d=this.pos;return f[--d]<<8|f[--d]}};core.ByteArrayWriter=function(f){function g(d){d>e-c&&(e=Math.max(2*e,c+d),d=new Uint8Array(new ArrayBuffer(e)),d.set(m),m=d)}var d=this,c=0,e=1024,m=new Uint8Array(new ArrayBuffer(e));this.appendByteArrayWriter=function(c){d.appendByteArray(c.getByteArray())};this.appendByteArray=function(d){var e=d.length;g(e);m.set(d,c);c+=e};this.appendArray=function(d){var e=d.length;g(e);m.set(d,c);c+=e};this.appendUInt16LE=function(c){d.appendArray([c&255,c>>8&255])};this.appendUInt32LE=function(c){d.appendArray([c&
255,c>>8&255,c>>16&255,c>>24&255])};this.appendString=function(c){d.appendByteArray(runtime.byteArrayFromString(c,f))};this.getLength=function(){return c};this.getByteArray=function(){var d=new Uint8Array(new ArrayBuffer(c));d.set(m.subarray(0,c));return d}};core.CSSUnits=function(){var f=this,g={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(d,c,e){return d*g[e]/g[c]};this.convertMeasure=function(d,c){var e,g;d&&c&&(e=parseFloat(d),g=d.replace(e.toString(),""),e=f.convert(e,g,c));return e};this.getUnits=function(d){return d.substr(d.length-2,d.length)}};(function(){function f(){var c,e,f,h,g,q,n,r,b;void 0===d&&(e=(c=runtime.getWindow())&&c.document,q=e.documentElement,n=e.body,d={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},e&&(h=e.createElement("div"),h.style.position="absolute",h.style.left="-99999px",h.style.transform="scale(2)",h.style["-webkit-transform"]="scale(2)",g=e.createElement("div"),h.appendChild(g),n.appendChild(h),c=e.createRange(),c.selectNode(g),d.rangeBCRIgnoresElementBCR=0===c.getClientRects().length,
g.appendChild(e.createTextNode("Rect transform test")),e=g.getBoundingClientRect(),f=c.getBoundingClientRect(),d.unscaledRangeClientRects=2<Math.abs(e.height-f.height),h.style.transform="",h.style["-webkit-transform"]="",e=q.style.overflow,f=n.style.overflow,r=n.style.height,b=n.scrollTop,q.style.overflow="visible",n.style.overflow="visible",n.style.height="200%",n.scrollTop=n.scrollHeight,d.elementBCRIgnoresBodyScroll=c.getBoundingClientRect().top!==g.getBoundingClientRect().top,n.scrollTop=b,n.style.height=
r,n.style.overflow=f,q.style.overflow=e,c.detach(),n.removeChild(h),c=Object.keys(d).map(function(a){return a+":"+String(d[a])}).join(", "),runtime.log("Detected browser quirks - "+c)));return d}function g(c,d,f){for(c=c?c.firstElementChild:null;c;){if(c.localName===f&&c.namespaceURI===d)return c;c=c.nextElementSibling}return null}var d;core.DomUtils=function(){function c(a,b){for(var c=0,d;a.parentNode!==b;)runtime.assert(null!==a.parentNode,"parent is null"),a=a.parentNode;for(d=b.firstChild;d!==
a;)c+=1,d=d.nextSibling;return c}function d(a,b){return 0>=a.compareBoundaryPoints(Range.START_TO_START,b)&&0<=a.compareBoundaryPoints(Range.END_TO_END,b)}function m(a,b){return 0>=a.compareBoundaryPoints(Range.END_TO_START,b)&&0<=a.compareBoundaryPoints(Range.START_TO_END,b)}function h(a,b){var c=null;a.nodeType===Node.TEXT_NODE&&(0===a.length?(a.parentNode.removeChild(a),b.nodeType===Node.TEXT_NODE&&(c=b)):(b.nodeType===Node.TEXT_NODE&&(a.appendData(b.data),b.parentNode.removeChild(b)),c=a));return c}
function p(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);b.removeChild(a);return b}function q(a,b){for(var c=a.parentNode,d=a.firstChild,e;d;)e=d.nextSibling,q(d,b),d=e;c&&b(a)&&p(a);return c}function n(a,b){return a===b||Boolean(a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function r(a,b){return f().unscaledRangeClientRects?a:a/b}function b(a,k,c){Object.keys(k).forEach(function(d){var e=d.split(":"),h=e[1],f=c(e[0]),e=k[d],g=typeof e;"object"===g?Object.keys(e).length&&
(d=f?a.getElementsByTagNameNS(f,h)[0]||a.ownerDocument.createElementNS(f,d):a.getElementsByTagName(h)[0]||a.ownerDocument.createElement(d),a.appendChild(d),b(d,e,c)):f&&(runtime.assert("number"===g||"string"===g,"attempting to map unsupported type '"+g+"' (key: "+d+")"),a.setAttributeNS(f,d,String(e)))})}var a=null;this.splitBoundaries=function(a){var b,d=[],e,h,f;if(a.startContainer.nodeType===Node.TEXT_NODE||a.endContainer.nodeType===Node.TEXT_NODE){e=a.endContainer;h=a.endContainer.nodeType!==
Node.TEXT_NODE?a.endOffset===a.endContainer.childNodes.length:!1;f=a.endOffset;b=a.endContainer;if(f<b.childNodes.length)for(b=b.childNodes.item(f),f=0;b.firstChild;)b=b.firstChild;else for(;b.lastChild;)b=b.lastChild,f=b.nodeType===Node.TEXT_NODE?b.textContent.length:b.childNodes.length;b===e&&(e=null);a.setEnd(b,f);f=a.endContainer;0!==a.endOffset&&f.nodeType===Node.TEXT_NODE&&(b=f,a.endOffset!==b.length&&(d.push(b.splitText(a.endOffset)),d.push(b)));f=a.startContainer;0!==a.startOffset&&f.nodeType===
Node.TEXT_NODE&&(b=f,a.startOffset!==b.length&&(f=b.splitText(a.startOffset),d.push(b),d.push(f),a.setStart(f,0)));if(null!==e){for(f=a.endContainer;f.parentNode&&f.parentNode!==e;)f=f.parentNode;h=h?e.childNodes.length:c(f,e);a.setEnd(e,h)}}return d};this.containsRange=d;this.rangesIntersect=m;this.rangeIntersection=function(a,b){var c;m(a,b)&&(c=a.cloneRange(),-1===a.compareBoundaryPoints(Range.START_TO_START,b)&&c.setStart(b.startContainer,b.startOffset),1===a.compareBoundaryPoints(Range.END_TO_END,
b)&&c.setEnd(b.endContainer,b.endOffset));return c};this.getNodesInRange=function(a,b,c){var d=[],e=a.commonAncestorContainer,e=e.nodeType===Node.TEXT_NODE?e.parentNode:e;c=a.startContainer.ownerDocument.createTreeWalker(e,c,b,!1);var f,h;a.endContainer.childNodes[a.endOffset-1]?(f=a.endContainer.childNodes[a.endOffset-1],h=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(f=a.endContainer,h=Node.DOCUMENT_POSITION_PRECEDING);a.startContainer.childNodes[a.startOffset]?(a=a.startContainer.childNodes[a.startOffset],
c.currentNode=a):a.startOffset===(a.startContainer.nodeType===Node.TEXT_NODE?a.startContainer.length:a.startContainer.childNodes.length)?(a=a.startContainer,c.currentNode=a,c.lastChild(),a=c.nextNode()):(a=a.startContainer,c.currentNode=a);if(a){a=c.currentNode;if(a!==e)for(a=a.parentNode;a&&a!==e;)b(a)===NodeFilter.FILTER_REJECT&&(c.currentNode=a),a=a.parentNode;a=c.currentNode;switch(b(a)){case NodeFilter.FILTER_REJECT:for(a=c.nextSibling();!a&&c.parentNode();)a=c.nextSibling();break;case NodeFilter.FILTER_SKIP:a=
c.nextNode()}for(;a;){b=f.compareDocumentPosition(a);if(0!==b&&0===(b&h))break;d.push(a);a=c.nextNode()}}return d};this.normalizeTextNodes=function(a){a&&a.nextSibling&&(a=h(a,a.nextSibling));a&&a.previousSibling&&h(a.previousSibling,a)};this.rangeContainsNode=function(a,b){var c=b.ownerDocument.createRange(),f=b.ownerDocument.createRange(),h;c.setStart(a.startContainer,a.startOffset);c.setEnd(a.endContainer,a.endOffset);f.selectNodeContents(b);h=d(c,f);c.detach();f.detach();return h};this.mergeIntoParent=
p;this.removeUnwantedNodes=q;this.getElementsByTagNameNS=function(a,b,c){var d=[];a=a.getElementsByTagNameNS(b,c);d.length=c=a.length;for(b=0;b<c;b+=1)d[b]=a.item(b);return d};this.getElementsByTagName=function(a,b){var c=[],d,e,f;d=a.getElementsByTagName(b);c.length=f=d.length;for(e=0;e<f;e+=1)c[e]=d.item(e);return c};this.containsNode=function(a,b){return a===b||a.contains(b)};this.comparePoints=function(a,b,d,e){if(a===d)return e-b;var f=a.compareDocumentPosition(d);2===f?f=-1:4===f?f=1:10===f?
(b=c(a,d),f=b<e?1:-1):(e=c(d,a),f=e<b?-1:1);return f};this.adaptRangeDifferenceToZoomLevel=r;this.translateRect=function(a,b,c){return{top:r(a.top-b.top,c),left:r(a.left-b.left,c),bottom:r(a.bottom-b.top,c),right:r(a.right-b.left,c),width:r(a.width,c),height:r(a.height,c)}};this.getBoundingClientRect=function(b){var c=b.ownerDocument,d=f(),e=c.body;if((!1===d.unscaledRangeClientRects||d.rangeBCRIgnoresElementBCR)&&b.nodeType===Node.ELEMENT_NODE)return b=b.getBoundingClientRect(),d.elementBCRIgnoresBodyScroll?
{left:b.left+e.scrollLeft,right:b.right+e.scrollLeft,top:b.top+e.scrollTop,bottom:b.bottom+e.scrollTop,width:b.width,height:b.height}:b;var h;a?h=a:a=h=c.createRange();d=h;d.selectNode(b);return d.getBoundingClientRect()};this.mapKeyValObjOntoNode=function(a,b,c){Object.keys(b).forEach(function(d){var e=d.split(":"),f=e[1],e=c(e[0]),h=b[d];e?(f=a.getElementsByTagNameNS(e,f)[0],f||(f=a.ownerDocument.createElementNS(e,d),a.appendChild(f)),f.textContent=h):runtime.log("Key ignored: "+d)})};this.removeKeyElementsFromNode=
function(a,b,c){b.forEach(function(b){var d=b.split(":"),k=d[1];(d=c(d[0]))?(k=a.getElementsByTagNameNS(d,k)[0])?k.parentNode.removeChild(k):runtime.log("Element for "+b+" not found."):runtime.log("Property Name ignored: "+b)})};this.getKeyValRepresentationOfNode=function(a,b){for(var c={},d=a.firstElementChild,e;d;){if(e=b(d.namespaceURI))c[e+":"+d.localName]=d.textContent;d=d.nextElementSibling}return c};this.mapObjOntoNode=b;this.getDirectChild=g;(function(a){var b,c;c=runtime.getWindow();null!==
c&&(b=c.navigator.appVersion.toLowerCase(),c=-1===b.indexOf("chrome")&&(-1!==b.indexOf("applewebkit")||-1!==b.indexOf("safari")),b=b.indexOf("msie"),c||b)&&(a.containsNode=n)})(this)}})();core.Cursor=function(f,g){function d(b){b.parentNode&&(p.push(b.previousSibling),p.push(b.nextSibling),b.parentNode.removeChild(b))}function c(b,a,c){if(a.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(a),"putCursorIntoTextNode: invalid container");var d=a.parentNode;runtime.assert(Boolean(d),"putCursorIntoTextNode: container without parent");runtime.assert(0<=c&&c<=a.length,"putCursorIntoTextNode: offset is out of bounds");0===c?d.insertBefore(b,a):(c!==a.length&&a.splitText(c),d.insertBefore(b,
a.nextSibling))}else a.nodeType===Node.ELEMENT_NODE&&a.insertBefore(b,a.childNodes.item(c));p.push(b.previousSibling);p.push(b.nextSibling)}var e=f.createElementNS("urn:webodf:names:cursor","cursor"),m=f.createElementNS("urn:webodf:names:cursor","anchor"),h,p=[],q=f.createRange(),n,r=new core.DomUtils;this.getNode=function(){return e};this.getAnchorNode=function(){return m.parentNode?m:e};this.getSelectedRange=function(){n?(q.setStartBefore(e),q.collapse(!0)):(q.setStartAfter(h?m:e),q.setEndBefore(h?
e:m));return q};this.setSelectedRange=function(b,a){q&&q!==b&&q.detach();q=b;h=!1!==a;(n=b.collapsed)?(d(m),d(e),c(e,b.startContainer,b.startOffset)):(d(m),d(e),c(h?e:m,b.endContainer,b.endOffset),c(h?m:e,b.startContainer,b.startOffset));p.forEach(r.normalizeTextNodes);p.length=0};this.hasForwardSelection=function(){return h};this.remove=function(){d(e);p.forEach(r.normalizeTextNodes);p.length=0};e.setAttributeNS("urn:webodf:names:cursor","memberId",g);m.setAttributeNS("urn:webodf:names:cursor","memberId",
g)};core.Destroyable=function(){};core.Destroyable.prototype.destroy=function(f){};core.EventNotifier=function(f){function g(c){runtime.assert(!d.hasOwnProperty(c),'Duplicated event ids: "'+c+'" registered more than once.');d[c]=[]}var d={};this.emit=function(c,e){var f,h;runtime.assert(d.hasOwnProperty(c),'unknown event fired "'+c+'"');h=d[c];for(f=0;f<h.length;f+=1)h[f](e)};this.subscribe=function(c,e){runtime.assert(d.hasOwnProperty(c),'tried to subscribe to unknown event "'+c+'"');d[c].push(e)};this.unsubscribe=function(c,e){var f;runtime.assert(d.hasOwnProperty(c),'tried to unsubscribe from unknown event "'+
c+'"');f=d[c].indexOf(e);runtime.assert(-1!==f,'tried to unsubscribe unknown callback from event "'+c+'"');-1!==f&&d[c].splice(f,1)};this.register=g;f&&f.forEach(g)};core.LazyProperty=function(f){var g,d=!1;this.value=function(){d||(g=f(),d=!0);return g};this.reset=function(){d=!1}};core.LoopWatchDog=function(f,g){var d=Date.now(),c=0;this.check=function(){var e;if(f&&(e=Date.now(),e-d>f))throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<g&&(c+=1,c>g))throw runtime.log("alert","watchdog loop overflow"),"loop overflow";}};core.PositionIterator=function(f,g,d,c){function e(){this.acceptNode=function(a){return!a||a.nodeType===l&&0===a.length?s:t}}function m(a){this.acceptNode=function(b){return!b||b.nodeType===l&&0===b.length?s:a.acceptNode(b)}}function h(){var a=r.currentNode,c=a.nodeType;b=c===l?a.length-1:c===k?1:0}function p(){if(null===r.previousSibling()){if(!r.parentNode()||r.currentNode===f)return r.firstChild(),!1;b=0}else h();return!0}function q(){var c=r.currentNode,d;d=a(c);if(c!==f)for(c=c.parentNode;c&&
c!==f;)a(c)===s&&(r.currentNode=c,d=s),c=c.parentNode;d===s?(b=1,c=n.nextPosition()):c=d===t?!0:n.nextPosition();c&&runtime.assert(a(r.currentNode)===t,"moveToAcceptedNode did not result in walker being on an accepted node");return c}var n=this,r,b,a,l=Node.TEXT_NODE,k=Node.ELEMENT_NODE,t=NodeFilter.FILTER_ACCEPT,s=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var a=r.currentNode,c=a.nodeType;if(a===f)return!1;if(0===b&&c===k)null===r.firstChild()&&(b=1);else if(c===l&&b+1<a.length)b+=1;else if(null!==
r.nextSibling())b=0;else if(r.parentNode())b=1;else return!1;return!0};this.previousPosition=function(){var a=!0,c=r.currentNode;0===b?a=p():c.nodeType===l?b-=1:null!==r.lastChild()?h():c===f?a=!1:b=0;return a};this.previousNode=p;this.container=function(){var a=r.currentNode,c=a.nodeType;0===b&&c!==l&&(a=a.parentNode);return a};this.rightNode=function(){var c=r.currentNode,d=c.nodeType;if(d===l&&b===c.length)for(c=c.nextSibling;c&&a(c)!==t;)c=c.nextSibling;else d===k&&1===b&&(c=null);return c};this.leftNode=
function(){var c=r.currentNode;if(0===b)for(c=c.previousSibling;c&&a(c)!==t;)c=c.previousSibling;else if(c.nodeType===k)for(c=c.lastChild;c&&a(c)!==t;)c=c.previousSibling;return c};this.getCurrentNode=function(){return r.currentNode};this.unfilteredDomOffset=function(){if(r.currentNode.nodeType===l)return b;for(var a=0,c=r.currentNode,c=1===b?c.lastChild:c.previousSibling;c;)a+=1,c=c.previousSibling;return a};this.getPreviousSibling=function(){var a=r.currentNode,b=r.previousSibling();r.currentNode=
a;return b};this.getNextSibling=function(){var a=r.currentNode,b=r.nextSibling();r.currentNode=a;return b};this.setPositionBeforeElement=function(a){runtime.assert(Boolean(a),"setPositionBeforeElement called without element");r.currentNode=a;b=0;return q()};this.setUnfilteredPosition=function(a,c){runtime.assert(Boolean(a),"PositionIterator.setUnfilteredPosition called without container");r.currentNode=a;if(a.nodeType===l)return b=c,runtime.assert(c<=a.length,"Error in setPosition: "+c+" > "+a.length),
runtime.assert(0<=c,"Error in setPosition: "+c+" < 0"),c===a.length&&(r.nextSibling()?b=0:r.parentNode()?b=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid.")),!0;c<a.childNodes.length?(r.currentNode=a.childNodes.item(c),b=0):b=1;return q()};this.moveToEnd=function(){r.currentNode=f;b=1};this.moveToEndOfNode=function(a){a.nodeType===l?n.setUnfilteredPosition(a,a.length):(r.currentNode=a,b=1)};this.isBeforeNode=function(){return 0===b};this.getNodeFilter=function(){return a};
a=(d?new m(d):new e).acceptNode;a.acceptNode=a;g=g||NodeFilter.SHOW_ALL;runtime.assert(f.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes");r=f.ownerDocument.createTreeWalker(f,g,a,c);b=0;null===r.firstChild()&&(b=1)};core.PositionFilter=function(){};core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};core.PositionFilter.prototype.acceptPosition=function(f){};core.PositionFilterChain=function(){var f=[],g=core.PositionFilter.FilterResult.FILTER_ACCEPT,d=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(c){var e;for(e=0;e<f.length;e+=1)if(f[e].acceptPosition(c)===d)return d;return g};this.addFilter=function(c){f.push(c)}};core.zip_HuftNode=function(){this.n=this.b=this.e=0;this.t=null};core.zip_HuftList=function(){this.list=this.next=null};
core.RawInflate=function(){function f(a,b,c,d,k,l){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;var e=Array(this.BMAX+1),f,h,g,m,r,A,n,t=Array(this.BMAX+1),p,U,J,q=new core.zip_HuftNode,s=Array(this.BMAX);m=Array(this.N_MAX);var K,u=Array(this.BMAX+1),W,H,w;w=this.root=null;for(r=0;r<e.length;r++)e[r]=0;for(r=0;r<t.length;r++)t[r]=0;for(r=0;r<s.length;r++)s[r]=null;for(r=0;r<m.length;r++)m[r]=0;for(r=0;r<u.length;r++)u[r]=0;f=256<b?a[256]:this.BMAX;p=a;U=0;r=b;do e[p[U]]++,U++;
while(0<--r);if(e[0]===b)this.root=null,this.status=this.m=0;else{for(A=1;A<=this.BMAX&&0===e[A];A++);n=A;l<A&&(l=A);for(r=this.BMAX;0!==r&&0===e[r];r--);g=r;l>r&&(l=r);for(W=1<<A;A<r;A++,W<<=1)if(W-=e[A],0>W){this.status=2;this.m=l;return}W-=e[r];if(0>W)this.status=2,this.m=l;else{e[r]+=W;u[1]=A=0;p=e;U=1;for(J=2;0<--r;)A+=p[U++],u[J++]=A;p=a;r=U=0;do A=p[U++],0!==A&&(m[u[A]++]=r);while(++r<b);b=u[g];u[0]=r=0;p=m;U=0;m=-1;K=t[0]=0;J=null;H=0;for(n=n-1+1;n<=g;n++)for(a=e[n];0<a--;){for(;n>K+t[1+m];){K+=
t[1+m];m++;H=g-K;H=H>l?l:H;A=n-K;h=1<<A;if(h>a+1)for(h-=a+1,J=n;++A<H;){h<<=1;if(h<=e[++J])break;h-=e[J]}K+A>f&&K<f&&(A=f-K);H=1<<A;t[1+m]=A;J=Array(H);for(h=0;h<H;h++)J[h]=new core.zip_HuftNode;w=null===w?this.root=new core.zip_HuftList:w.next=new core.zip_HuftList;w.next=null;w.list=J;s[m]=J;0<m&&(u[m]=r,q.b=t[m],q.e=16+A,q.t=J,A=(r&(1<<K)-1)>>K-t[m],s[m-1][A].e=q.e,s[m-1][A].b=q.b,s[m-1][A].n=q.n,s[m-1][A].t=q.t)}q.b=n-K;U>=b?q.e=99:p[U]<c?(q.e=256>p[U]?16:15,q.n=p[U++]):(q.e=k[p[U]-c],q.n=d[p[U++]-
c]);h=1<<n-K;for(A=r>>K;A<H;A+=h)J[A].e=q.e,J[A].b=q.b,J[A].n=q.n,J[A].t=q.t;for(A=1<<n-1;0!==(r&A);A>>=1)r^=A;for(r^=A;(r&(1<<K)-1)!==u[m];)K-=t[m],m--}this.m=t[1];this.status=0!==W&&1!==g?1:0}}}function g(c){for(;a<c;){var d=b,k;k=u.length===C?-1:u[C++];b=d|k<<a;a+=8}}function d(a){return b&I[a]}function c(c){b>>=c;a-=c}function e(a,b,k){var e,f,r;if(0===k)return 0;for(r=0;;){g(v);f=w.list[d(v)];for(e=f.e;16<e;){if(99===e)return-1;c(f.b);e-=16;g(e);f=f.t[d(e)];e=f.e}c(f.b);if(16===e)p&=32767,a[b+
r++]=h[p++]=f.n;else{if(15===e)break;g(e);t=f.n+d(e);c(e);g(z);f=x.list[d(z)];for(e=f.e;16<e;){if(99===e)return-1;c(f.b);e-=16;g(e);f=f.t[d(e)];e=f.e}c(f.b);g(e);s=p-f.n-d(e);for(c(e);0<t&&r<k;)t--,s&=32767,p&=32767,a[b+r++]=h[p++]=h[s++]}if(r===k)return k}l=-1;return r}function m(a,b,k){var l,h,r,m,n,t,p,q=Array(316);for(l=0;l<q.length;l++)q[l]=0;g(5);t=257+d(5);c(5);g(5);p=1+d(5);c(5);g(4);l=4+d(4);c(4);if(286<t||30<p)return-1;for(h=0;h<l;h++)g(3),q[U[h]]=d(3),c(3);for(h=l;19>h;h++)q[U[h]]=0;v=
7;h=new f(q,19,19,null,null,v);if(0!==h.status)return-1;w=h.root;v=h.m;m=t+p;for(l=r=0;l<m;)if(g(v),n=w.list[d(v)],h=n.b,c(h),h=n.n,16>h)q[l++]=r=h;else if(16===h){g(2);h=3+d(2);c(2);if(l+h>m)return-1;for(;0<h--;)q[l++]=r}else{17===h?(g(3),h=3+d(3),c(3)):(g(7),h=11+d(7),c(7));if(l+h>m)return-1;for(;0<h--;)q[l++]=0;r=0}v=9;h=new f(q,t,257,A,K,v);0===v&&(h.status=1);if(0!==h.status)return-1;w=h.root;v=h.m;for(l=0;l<p;l++)q[l]=q[l+t];z=6;h=new f(q,p,0,J,H,z);x=h.root;z=h.m;return 0===z&&257<t||0!==h.status?
-1:e(a,b,k)}var h=[],p,q=null,n,r,b,a,l,k,t,s,w,x,v,z,u,C,I=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],A=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],K=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],J=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],U=[16,17,18,0,8,7,9,6,
10,5,11,4,12,3,13,2,14,1,15],W;this.inflate=function(U,I){h.length=65536;a=b=p=0;l=-1;k=!1;t=s=0;w=null;u=U;C=0;var O=new Uint8Array(new ArrayBuffer(I));a:for(var B=0,X;B<I&&(!k||-1!==l);){if(0<t){if(0!==l)for(;0<t&&B<I;)t--,s&=32767,p&=32767,O[0+B]=h[p]=h[s],B+=1,p+=1,s+=1;else{for(;0<t&&B<I;)t-=1,p&=32767,g(8),O[0+B]=h[p]=d(8),B+=1,p+=1,c(8);0===t&&(l=-1)}if(B===I)break}if(-1===l){if(k)break;g(1);0!==d(1)&&(k=!0);c(1);g(2);l=d(2);c(2);w=null;t=0}switch(l){case 0:X=O;var fa=0+B,ha=I-B,Z=void 0,Z=
a&7;c(Z);g(16);Z=d(16);c(16);g(16);if(Z!==(~b&65535))X=-1;else{c(16);t=Z;for(Z=0;0<t&&Z<ha;)t--,p&=32767,g(8),X[fa+Z++]=h[p++]=d(8),c(8);0===t&&(l=-1);X=Z}break;case 1:if(null!==w)X=e(O,0+B,I-B);else b:{X=O;fa=0+B;ha=I-B;if(null===q){for(var D=void 0,Z=Array(288),D=void 0,D=0;144>D;D++)Z[D]=8;for(D=144;256>D;D++)Z[D]=9;for(D=256;280>D;D++)Z[D]=7;for(D=280;288>D;D++)Z[D]=8;r=7;D=new f(Z,288,257,A,K,r);if(0!==D.status){alert("HufBuild error: "+D.status);X=-1;break b}q=D.root;r=D.m;for(D=0;30>D;D++)Z[D]=
5;W=5;D=new f(Z,30,0,J,H,W);if(1<D.status){q=null;alert("HufBuild error: "+D.status);X=-1;break b}n=D.root;W=D.m}w=q;x=n;v=r;z=W;X=e(X,fa,ha)}break;case 2:X=null!==w?e(O,0+B,I-B):m(O,0+B,I-B);break;default:X=-1}if(-1===X)break a;B+=X}u=new Uint8Array(new ArrayBuffer(0));return O}};core.ScheduledTask=function(f,g,d){function c(){h&&(d(m),h=!1)}function e(){c();f.apply(void 0,p);p=null}var m,h=!1,p=[],q=!1;this.trigger=function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");p=Array.prototype.slice.call(arguments);h||(h=!0,m=g(e))};this.triggerImmediate=function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");p=Array.prototype.slice.call(arguments);e()};this.processRequests=function(){h&&e()};this.cancel=c;this.destroy=function(d){c();
q=!0;d()}};core.StepDirection={PREVIOUS:1,NEXT:2};core.StepIterator=function(f,g){function d(){r=null;a=b=void 0}function c(){void 0===a&&(a=f.acceptPosition(g)===n);return a}function e(a,b){d();return g.setUnfilteredPosition(a,b)}function m(){r||(r=g.container());return r}function h(){void 0===b&&(b=g.unfilteredDomOffset());return b}function p(){for(d();g.nextPosition();)if(d(),c())return!0;return!1}function q(){for(d();g.previousPosition();)if(d(),c())return!0;return!1}var n=core.PositionFilter.FilterResult.FILTER_ACCEPT,r,b,a;this.isStep=c;this.setPosition=
e;this.container=m;this.offset=h;this.nextStep=p;this.previousStep=q;this.advanceStep=function(a){return a===core.StepDirection.NEXT?p():q()};this.roundToClosestStep=function(){var a,b,d=c();d||(a=m(),b=h(),d=q(),d||(e(a,b),d=p()));return d};this.roundToPreviousStep=function(){var a=c();a||(a=q());return a};this.roundToNextStep=function(){var a=c();a||(a=p());return a};this.leftNode=function(){return g.leftNode()}};(function(){var f;core.Task={};core.Task.SUPPRESS_MANUAL_PROCESSING=!1;core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||f.performRedraw()};core.Task.createRedrawTask=function(g){return new core.ScheduledTask(g,f.requestRedrawTask,f.cancelRedrawTask)};core.Task.createTimeoutTask=function(f,d){return new core.ScheduledTask(f,function(c){return runtime.setTimeout(c,d)},runtime.clearTimeout)};f=new function(){var f={};this.requestRedrawTask=function(d){var c=runtime.requestAnimationFrame(function(){d();
delete f[c]});f[c]=d;return c};this.performRedraw=function(){Object.keys(f).forEach(function(d){f[d]();runtime.cancelAnimationFrame(parseInt(d,10))});f={}};this.cancelRedrawTask=function(d){runtime.cancelAnimationFrame(d);delete f[d]}}})();core.UnitTest=function(){};core.UnitTest.prototype.setUp=function(){};core.UnitTest.prototype.tearDown=function(){};core.UnitTest.prototype.description=function(){};core.UnitTest.prototype.tests=function(){};core.UnitTest.prototype.asyncTests=function(){};
core.UnitTest.provideTestAreaDiv=function(){var f=runtime.getWindow().document,g=f.getElementById("testarea");runtime.assert(!g,'Unclean test environment, found a div with id "testarea".');g=f.createElement("div");g.setAttribute("id","testarea");f.body.appendChild(g);return g};
core.UnitTest.cleanupTestAreaDiv=function(){var f=runtime.getWindow().document,g=f.getElementById("testarea");runtime.assert(!!g&&g.parentNode===f.body,'Test environment broken, found no div with id "testarea" below body.');f.body.removeChild(g)};core.UnitTest.createXmlDocument=function(f,g,d){var c="<?xml version='1.0' encoding='UTF-8'?>",c=c+("<"+f);Object.keys(d).forEach(function(e){c+=" xmlns:"+e+'="'+d[e]+'"'});c+=">";c+=g;c+="</"+f+">";return runtime.parseXML(c)};
core.UnitTest.createOdtDocument=function(f,g){return core.UnitTest.createXmlDocument("office:document",f,g)};
core.UnitTestLogger=function(){var f=[],g=0,d=0,c="",e="";this.startTest=function(m,h){f=[];g=0;c=m;e=h;d=Date.now()};this.endTest=function(){var m=Date.now();return{description:e,suite:[c,e],success:0===g,log:f,time:m-d}};this.debug=function(c){f.push({category:"debug",message:c})};this.fail=function(c){g+=1;f.push({category:"fail",message:c})};this.pass=function(c){f.push({category:"pass",message:c})}};
core.UnitTestRunner=function(f,g){function d(a){q+=1;b?g.debug(a):g.fail(a)}function c(a,b){var c;try{if(a.length!==b.length)return d("array of length "+a.length+" should be "+b.length+" long"),!1;for(c=0;c<a.length;c+=1)if(a[c]!==b[c])return d(a[c]+" should be "+b[c]+" at array index "+c),!1}catch(e){return!1}return!0}function e(a,b,c){var f=a.attributes,h=f.length,g,r,m;for(g=0;g<h;g+=1)if(r=f.item(g),"xmlns"!==r.prefix&&"urn:webodf:names:steps"!==r.namespaceURI){m=b.getAttributeNS(r.namespaceURI,
r.localName);if(!b.hasAttributeNS(r.namespaceURI,r.localName))return d("Attribute "+r.localName+" with value "+r.value+" was not present"),!1;if(m!==r.value)return d("Attribute "+r.localName+" was "+m+" should be "+r.value),!1}return c?!0:e(b,a,!0)}function m(a,b){var c,f;c=a.nodeType;f=b.nodeType;if(c!==f)return d("Nodetype '"+c+"' should be '"+f+"'"),!1;if(c===Node.TEXT_NODE){if(a.data===b.data)return!0;d("Textnode data '"+a.data+"' should be '"+b.data+"'");return!1}runtime.assert(c===Node.ELEMENT_NODE,
"Only textnodes and elements supported.");if(a.namespaceURI!==b.namespaceURI)return d("namespace '"+a.namespaceURI+"' should be '"+b.namespaceURI+"'"),!1;if(a.localName!==b.localName)return d("localName '"+a.localName+"' should be '"+b.localName+"'"),!1;if(!e(a,b,!1))return!1;c=a.firstChild;for(f=b.firstChild;c;){if(!f)return d("Nodetype '"+c.nodeType+"' is unexpected here."),!1;if(!m(c,f))return!1;c=c.nextSibling;f=f.nextSibling}return f?(d("Nodetype '"+f.nodeType+"' is missing here."),!1):!0}function h(a,
b,d){if(0===b)return a===b&&1/a===1/b;if(a===b)return!0;if(null===a||null===b)return!1;if("number"===typeof b&&isNaN(b))return"number"===typeof a&&isNaN(a);if("number"===typeof b&&"number"===typeof a){if(a===b)return!0;void 0===d&&(d=1E-4);runtime.assert("number"===typeof d,"Absolute tolerance not given as number.");runtime.assert(0<=d,"Absolute tolerance should be given as positive number, was "+d);a=Math.abs(a-b);return a<=d}return Object.prototype.toString.call(b)===Object.prototype.toString.call([])?
c(a,b):"object"===typeof b&&"object"===typeof a?b.constructor===Element||b.constructor===Node?m(a,b):r(a,b):!1}function p(a,b,c,e){"string"===typeof b&&"string"===typeof c||g.debug("WARN: shouldBe() expects string arguments");var f,r;try{r=eval(b)}catch(m){f=m}a=eval(c);f?d(b+" should be "+a+". Threw exception "+f):h(r,a,e)?g.pass(b+" is "+c):String(typeof r)===String(typeof a)?(c=0===r&&0>1/r?"-0":String(r),d(b+" should be "+a+". Was "+c+".")):d(b+" should be "+a+" (of type "+typeof a+"). Was "+
r+" (of type "+typeof r+").")}var q=0,n,r,b=!1;this.resourcePrefix=function(){return f};this.beginExpectFail=function(){n=q;b=!0};this.endExpectFail=function(){var a=n===q;b=!1;q=n;a&&(q+=1,g.fail("Expected at least one failed test, but none registered."))};r=function(a,b){var k=Object.keys(a),e=Object.keys(b);k.sort();e.sort();return c(k,e)&&Object.keys(a).every(function(c){var k=a[c],e=b[c];return h(k,e)?!0:(d(k+" should be "+e+" for key "+c),!1)})};this.areNodesEqual=m;this.shouldBeNull=function(a,
b){p(a,b,"null")};this.shouldBeNonNull=function(a,b){var c,e;try{e=eval(b)}catch(f){c=f}c?d(b+" should be non-null. Threw exception "+c):null!==e?g.pass(b+" is non-null."):d(b+" should be non-null. Was "+e)};this.shouldBe=p;this.testFailed=d;this.countFailedTests=function(){return q};this.name=function(a){var b,c,d=[],e=a.length;d.length=e;for(b=0;b<e;b+=1){c=Runtime.getFunctionName(a[b])||"";if(""===c)throw"Found a function without a name.";d[b]={f:a[b],name:c}}return d}};
core.UnitTester=function(){function f(c,d){return"<span style='color:blue;cursor:pointer' onclick='"+d+"'>"+c+"</span>"}function g(c){d.reporter&&d.reporter(c)}var d=this,c=0,e=new core.UnitTestLogger,m={},h="BrowserRuntime"===runtime.type();this.resourcePrefix="";this.reporter=function(c){var d,e;h?runtime.log("<span>Running "+f(c.description,'runTest("'+c.suite[0]+'","'+c.description+'")')+"</span>"):runtime.log("Running "+c.description);if(!c.success)for(d=0;d<c.log.length;d+=1)e=c.log[d],runtime.log(e.category,
e.message)};this.runTests=function(p,q,n){function r(d){function f(){A&&a.endExpectFail();g(e.endTest());l.tearDown();k[h]=v===a.countFailedTests();r(d.slice(1))}var h,A;if(0===d.length)m[b]=k,c+=a.countFailedTests(),q();else if(s=d[0].f,h=d[0].name,A=!0===d[0].expectFail,v=a.countFailedTests(),n.length&&-1===n.indexOf(h))r(d.slice(1));else{l.setUp();e.startTest(b,h);A&&a.beginExpectFail();try{s(f)}catch(p){a.testFailed("Unexpected exception encountered: "+p.toString()+"\n"+p.stack),f()}}}var b=Runtime.getFunctionName(p)||
"",a=new core.UnitTestRunner(d.resourcePrefix,e),l=new p(a),k={},t,s,w,x,v;if(m.hasOwnProperty(b))runtime.log("Test "+b+" has already run.");else{h?runtime.log("<span>Running "+f(b,'runSuite("'+b+'");')+": "+l.description()+"</span>"):runtime.log("Running "+b+": "+l.description);w=l.tests();for(t=0;t<w.length;t+=1)if(s=w[t].f,p=w[t].name,x=!0===w[t].expectFail,!n.length||-1!==n.indexOf(p)){v=a.countFailedTests();l.setUp();e.startTest(b,p);x&&a.beginExpectFail();try{s()}catch(z){a.testFailed("Unexpected exception encountered: "+
z.toString()+"\n"+z.stack)}x&&a.endExpectFail();g(e.endTest());l.tearDown();k[p]=v===a.countFailedTests()}r(l.asyncTests())}};this.failedTestsCount=function(){return c};this.results=function(){return m}};core.Utils=function(){function f(g,d){if(d&&Array.isArray(d)){g=g||[];if(!Array.isArray(g))throw"Destination is not an array.";g=g.concat(d.map(function(c){return f(null,c)}))}else if(d&&"object"===typeof d){g=g||{};if("object"!==typeof g)throw"Destination is not an object.";Object.keys(d).forEach(function(c){g[c]=f(g[c],d[c])})}else g=d;return g}this.hashString=function(f){var d=0,c,e;c=0;for(e=f.length;c<e;c+=1)d=(d<<5)-d+f.charCodeAt(c),d|=0;return d};this.mergeObjects=function(g,d){Object.keys(d).forEach(function(c){g[c]=
f(g[c],d[c])});return g}};core.Zip=function(f,g){function d(a){var b=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,
853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,
4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,
225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,
2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,
2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],c,d,e=a.length,k=0,k=0;c=-1;for(d=0;d<e;d+=1)k=(c^a[d])&255,k=b[k],c=c>>>8^k;return c^-1}function c(a){return new Date((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&15,a>>5&63,(a&31)<<1)}function e(a){var b=a.getFullYear();return 1980>b?0:b-1980<<
25|a.getMonth()+1<<21|a.getDate()<<16|a.getHours()<<11|a.getMinutes()<<5|a.getSeconds()>>1}function m(a,b){var d,e,l,f,h,g,r,m=this;this.load=function(b){if(null!==m.data)b(null,m.data);else{var c=h+34+e+l+256;c+r>k&&(c=k-r);runtime.read(a,r,c,function(c,d){if(c||null===d)b(c,d);else a:{var e=d,k=new core.ByteArray(e),l=k.readUInt32LE(),r;if(67324752!==l)b("File entry signature is wrong."+l.toString()+" "+e.length.toString(),null);else{k.pos+=22;l=k.readUInt16LE();r=k.readUInt16LE();k.pos+=l+r;if(f){e=
e.subarray(k.pos,k.pos+h);if(h!==e.length){b("The amount of compressed bytes read was "+e.length.toString()+" instead of "+h.toString()+" for "+m.filename+" in "+a+".",null);break a}e=s(e,g)}else e=e.subarray(k.pos,k.pos+g);g!==e.length?b("The amount of bytes read was "+e.length.toString()+" instead of "+g.toString()+" for "+m.filename+" in "+a+".",null):(m.data=e,b(null,e))}}})}};this.set=function(a,b,c,d){m.filename=a;m.data=b;m.compressed=c;m.date=d};this.error=null;b&&(d=b.readUInt32LE(),33639248!==
d?this.error="Central directory entry has wrong signature at position "+(b.pos-4).toString()+' for file "'+a+'": '+b.data.length.toString():(b.pos+=6,f=b.readUInt16LE(),this.date=c(b.readUInt32LE()),b.readUInt32LE(),h=b.readUInt32LE(),g=b.readUInt32LE(),e=b.readUInt16LE(),l=b.readUInt16LE(),d=b.readUInt16LE(),b.pos+=8,r=b.readUInt32LE(),this.filename=runtime.byteArrayToString(b.data.subarray(b.pos,b.pos+e),"utf8"),this.data=null,b.pos+=e+l+d))}function h(a,b){if(22!==a.length)b("Central directory length should be 22.",
w);else{var c=new core.ByteArray(a),d;d=c.readUInt32LE();101010256!==d?b("Central directory signature is wrong: "+d.toString(),w):(d=c.readUInt16LE(),0!==d?b("Zip files with non-zero disk numbers are not supported.",w):(d=c.readUInt16LE(),0!==d?b("Zip files with non-zero disk numbers are not supported.",w):(d=c.readUInt16LE(),t=c.readUInt16LE(),d!==t?b("Number of entries is inconsistent.",w):(d=c.readUInt32LE(),c=c.readUInt16LE(),c=k-22-d,runtime.read(f,c,k-c,function(a,c){if(a||null===c)b(a,w);else a:{var d=
new core.ByteArray(c),e,k;l=[];for(e=0;e<t;e+=1){k=new m(f,d);if(k.error){b(k.error,w);break a}l[l.length]=k}b(null,w)}})))))}}function p(a,b){var c=null,d,e;for(e=0;e<l.length;e+=1)if(d=l[e],d.filename===a){c=d;break}c?c.data?b(null,c.data):c.load(b):b(a+" not found.",null)}function q(a){var b=new core.ByteArrayWriter("utf8"),c=0;b.appendArray([80,75,3,4,20,0,0,0,0,0]);a.data&&(c=a.data.length);b.appendUInt32LE(e(a.date));b.appendUInt32LE(a.data?d(a.data):0);b.appendUInt32LE(c);b.appendUInt32LE(c);
b.appendUInt16LE(a.filename.length);b.appendUInt16LE(0);b.appendString(a.filename);a.data&&b.appendByteArray(a.data);return b}function n(a,b){var c=new core.ByteArrayWriter("utf8"),k=0;c.appendArray([80,75,1,2,20,0,20,0,0,0,0,0]);a.data&&(k=a.data.length);c.appendUInt32LE(e(a.date));c.appendUInt32LE(a.data?d(a.data):0);c.appendUInt32LE(k);c.appendUInt32LE(k);c.appendUInt16LE(a.filename.length);c.appendArray([0,0,0,0,0,0,0,0,0,0,0,0]);c.appendUInt32LE(b);c.appendString(a.filename);return c}function r(a,
b){if(a===l.length)b(null);else{var c=l[a];null!==c.data?r(a+1,b):c.load(function(c){c?b(c):r(a+1,b)})}}function b(a,b){r(0,function(c){if(c)b(c);else{var d,e,k=new core.ByteArrayWriter("utf8"),f=[0];for(d=0;d<l.length;d+=1)k.appendByteArrayWriter(q(l[d])),f.push(k.getLength());c=k.getLength();for(d=0;d<l.length;d+=1)e=l[d],k.appendByteArrayWriter(n(e,f[d]));d=k.getLength()-c;k.appendArray([80,75,5,6,0,0,0,0]);k.appendUInt16LE(l.length);k.appendUInt16LE(l.length);k.appendUInt32LE(d);k.appendUInt32LE(c);
k.appendArray([0,0]);a(k.getByteArray())}})}function a(a,c){b(function(b){runtime.writeFile(a,b,c)},c)}var l,k,t,s=(new core.RawInflate).inflate,w=this,x=new core.Base64;this.load=p;this.save=function(a,b,c,d){var e,k;for(e=0;e<l.length;e+=1)if(k=l[e],k.filename===a){k.set(a,b,c,d);return}k=new m(f);k.set(a,b,c,d);l.push(k)};this.remove=function(a){var b,c;for(b=0;b<l.length;b+=1)if(c=l[b],c.filename===a)return l.splice(b,1),!0;return!1};this.write=function(b){a(f,b)};this.writeAs=a;this.createByteArray=
b;this.loadContentXmlAsFragments=function(a,b){w.loadAsString(a,function(a,c){if(a)return b.rootElementReady(a);b.rootElementReady(null,c,!0)})};this.loadAsString=function(a,b){p(a,function(a,c){if(a||null===c)return b(a,null);var d=runtime.byteArrayToString(c,"utf8");b(null,d)})};this.loadAsDOM=function(a,b){w.loadAsString(a,function(a,c){if(a||null===c)b(a,null);else{var d=(new DOMParser).parseFromString(c,"text/xml");b(null,d)}})};this.loadAsDataURL=function(a,b,c){p(a,function(a,d){if(a||!d)return c(a,
null);var k=0,e;b||(b=80===d[1]&&78===d[2]&&71===d[3]?"image/png":255===d[0]&&216===d[1]&&255===d[2]?"image/jpeg":71===d[0]&&73===d[1]&&70===d[2]?"image/gif":"");for(e="data:"+b+";base64,";k<d.length;)e+=x.convertUTF8ArrayToBase64(d.subarray(k,Math.min(k+45E3,d.length))),k+=45E3;c(null,e)})};this.getEntries=function(){return l.slice()};k=-1;null===g?l=[]:runtime.getFileSize(f,function(a){k=a;0>k?g("File '"+f+"' cannot be read.",w):runtime.read(f,k-22,22,function(a,b){a||null===g||null===b?g(a,w):
h(b,g)})})};gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}};gui.SessionConstraints=function(){function f(c){g.hasOwnProperty(c)||(g[c]=!1,d.register(c))}var g={},d=new core.EventNotifier;this.registerConstraint=f;this.subscribe=function(c,e){f(c);d.subscribe(c,e)};this.unsubscribe=function(c,e){d.unsubscribe(c,e)};this.setState=function(c,e){runtime.assert(!0===g.hasOwnProperty(c),"No such constraint");g[c]!==e&&(g[c]=e,d.emit(c,e))};this.getState=function(c){runtime.assert(!0===g.hasOwnProperty(c),"No such constraint");return g[c]}};xmldom.LSSerializerFilter=function(){};xmldom.LSSerializerFilter.prototype.acceptNode=function(f){};odf.OdfNodeFilter=function(){this.acceptNode=function(f){return"http://www.w3.org/1999/xhtml"===f.namespaceURI?NodeFilter.FILTER_SKIP:f.namespaceURI&&f.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};odf.Namespaces={namespaceMap:{db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",
office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",
dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"};
(function(){var f=odf.Namespaces.namespaceMap,g=odf.Namespaces.prefixMap,d;for(d in f)f.hasOwnProperty(d)&&(g[f[d]]=d)})();odf.Namespaces.forEachPrefix=function(f){var g=odf.Namespaces.namespaceMap,d;for(d in g)g.hasOwnProperty(d)&&f(d,g[d])};odf.Namespaces.lookupNamespaceURI=function(f){var g=null;odf.Namespaces.namespaceMap.hasOwnProperty(f)&&(g=odf.Namespaces.namespaceMap[f]);return g};odf.Namespaces.lookupPrefix=function(f){var g=odf.Namespaces.prefixMap;return g.hasOwnProperty(f)?g[f]:null};
odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI;xmldom.XPathIterator=function(){};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};
function createXPathSingleton(){function f(c,b,a){return-1!==c&&(c<b||-1===b)&&(c<a||-1===a)}function g(c){for(var b=[],a=0,d=c.length,k;a<d;){var e=c,h=d,g=b,m="",p=[],q=e.indexOf("[",a),u=e.indexOf("/",a),C=e.indexOf("=",a);f(u,q,C)?(m=e.substring(a,u),a=u+1):f(q,u,C)?(m=e.substring(a,q),a=n(e,q,p)):f(C,u,q)?(m=e.substring(a,C),a=C):(m=e.substring(a,h),a=h);g.push({location:m,predicates:p});if(a<d&&"="===c[a]){k=c.substring(a+1,d);if(2<k.length&&("'"===k[0]||'"'===k[0]))k=k.slice(1,k.length-1);
else try{k=parseInt(k,10)}catch(I){}a=d}}return{steps:b,value:k}}function d(){var c=null,b=!1;this.setNode=function(a){c=a};this.reset=function(){b=!1};this.next=function(){var a=b?null:c;b=!0;return a}}function c(c,b,a){this.reset=function(){c.reset()};this.next=function(){for(var d=c.next();d;){d.nodeType===Node.ELEMENT_NODE&&(d=d.getAttributeNodeNS(b,a));if(d)break;d=c.next()}return d}}function e(c,b){var a=c.next(),d=null;this.reset=function(){c.reset();a=c.next();d=null};this.next=function(){for(;a;){if(d)if(b&&
d.firstChild)d=d.firstChild;else{for(;!d.nextSibling&&d!==a;)d=d.parentNode;d===a?a=c.next():d=d.nextSibling}else{do(d=a.firstChild)||(a=c.next());while(a&&!d)}if(d&&d.nodeType===Node.ELEMENT_NODE)return d}return null}}function m(c,b){this.reset=function(){c.reset()};this.next=function(){for(var a=c.next();a&&!b(a);)a=c.next();return a}}function h(c,b,a){b=b.split(":",2);var d=a(b[0]),e=b[1];return new m(c,function(a){return a.localName===e&&a.namespaceURI===d})}function p(c,b,a){var e=new d,k=q(e,
b,a),f=b.value;return void 0===f?new m(c,function(a){e.setNode(a);k.reset();return null!==k.next()}):new m(c,function(a){e.setNode(a);k.reset();return(a=k.next())?a.nodeValue===f:!1})}var q,n;n=function(c,b,a){for(var d=b,e=c.length,f=0;d<e;)"]"===c[d]?(f-=1,0>=f&&a.push(g(c.substring(b,d)))):"["===c[d]&&(0>=f&&(b=d+1),f+=1),d+=1;return d};q=function(d,b,a){var f,k,g,m;for(f=0;f<b.steps.length;f+=1){g=b.steps[f];k=g.location;if(""===k)d=new e(d,!1);else if("@"===k[0]){k=k.substr(1).split(":",2);m=
a(k[0]);if(!m)throw"No namespace associated with the prefix "+k[0];d=new c(d,m,k[1])}else"."!==k&&(d=new e(d,!1),-1!==k.indexOf(":")&&(d=h(d,k,a)));for(k=0;k<g.predicates.length;k+=1)m=g.predicates[k],d=p(d,m,a)}return d};return{getODFElementsWithXPath:function(c,b,a){var e=c.ownerDocument,k=[],f=null;if(e&&"function"===typeof e.evaluate)for(a=e.evaluate(b,c,a,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),f=a.iterateNext();null!==f;)f.nodeType===Node.ELEMENT_NODE&&k.push(f),f=a.iterateNext();else{k=
new d;k.setNode(c);c=g(b);k=q(k,c,a);c=[];for(a=k.next();a;)c.push(a),a=k.next();k=c}return k}}}xmldom.XPath=createXPathSingleton();odf.StyleInfo=function(){function f(a,b){var c,d,e,k,l,h=0;if(c=A[a.localName])if(e=c[a.namespaceURI])h=e.length;for(c=0;c<h;c+=1)d=e[c],k=d.ns,l=d.localname,(d=a.getAttributeNS(k,l))&&a.setAttributeNS(k,C[k]+l,b+d);for(e=a.firstElementChild;e;)f(e,b),e=e.nextElementSibling}function g(a,b){var c,d,e,k,f,l=0;if(c=A[a.localName])if(e=c[a.namespaceURI])l=e.length;for(c=0;c<l;c+=1)if(d=e[c],k=d.ns,f=d.localname,d=a.getAttributeNS(k,f))d=d.replace(b,""),a.setAttributeNS(k,C[k]+f,d);for(e=a.firstElementChild;e;)g(e,
b),e=e.nextElementSibling}function d(a,b){var c,d,e,k,f,l=0;if(c=A[a.localName])if(e=c[a.namespaceURI])l=e.length;for(c=0;c<l;c+=1)if(k=e[c],d=k.ns,f=k.localname,d=a.getAttributeNS(d,f))b=b||{},k=k.keyname,b.hasOwnProperty(k)?b[k][d]=1:(f={},f[d]=1,b[k]=f);return b}function c(a,b){var e,k;d(a,b);for(e=a.firstChild;e;)e.nodeType===Node.ELEMENT_NODE&&(k=e,c(k,b)),e=e.nextSibling}function e(a,b,c){this.key=a;this.name=b;this.family=c;this.requires={}}function m(a,b,c){var d=a+'"'+b,k=c[d];k||(k=c[d]=
new e(d,a,b));return k}function h(a,b,c){var d,e,k,f,l,g=0;d=a.getAttributeNS(v,"name");f=a.getAttributeNS(v,"family");d&&f&&(b=m(d,f,c));if(b){if(d=A[a.localName])if(k=d[a.namespaceURI])g=k.length;for(d=0;d<g;d+=1)if(f=k[d],e=f.ns,l=f.localname,e=a.getAttributeNS(e,l))f=f.keyname,f=m(e,f,c),b.requires[f.key]=f}for(a=a.firstElementChild;a;)h(a,b,c),a=a.nextElementSibling;return c}function p(a,b){var c=b[a.family];c||(c=b[a.family]={});c[a.name]=1;Object.keys(a.requires).forEach(function(c){p(a.requires[c],
b)})}function q(a,b){var c=h(a,null,{});Object.keys(c).forEach(function(a){a=c[a];var d=b[a.family];d&&d.hasOwnProperty(a.name)&&p(a,b)})}function n(a,b){function c(b){(b=k.getAttributeNS(v,b))&&(a[b]=!0)}var d=["font-name","font-name-asian","font-name-complex"],e,k;for(e=b&&b.firstElementChild;e;)k=e,d.forEach(c),n(a,k),e=e.nextElementSibling}function r(a,b){function c(a){var d=k.getAttributeNS(v,a);d&&b.hasOwnProperty(d)&&k.setAttributeNS(v,"style:"+a,b[d])}var d=["font-name","font-name-asian",
"font-name-complex"],e,k;for(e=a&&a.firstElementChild;e;)k=e,d.forEach(c),r(k,b),e=e.nextElementSibling}var b=odf.Namespaces.chartns,a=odf.Namespaces.dbns,l=odf.Namespaces.dr3dns,k=odf.Namespaces.drawns,t=odf.Namespaces.formns,s=odf.Namespaces.numberns,w=odf.Namespaces.officens,x=odf.Namespaces.presentationns,v=odf.Namespaces.stylens,z=odf.Namespaces.tablens,u=odf.Namespaces.textns,C={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:",
"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:",
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},I={text:[{ens:v,en:"tab-stop",ans:v,a:"leader-text-style"},{ens:v,en:"drop-cap",ans:v,a:"style-name"},{ens:u,en:"notes-configuration",ans:u,a:"citation-body-style-name"},{ens:u,en:"notes-configuration",ans:u,a:"citation-style-name"},{ens:u,en:"a",ans:u,a:"style-name"},{ens:u,en:"alphabetical-index",ans:u,a:"style-name"},{ens:u,en:"linenumbering-configuration",
ans:u,a:"style-name"},{ens:u,en:"list-level-style-number",ans:u,a:"style-name"},{ens:u,en:"ruby-text",ans:u,a:"style-name"},{ens:u,en:"span",ans:u,a:"style-name"},{ens:u,en:"a",ans:u,a:"visited-style-name"},{ens:v,en:"text-properties",ans:v,a:"text-line-through-text-style"},{ens:u,en:"alphabetical-index-source",ans:u,a:"main-entry-style-name"},{ens:u,en:"index-entry-bibliography",ans:u,a:"style-name"},{ens:u,en:"index-entry-chapter",ans:u,a:"style-name"},{ens:u,en:"index-entry-link-end",ans:u,a:"style-name"},
{ens:u,en:"index-entry-link-start",ans:u,a:"style-name"},{ens:u,en:"index-entry-page-number",ans:u,a:"style-name"},{ens:u,en:"index-entry-span",ans:u,a:"style-name"},{ens:u,en:"index-entry-tab-stop",ans:u,a:"style-name"},{ens:u,en:"index-entry-text",ans:u,a:"style-name"},{ens:u,en:"index-title-template",ans:u,a:"style-name"},{ens:u,en:"list-level-style-bullet",ans:u,a:"style-name"},{ens:u,en:"outline-level-style",ans:u,a:"style-name"}],paragraph:[{ens:k,en:"caption",ans:k,a:"text-style-name"},{ens:k,
en:"circle",ans:k,a:"text-style-name"},{ens:k,en:"connector",ans:k,a:"text-style-name"},{ens:k,en:"control",ans:k,a:"text-style-name"},{ens:k,en:"custom-shape",ans:k,a:"text-style-name"},{ens:k,en:"ellipse",ans:k,a:"text-style-name"},{ens:k,en:"frame",ans:k,a:"text-style-name"},{ens:k,en:"line",ans:k,a:"text-style-name"},{ens:k,en:"measure",ans:k,a:"text-style-name"},{ens:k,en:"path",ans:k,a:"text-style-name"},{ens:k,en:"polygon",ans:k,a:"text-style-name"},{ens:k,en:"polyline",ans:k,a:"text-style-name"},
{ens:k,en:"rect",ans:k,a:"text-style-name"},{ens:k,en:"regular-polygon",ans:k,a:"text-style-name"},{ens:w,en:"annotation",ans:k,a:"text-style-name"},{ens:t,en:"column",ans:t,a:"text-style-name"},{ens:v,en:"style",ans:v,a:"next-style-name"},{ens:z,en:"body",ans:z,a:"paragraph-style-name"},{ens:z,en:"even-columns",ans:z,a:"paragraph-style-name"},{ens:z,en:"even-rows",ans:z,a:"paragraph-style-name"},{ens:z,en:"first-column",ans:z,a:"paragraph-style-name"},{ens:z,en:"first-row",ans:z,a:"paragraph-style-name"},
{ens:z,en:"last-column",ans:z,a:"paragraph-style-name"},{ens:z,en:"last-row",ans:z,a:"paragraph-style-name"},{ens:z,en:"odd-columns",ans:z,a:"paragraph-style-name"},{ens:z,en:"odd-rows",ans:z,a:"paragraph-style-name"},{ens:u,en:"notes-configuration",ans:u,a:"default-style-name"},{ens:u,en:"alphabetical-index-entry-template",ans:u,a:"style-name"},{ens:u,en:"bibliography-entry-template",ans:u,a:"style-name"},{ens:u,en:"h",ans:u,a:"style-name"},{ens:u,en:"illustration-index-entry-template",ans:u,a:"style-name"},
{ens:u,en:"index-source-style",ans:u,a:"style-name"},{ens:u,en:"object-index-entry-template",ans:u,a:"style-name"},{ens:u,en:"p",ans:u,a:"style-name"},{ens:u,en:"table-index-entry-template",ans:u,a:"style-name"},{ens:u,en:"table-of-content-entry-template",ans:u,a:"style-name"},{ens:u,en:"table-index-entry-template",ans:u,a:"style-name"},{ens:u,en:"user-index-entry-template",ans:u,a:"style-name"},{ens:v,en:"page-layout-properties",ans:v,a:"register-truth-ref-style-name"}],chart:[{ens:b,en:"axis",ans:b,
a:"style-name"},{ens:b,en:"chart",ans:b,a:"style-name"},{ens:b,en:"data-label",ans:b,a:"style-name"},{ens:b,en:"data-point",ans:b,a:"style-name"},{ens:b,en:"equation",ans:b,a:"style-name"},{ens:b,en:"error-indicator",ans:b,a:"style-name"},{ens:b,en:"floor",ans:b,a:"style-name"},{ens:b,en:"footer",ans:b,a:"style-name"},{ens:b,en:"grid",ans:b,a:"style-name"},{ens:b,en:"legend",ans:b,a:"style-name"},{ens:b,en:"mean-value",ans:b,a:"style-name"},{ens:b,en:"plot-area",ans:b,a:"style-name"},{ens:b,en:"regression-curve",
ans:b,a:"style-name"},{ens:b,en:"series",ans:b,a:"style-name"},{ens:b,en:"stock-gain-marker",ans:b,a:"style-name"},{ens:b,en:"stock-loss-marker",ans:b,a:"style-name"},{ens:b,en:"stock-range-line",ans:b,a:"style-name"},{ens:b,en:"subtitle",ans:b,a:"style-name"},{ens:b,en:"title",ans:b,a:"style-name"},{ens:b,en:"wall",ans:b,a:"style-name"}],section:[{ens:u,en:"alphabetical-index",ans:u,a:"style-name"},{ens:u,en:"bibliography",ans:u,a:"style-name"},{ens:u,en:"illustration-index",ans:u,a:"style-name"},
{ens:u,en:"index-title",ans:u,a:"style-name"},{ens:u,en:"object-index",ans:u,a:"style-name"},{ens:u,en:"section",ans:u,a:"style-name"},{ens:u,en:"table-of-content",ans:u,a:"style-name"},{ens:u,en:"table-index",ans:u,a:"style-name"},{ens:u,en:"user-index",ans:u,a:"style-name"}],ruby:[{ens:u,en:"ruby",ans:u,a:"style-name"}],table:[{ens:a,en:"query",ans:a,a:"style-name"},{ens:a,en:"table-representation",ans:a,a:"style-name"},{ens:z,en:"background",ans:z,a:"style-name"},{ens:z,en:"table",ans:z,a:"style-name"}],
"table-column":[{ens:a,en:"column",ans:a,a:"style-name"},{ens:z,en:"table-column",ans:z,a:"style-name"}],"table-row":[{ens:a,en:"query",ans:a,a:"default-row-style-name"},{ens:a,en:"table-representation",ans:a,a:"default-row-style-name"},{ens:z,en:"table-row",ans:z,a:"style-name"}],"table-cell":[{ens:a,en:"column",ans:a,a:"default-cell-style-name"},{ens:z,en:"table-column",ans:z,a:"default-cell-style-name"},{ens:z,en:"table-row",ans:z,a:"default-cell-style-name"},{ens:z,en:"body",ans:z,a:"style-name"},
{ens:z,en:"covered-table-cell",ans:z,a:"style-name"},{ens:z,en:"even-columns",ans:z,a:"style-name"},{ens:z,en:"covered-table-cell",ans:z,a:"style-name"},{ens:z,en:"even-columns",ans:z,a:"style-name"},{ens:z,en:"even-rows",ans:z,a:"style-name"},{ens:z,en:"first-column",ans:z,a:"style-name"},{ens:z,en:"first-row",ans:z,a:"style-name"},{ens:z,en:"last-column",ans:z,a:"style-name"},{ens:z,en:"last-row",ans:z,a:"style-name"},{ens:z,en:"odd-columns",ans:z,a:"style-name"},{ens:z,en:"odd-rows",ans:z,a:"style-name"},
{ens:z,en:"table-cell",ans:z,a:"style-name"}],graphic:[{ens:l,en:"cube",ans:k,a:"style-name"},{ens:l,en:"extrude",ans:k,a:"style-name"},{ens:l,en:"rotate",ans:k,a:"style-name"},{ens:l,en:"scene",ans:k,a:"style-name"},{ens:l,en:"sphere",ans:k,a:"style-name"},{ens:k,en:"caption",ans:k,a:"style-name"},{ens:k,en:"circle",ans:k,a:"style-name"},{ens:k,en:"connector",ans:k,a:"style-name"},{ens:k,en:"control",ans:k,a:"style-name"},{ens:k,en:"custom-shape",ans:k,a:"style-name"},{ens:k,en:"ellipse",ans:k,a:"style-name"},
{ens:k,en:"frame",ans:k,a:"style-name"},{ens:k,en:"g",ans:k,a:"style-name"},{ens:k,en:"line",ans:k,a:"style-name"},{ens:k,en:"measure",ans:k,a:"style-name"},{ens:k,en:"page-thumbnail",ans:k,a:"style-name"},{ens:k,en:"path",ans:k,a:"style-name"},{ens:k,en:"polygon",ans:k,a:"style-name"},{ens:k,en:"polyline",ans:k,a:"style-name"},{ens:k,en:"rect",ans:k,a:"style-name"},{ens:k,en:"regular-polygon",ans:k,a:"style-name"},{ens:w,en:"annotation",ans:k,a:"style-name"}],presentation:[{ens:l,en:"cube",ans:x,
a:"style-name"},{ens:l,en:"extrude",ans:x,a:"style-name"},{ens:l,en:"rotate",ans:x,a:"style-name"},{ens:l,en:"scene",ans:x,a:"style-name"},{ens:l,en:"sphere",ans:x,a:"style-name"},{ens:k,en:"caption",ans:x,a:"style-name"},{ens:k,en:"circle",ans:x,a:"style-name"},{ens:k,en:"connector",ans:x,a:"style-name"},{ens:k,en:"control",ans:x,a:"style-name"},{ens:k,en:"custom-shape",ans:x,a:"style-name"},{ens:k,en:"ellipse",ans:x,a:"style-name"},{ens:k,en:"frame",ans:x,a:"style-name"},{ens:k,en:"g",ans:x,a:"style-name"},
{ens:k,en:"line",ans:x,a:"style-name"},{ens:k,en:"measure",ans:x,a:"style-name"},{ens:k,en:"page-thumbnail",ans:x,a:"style-name"},{ens:k,en:"path",ans:x,a:"style-name"},{ens:k,en:"polygon",ans:x,a:"style-name"},{ens:k,en:"polyline",ans:x,a:"style-name"},{ens:k,en:"rect",ans:x,a:"style-name"},{ens:k,en:"regular-polygon",ans:x,a:"style-name"},{ens:w,en:"annotation",ans:x,a:"style-name"}],"drawing-page":[{ens:k,en:"page",ans:k,a:"style-name"},{ens:x,en:"notes",ans:k,a:"style-name"},{ens:v,en:"handout-master",
ans:k,a:"style-name"},{ens:v,en:"master-page",ans:k,a:"style-name"}],"list-style":[{ens:u,en:"list",ans:u,a:"style-name"},{ens:u,en:"numbered-paragraph",ans:u,a:"style-name"},{ens:u,en:"list-item",ans:u,a:"style-override"},{ens:v,en:"style",ans:v,a:"list-style-name"}],data:[{ens:v,en:"style",ans:v,a:"data-style-name"},{ens:v,en:"style",ans:v,a:"percentage-data-style-name"},{ens:x,en:"date-time-decl",ans:v,a:"data-style-name"},{ens:u,en:"creation-date",ans:v,a:"data-style-name"},{ens:u,en:"creation-time",
ans:v,a:"data-style-name"},{ens:u,en:"database-display",ans:v,a:"data-style-name"},{ens:u,en:"date",ans:v,a:"data-style-name"},{ens:u,en:"editing-duration",ans:v,a:"data-style-name"},{ens:u,en:"expression",ans:v,a:"data-style-name"},{ens:u,en:"meta-field",ans:v,a:"data-style-name"},{ens:u,en:"modification-date",ans:v,a:"data-style-name"},{ens:u,en:"modification-time",ans:v,a:"data-style-name"},{ens:u,en:"print-date",ans:v,a:"data-style-name"},{ens:u,en:"print-time",ans:v,a:"data-style-name"},{ens:u,
en:"table-formula",ans:v,a:"data-style-name"},{ens:u,en:"time",ans:v,a:"data-style-name"},{ens:u,en:"user-defined",ans:v,a:"data-style-name"},{ens:u,en:"user-field-get",ans:v,a:"data-style-name"},{ens:u,en:"user-field-input",ans:v,a:"data-style-name"},{ens:u,en:"variable-get",ans:v,a:"data-style-name"},{ens:u,en:"variable-input",ans:v,a:"data-style-name"},{ens:u,en:"variable-set",ans:v,a:"data-style-name"}],"page-layout":[{ens:x,en:"notes",ans:v,a:"page-layout-name"},{ens:v,en:"handout-master",ans:v,
a:"page-layout-name"},{ens:v,en:"master-page",ans:v,a:"page-layout-name"}]},A,K=xmldom.XPath;this.collectUsedFontFaces=n;this.changeFontFaceNames=r;this.UsedStyleList=function(a,b){var d={};this.uses=function(a){var b=a.localName,c=a.getAttributeNS(k,"name")||a.getAttributeNS(v,"name");a="style"===b?a.getAttributeNS(v,"family"):a.namespaceURI===s?"data":b;return(a=d[a])?0<a[c]:!1};c(a,d);b&&q(b,d)};this.getStyleName=function(a,b){var c,d,e=A[b.localName];if(e&&(e=e[b.namespaceURI]))for(d=0;d<e.length;d+=
1)if(e[d].keyname===a&&(e=e[d],b.hasAttributeNS(e.ns,e.localname))){c=b.getAttributeNS(e.ns,e.localname);break}return c};this.hasDerivedStyles=function(a,b,c){var d=c.getAttributeNS(v,"name");c=c.getAttributeNS(v,"family");return K.getODFElementsWithXPath(a,"//style:*[@style:parent-style-name='"+d+"'][@style:family='"+c+"']",b).length?!0:!1};this.prefixStyleNames=function(a,b,c){var d;if(a){for(d=a.firstChild;d;){if(d.nodeType===Node.ELEMENT_NODE){var e=d,l=b,h=e.getAttributeNS(k,"name"),g=void 0;
h?g=k:(h=e.getAttributeNS(v,"name"))&&(g=v);g&&e.setAttributeNS(g,C[g]+"name",l+h)}d=d.nextSibling}f(a,b);c&&f(c,b)}};this.removePrefixFromStyleNames=function(a,b,c){var d=RegExp("^"+b);if(a){for(b=a.firstChild;b;){if(b.nodeType===Node.ELEMENT_NODE){var e=b,f=d,l=e.getAttributeNS(k,"name"),h=void 0;l?h=k:(l=e.getAttributeNS(v,"name"))&&(h=v);h&&(l=l.replace(f,""),e.setAttributeNS(h,C[h]+"name",l))}b=b.nextSibling}g(a,d);c&&g(c,d)}};this.determineStylesForNode=d;A=function(){var a,b,c,d,e,k={},f,l,
h,g;for(c in I)if(I.hasOwnProperty(c))for(d=I[c],b=d.length,a=0;a<b;a+=1)e=d[a],h=e.en,g=e.ens,k.hasOwnProperty(h)?f=k[h]:k[h]=f={},f.hasOwnProperty(g)?l=f[g]:f[g]=l=[],l.push({ns:e.ans,localname:e.a,keyname:c});return k}()};"function"!==typeof Object.create&&(Object.create=function(f){var g=function(){};g.prototype=f;return new g});
xmldom.LSSerializer=function(){function f(c){var d=c||{},f=function(c){var b={},a;for(a in c)c.hasOwnProperty(a)&&(b[c[a]]=a);return b}(c),g=[d],q=[f],n=0;this.push=function(){n+=1;d=g[n]=Object.create(d);f=q[n]=Object.create(f)};this.pop=function(){g.pop();q.pop();n-=1;d=g[n];f=q[n]};this.getLocalNamespaceDefinitions=function(){return f};this.getQName=function(c){var b=c.namespaceURI,a=0,e;if(!b)return c.localName;if(e=f[b])return e+":"+c.localName;do{e||!c.prefix?(e="ns"+a,a+=1):e=c.prefix;if(d[e]===
b)break;if(!d[e]){d[e]=b;f[b]=e;break}e=null}while(null===e);return e+":"+c.localName}}function g(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function d(e,f){var h="",p=c.filter?c.filter.acceptNode(f):NodeFilter.FILTER_ACCEPT,q;if(p===NodeFilter.FILTER_ACCEPT&&f.nodeType===Node.ELEMENT_NODE){e.push();q=e.getQName(f);var n,r=f.attributes,b,a,l,k="",t;n="<"+q;b=r.length;for(a=0;a<b;a+=1)l=r.item(a),"http://www.w3.org/2000/xmlns/"!==
l.namespaceURI&&(t=c.filter?c.filter.acceptNode(l):NodeFilter.FILTER_ACCEPT,t===NodeFilter.FILTER_ACCEPT&&(t=e.getQName(l),l="string"===typeof l.value?g(l.value):l.value,k+=" "+(t+'="'+l+'"')));b=e.getLocalNamespaceDefinitions();for(a in b)b.hasOwnProperty(a)&&((r=b[a])?"xmlns"!==r&&(n+=" xmlns:"+b[a]+'="'+a+'"'):n+=' xmlns="'+a+'"');h+=n+(k+">")}if(p===NodeFilter.FILTER_ACCEPT||p===NodeFilter.FILTER_SKIP){for(p=f.firstChild;p;)h+=d(e,p),p=p.nextSibling;f.nodeValue&&(h+=g(f.nodeValue))}q&&(h+="</"+
q+">",e.pop());return h}var c=this;this.filter=null;this.writeToString=function(c,g){if(!c)return"";var h=new f(g);return d(h,c)}};(function(){function f(c){var b,a=p.length;for(b=0;b<a;b+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===c.namespaceURI&&c.localName===p[b])return b;return-1}function g(c,b){var a=new e.UsedStyleList(c,b),d=new odf.OdfNodeFilter;this.acceptNode=function(c){var e=d.acceptNode(c);e===NodeFilter.FILTER_ACCEPT&&c.parentNode===b&&c.nodeType===Node.ELEMENT_NODE&&(e=a.uses(c)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return e}}function d(c,b){var a=new g(c,b);this.acceptNode=function(b){var c=
a.acceptNode(b);c!==NodeFilter.FILTER_ACCEPT||!b.parentNode||b.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==b.parentNode.localName&&"tab"!==b.parentNode.localName||(c=NodeFilter.FILTER_REJECT);return c}}function c(c,b){if(b){var a=f(b),d,e=c.firstChild;if(-1!==a){for(;e;){d=f(e);if(-1!==d&&d>a)break;e=e.nextSibling}c.insertBefore(b,e)}}}var e=new odf.StyleInfo,m=new core.DomUtils,h=odf.Namespaces.stylens,p="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),
q=Date.now()+"_webodf_",n=new core.Base64;odf.ODFElement=function(){};odf.ODFDocumentElement=function(){};odf.ODFDocumentElement.prototype=new odf.ODFElement;odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement;odf.ODFDocumentElement.prototype.fontFaceDecls=null;odf.ODFDocumentElement.prototype.manifest=null;odf.ODFDocumentElement.prototype.settings=null;odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";odf.ODFDocumentElement.localName="document";
odf.AnnotationElement=function(){};odf.OdfPart=function(c,b,a,d){var e=this;this.size=0;this.type=null;this.name=c;this.container=a;this.url=null;this.mimetype=b;this.onstatereadychange=this.document=null;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;this.data="";this.load=function(){null!==d&&(this.mimetype=b,d.loadAsDataURL(c,b,function(a,b){a&&runtime.log(a);e.url=b;if(e.onchange)e.onchange(e);if(e.onstatereadychange)e.onstatereadychange(e)}))}};odf.OdfPart.prototype.load=function(){};
odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+n.toBase64(this.data):null};odf.OdfContainer=function b(a,f){function k(a){for(var b=a.firstChild,c;b;)c=b.nextSibling,b.nodeType===Node.ELEMENT_NODE?k(b):b.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&a.removeChild(b),b=c}function p(a){var b={},c,d,e=a.ownerDocument.createNodeIterator(a,NodeFilter.SHOW_ELEMENT,null,!1);for(a=e.nextNode();a;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&("annotation"===
a.localName?(c=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(b.hasOwnProperty(c)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+c+"'"):b[c]=a):"annotation-end"===a.localName&&((c=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?b.hasOwnProperty(c)?(d=b[c],d.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+c+"'"):d.annotationEndElement=
a):runtime.log("Warning: annotation end without an annotation start, name: '"+c+"'"):runtime.log("Warning: annotation end without a name found"))),a=e.nextNode()}function s(a,b){for(var c=a&&a.firstChild;c;)c.nodeType===Node.ELEMENT_NODE&&c.setAttributeNS("urn:webodf:names:scope","scope",b),c=c.nextSibling}function w(a,b){for(var c=T.rootElement.meta,c=c&&c.firstChild;c&&(c.namespaceURI!==a||c.localName!==b);)c=c.nextSibling;for(c=c&&c.firstChild;c&&c.nodeType!==Node.TEXT_NODE;)c=c.nextSibling;return c?
c.data:null}function x(a){var b={},c;for(a=a.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&a.namespaceURI===h&&"font-face"===a.localName&&(c=a.getAttributeNS(h,"name"),b[c]=a),a=a.nextSibling;return b}function v(a,b){var c=null,d,e,k;if(a)for(c=a.cloneNode(!0),d=c.firstElementChild;d;)e=d.nextElementSibling,(k=d.getAttributeNS("urn:webodf:names:scope","scope"))&&k!==b&&c.removeChild(d),d=e;return c}function z(a,b){var c,d,k,f=null,l={};if(a)for(b.forEach(function(a){e.collectUsedFontFaces(l,a)}),
f=a.cloneNode(!0),c=f.firstElementChild;c;)d=c.nextElementSibling,k=c.getAttributeNS(h,"name"),l[k]||f.removeChild(c),c=d;return f}function u(a){var b=T.rootElement.ownerDocument,c;if(a){k(a.documentElement);try{c=b.importNode(a.documentElement,!0)}catch(d){}}return c}function C(a){T.state=a;if(T.onchange)T.onchange(T);if(T.onstatereadychange)T.onstatereadychange(T)}function I(a){L=null;T.rootElement=a;a.fontFaceDecls=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");
a.styles=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");a.automaticStyles=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");a.masterStyles=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");a.body=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");a.meta=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta");a.settings=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"settings");a.scripts=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts");p(a)}function A(a){var d=u(a),k=T.rootElement,f;d&&"document-styles"===d.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===d.namespaceURI?(k.fontFaceDecls=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),c(k,k.fontFaceDecls),f=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),k.styles=f||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"styles"),c(k,k.styles),f=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),k.automaticStyles=f||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),s(k.automaticStyles,"document-styles"),c(k,k.automaticStyles),d=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),k.masterStyles=d||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),c(k,k.masterStyles),
e.prefixStyleNames(k.automaticStyles,q,k.masterStyles)):C(b.INVALID)}function K(a){a=u(a);var d,k,f,l;if(a&&"document-content"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI){d=T.rootElement;f=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");if(d.fontFaceDecls&&f){l=d.fontFaceDecls;var g,A,n,p,q={};k=x(l);p=x(f);for(f=f.firstElementChild;f;){g=f.nextElementSibling;if(f.namespaceURI===h&&"font-face"===f.localName)if(A=f.getAttributeNS(h,
"name"),k.hasOwnProperty(A)){if(!f.isEqualNode(k[A])){n=A;for(var t=k,U=p,K=0,J=void 0,J=n=n.replace(/\d+$/,"");t.hasOwnProperty(J)||U.hasOwnProperty(J);)K+=1,J=n+K;n=J;f.setAttributeNS(h,"style:name",n);l.appendChild(f);k[n]=f;delete p[A];q[A]=n}}else l.appendChild(f),k[A]=f,delete p[A];f=g}l=q}else f&&(d.fontFaceDecls=f,c(d,f));k=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");s(k,"document-content");l&&e.changeFontFaceNames(k,l);if(d.automaticStyles&&k)for(l=
k.firstChild;l;)d.automaticStyles.appendChild(l),l=k.firstChild;else k&&(d.automaticStyles=k,c(d,k));a=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");if(null===a)throw"<office:body/> tag is mising.";d.body=a;c(d,d.body)}else C(b.INVALID)}function J(a){a=u(a);var b;a&&"document-meta"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(b=T.rootElement,b.meta=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),
c(b,b.meta))}function H(a){a=u(a);var b;a&&"document-settings"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(b=T.rootElement,b.settings=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),c(b,b.settings))}function U(a){a=u(a);var b;if(a&&"manifest"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI)for(b=T.rootElement,b.manifest=a,a=b.manifest.firstElementChild;a;)"file-entry"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===
a.namespaceURI&&(V[a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),a=a.nextElementSibling}function W(a,b,c){a=m.getElementsByTagName(a,b);var d;for(d=0;d<a.length;d+=1)b=a[d],c.hasOwnProperty(b.namespaceURI)||b.parentNode.removeChild(b)}function E(a){W(a,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,
"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0});W(a,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function aa(a){var b=a.firstElementChild,c=[],d,e,k,f=a.attributes,l=f.length;for(d=0;d<l;d+=1)k=f.item(d),e=k.localName.substr(0,2).toLowerCase(),null===k.namespaceURI&&"on"===e&&c.push(k);l=c.length;for(d=
0;d<l;d+=1)a.removeAttributeNode(c[d]);for(;b;)aa(b),b=b.nextElementSibling}function O(a){var c=a.shift();c?Q.loadAsDOM(c.path,function(d,e){e&&(E(e),aa(e.documentElement));c.handler(e);T.state===b.INVALID?d?runtime.log("ERROR: Unable to load "+c.path+" - "+d):runtime.log("ERROR: Unable to load "+c.path):(d&&runtime.log("DEBUG: Unable to load "+c.path+" - "+d),O(a))}):(p(T.rootElement),C(b.DONE))}function B(){O([{path:"styles.xml",handler:A},{path:"content.xml",handler:K},{path:"meta.xml",handler:J},
{path:"settings.xml",handler:H},{path:"META-INF/manifest.xml",handler:U}])}function X(a){var b="";odf.Namespaces.forEachPrefix(function(a,c){b+=" xmlns:"+a+'="'+c+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+a+" "+b+' office:version="1.2">'}function fa(){var a=new xmldom.LSSerializer,b=X("document-meta");a.filter=new odf.OdfNodeFilter;b+=a.writeToString(T.rootElement.meta,odf.Namespaces.namespaceMap);return b+"</office:document-meta>"}function ha(a,b){var c=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0",
"manifest:file-entry");c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",a);c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",b);return c}function Z(){var a=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),b=a.documentElement,c=new xmldom.LSSerializer,d;for(d in V)V.hasOwnProperty(d)&&b.appendChild(ha(d,V[d]));c.filter=
new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+c.writeToString(a,odf.Namespaces.namespaceMap)}function D(){var a,b,c,d=odf.Namespaces.namespaceMap,k=new xmldom.LSSerializer,f=X("document-styles");b=v(T.rootElement.automaticStyles,"document-styles");c=T.rootElement.masterStyles.cloneNode(!0);a=z(T.rootElement.fontFaceDecls,[c,T.rootElement.styles,b]);e.removePrefixFromStyleNames(b,q,c);k.filter=new g(c,b);f+=k.writeToString(a,d);f+=k.writeToString(T.rootElement.styles,
d);f+=k.writeToString(b,d);f+=k.writeToString(c,d);return f+"</office:document-styles>"}function S(){var a,b,c=odf.Namespaces.namespaceMap,e=new xmldom.LSSerializer,k=X("document-content");b=v(T.rootElement.automaticStyles,"document-content");a=z(T.rootElement.fontFaceDecls,[b]);e.filter=new d(T.rootElement.body,b);k+=e.writeToString(a,c);k+=e.writeToString(b,c);k+=e.writeToString(T.rootElement.body,c);return k+"</office:document-content>"}function y(a,c){runtime.loadXML(a,function(a,d){if(a)c(a);
else if(d){E(d);aa(d.documentElement);var e=u(d);e&&"document"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI?(I(e),C(b.DONE)):C(b.INVALID)}else c("No DOM was loaded.")})}function P(a,b){var d;d=T.rootElement;var e=d.meta;e||(d.meta=e=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),c(d,e));d=e;a&&m.mapKeyValObjOntoNode(d,a,odf.Namespaces.lookupNamespaceURI);b&&m.removeKeyElementsFromNode(d,b,odf.Namespaces.lookupNamespaceURI)}
function M(a){function c(a,b){var d;b||(b=a);d=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",b);k[a]=d;k.appendChild(d)}var d=new core.Zip("",null),e=runtime.byteArrayFromString("application/vnd.oasis.opendocument."+a,"utf8"),k=T.rootElement,f=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",a);d.save("mimetype",e,!1,new Date);c("meta");c("settings");c("scripts");c("fontFaceDecls","font-face-decls");c("styles");c("automaticStyles","automatic-styles");
c("masterStyles","master-styles");c("body");k.body.appendChild(f);V["/"]="application/vnd.oasis.opendocument."+a;V["settings.xml"]="text/xml";V["meta.xml"]="text/xml";V["styles.xml"]="text/xml";V["content.xml"]="text/xml";C(b.DONE);return d}function Y(a){var b=new core.Zip("",null);a=a.files;var c,d;for(c in a)a.hasOwnProperty(c)&&(d="string"===typeof a[c]?runtime.byteArrayFromString(a[c],"utf8"):a[c],b.save(c,d,!1,new Date));return b}function N(){var a,b=new Date,c="";T.rootElement.settings&&T.rootElement.settings.firstElementChild&&
(a=new xmldom.LSSerializer,c=X("document-settings"),a.filter=new odf.OdfNodeFilter,c+=a.writeToString(T.rootElement.settings,odf.Namespaces.namespaceMap),c+="</office:document-settings>");(a=c)?(a=runtime.byteArrayFromString(a,"utf8"),Q.save("settings.xml",a,!0,b)):Q.remove("settings.xml");c=runtime.getWindow();a="WebODF/"+webodf.Version;c&&(a=a+" "+c.navigator.userAgent);P({"meta:generator":a},null);a=runtime.byteArrayFromString(fa(),"utf8");Q.save("meta.xml",a,!0,b);a=runtime.byteArrayFromString(D(),
"utf8");Q.save("styles.xml",a,!0,b);a=runtime.byteArrayFromString(S(),"utf8");Q.save("content.xml",a,!0,b);a=runtime.byteArrayFromString(Z(),"utf8");Q.save("META-INF/manifest.xml",a,!0,b)}function ca(a,b){N();Q.writeAs(a,function(a){b(a)})}var T=this,Q,V={},L,ia="",$={};this.onstatereadychange=f;this.state=this.onchange=null;this.getMetadata=w;this.setRootElement=I;this.getContentElement=function(){var a;L||(a=T.rootElement.body,L=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"text")||m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet"));if(!L)throw"Could not find content element in <office:body/>.";return L};this.getDocumentType=function(){var a=T.getContentElement();return a&&a.localName};this.getPart=function(a){return new odf.OdfPart(a,V[a],T,Q)};this.getPartData=function(a,b){Q.load(a,b)};this.setMetadata=P;this.incrementEditingCycles=function(){var a=
w(odf.Namespaces.metans,"editing-cycles"),a=a?parseInt(a,10):0;isNaN(a)&&(a=0);P({"meta:editing-cycles":a+1},null);return a+1};this.createByteArray=function(a,b){N();Q.createByteArray(a,b)};this.saveAs=ca;this.save=function(a){ca(ia,a)};this.getUrl=function(){return ia};this.setBlob=function(a,b,c){c=n.convertBase64ToByteArray(c);Q.save(a,c,!1,new Date);V.hasOwnProperty(a)&&runtime.log(a+" has been overwritten.");V[a]=b};this.removeBlob=function(a){var b=Q.remove(a);runtime.assert(b,"file is not found: "+
a);delete V[a]};this.state=b.LOADING;this.rootElement=function(a){var b=document.createElementNS(a.namespaceURI,a.localName),c;a=new a.Type;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName});a===odf.OdfContainer.DocumentType.TEXT?Q=M("text"):a===odf.OdfContainer.DocumentType.PRESENTATION?Q=M("presentation"):a===odf.OdfContainer.DocumentType.SPREADSHEET?Q=M("spreadsheet"):($=
a,$.type===odf.OdfContainer.DocumentType.OOX?(Q=Y($),B()):(ia=a,Q=new core.Zip(ia,function(a,c){Q=c;a?y(ia,function(c){a&&(Q.error=a+"\n"+c,C(b.INVALID))}):B()})))};odf.OdfContainer.EMPTY=0;odf.OdfContainer.LOADING=1;odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=5;odf.OdfContainer.getContainer=function(b){return new odf.OdfContainer(b,null)}})();odf.OdfContainer.DocumentType={TEXT:1,PRESENTATION:2,SPREADSHEET:3,OOX:4};odf.OdfUtils=function(){function f(a){return"image"===(a&&a.localName)&&a.namespaceURI===aa}function g(a){return null!==a&&a.nodeType===Node.ELEMENT_NODE&&"frame"===a.localName&&a.namespaceURI===aa&&"as-char"===a.getAttributeNS(E,"anchor-type")}function d(a){var b;(b="annotation"===(a&&a.localName)&&a.namespaceURI===odf.Namespaces.officens)||(b="div"===(a&&a.localName)&&"annotationWrapper"===a.className);return b}function c(a){return"a"===(a&&a.localName)&&a.namespaceURI===E}function e(a){var b=a&&
a.localName;return("p"===b||"h"===b)&&a.namespaceURI===E}function m(a,b){for(a&&void 0!==b&&!e(a)&&a.childNodes.item(b)&&(a=a.childNodes.item(b));a&&!e(a);)a=a.parentNode;return a}function h(a,b){for(;a&&a!==b;){if(a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName)return a;a=a.parentElement}return null}function p(a){return/^[ \t\r\n]+$/.test(a)}function q(a){if(null===a||a.nodeType!==Node.ELEMENT_NODE)return!1;var b=a.localName;return/^(span|p|h|a|meta)$/.test(b)&&a.namespaceURI===
E||"span"===b&&"webodf-annotationHighlight"===a.className}function n(a){var b=a&&a.localName,c=!1;b&&(a=a.namespaceURI,a===E&&(c="s"===b||"tab"===b||"line-break"===b));return c}function r(a){return n(a)||g(a)||d(a)}function b(a){var b=a&&a.localName,c=!1;b&&(a=a.namespaceURI,a===E&&(c="s"===b));return c}function a(a){return-1!==fa.indexOf(a.namespaceURI)}function l(b){if(n(b))return!1;if(a(b.parentNode)&&b.nodeType===Node.TEXT_NODE)return 0===b.textContent.length;for(b=b.firstChild;b;){if(a(b)||!l(b))return!1;
b=b.nextSibling}return!0}function k(a){for(;null!==a.firstChild&&q(a);)a=a.firstChild;return a}function t(a){for(;null!==a.lastChild&&q(a);)a=a.lastChild;return a}function s(a){for(;!e(a)&&null===a.previousSibling;)a=a.parentNode;return e(a)?null:t(a.previousSibling)}function w(a){for(;!e(a)&&null===a.nextSibling;)a=a.parentNode;return e(a)?null:k(a.nextSibling)}function x(a){for(var c=!1;a;)if(a.nodeType===Node.TEXT_NODE)if(0===a.length)a=s(a);else return!p(a.data.substr(a.length-1,1));else r(a)?
(c=!1===b(a),a=null):a=s(a);return c}function v(a){var b=!1,c;for(a=a&&k(a);a;){c=a.nodeType===Node.TEXT_NODE?a.length:0;if(0<c&&!p(a.data)){b=!0;break}if(r(a)){b=!0;break}a=w(a)}return b}function z(a,b){return p(a.data.substr(b))?!v(w(a)):!1}function u(a,b){var c=a.data,d;if(!p(c[b])||r(a.parentNode))return!1;0<b?p(c[b-1])||(d=!0):x(s(a))&&(d=!0);return!0===d?z(a,b)?!1:!0:!1}function C(a){return(a=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(a))?
{value:parseFloat(a[1]),unit:a[3]}:null}function I(a){return(a=C(a))&&(0>a.value||"%"===a.unit)?null:a}function A(a){return(a=C(a))&&"%"!==a.unit?null:a}function K(a){switch(a.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(a.localName){case "note-body":case "ruby-text":return!1}break;case odf.Namespaces.officens:switch(a.localName){case "annotation":case "binary-data":case "event-listeners":return!1}break;default:switch(a.localName){case "cursor":case "editinfo":return!1}}return!0}
function J(a,b){for(;0<b.length&&!X.rangeContainsNode(a,b[0]);)b.shift();for(;0<b.length&&!X.rangeContainsNode(a,b[b.length-1]);)b.pop()}function H(a,b,c){var e;e=X.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;if(n(a.parentNode)||d(a))b=NodeFilter.FILTER_REJECT;else if(a.nodeType===Node.TEXT_NODE){if(c||Boolean(m(a)&&(!p(a.textContent)||u(a,0))))b=NodeFilter.FILTER_ACCEPT}else if(r(a))b=NodeFilter.FILTER_ACCEPT;else if(K(a)||q(a))b=NodeFilter.FILTER_SKIP;return b},NodeFilter.SHOW_ELEMENT|
NodeFilter.SHOW_TEXT);b||J(a,e);return e}function U(a,b,c){for(;a;){if(c(a)){b[0]!==a&&b.unshift(a);break}if(d(a))break;a=a.parentNode}}function W(a,b){var c=a;if(b<c.childNodes.length-1)c=c.childNodes[b+1];else{for(;!c.nextSibling;)c=c.parentNode;c=c.nextSibling}for(;c.firstChild;)c=c.firstChild;return c}var E=odf.Namespaces.textns,aa=odf.Namespaces.drawns,O=odf.Namespaces.xlinkns,B=/^\s*$/,X=new core.DomUtils,fa=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,
odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns];this.isImage=f;this.isCharacterFrame=g;this.isInlineRoot=d;this.isTextSpan=function(a){return"span"===(a&&a.localName)&&a.namespaceURI===E};this.isHyperlink=c;this.getHyperlinkTarget=function(a){return a.getAttributeNS(O,"href")||""};this.isParagraph=e;this.getParagraphElement=m;this.isWithinTrackedChanges=
function(a,b){for(;a&&a!==b;){if(a.namespaceURI===E&&"tracked-changes"===a.localName)return!0;a=a.parentNode}return!1};this.getParentAnnotation=h;this.isWithinAnnotation=function(a,b){return Boolean(h(a,b))};this.getAnnotationCreator=function(a){return a.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent};this.isListItem=function(a){return"list-item"===(a&&a.localName)&&a.namespaceURI===E};this.isLineBreak=function(a){return"line-break"===(a&&a.localName)&&a.namespaceURI===E};this.isODFWhitespace=
p;this.isGroupingElement=q;this.isCharacterElement=n;this.isAnchoredAsCharacterElement=r;this.isSpaceElement=b;this.isODFNode=a;this.hasNoODFContent=l;this.firstChild=k;this.lastChild=t;this.previousNode=s;this.nextNode=w;this.scanLeftForNonSpace=x;this.lookLeftForCharacter=function(a){var b,c=b=0;a.nodeType===Node.TEXT_NODE&&(c=a.length);0<c?(b=a.data,b=p(b.substr(c-1,1))?1===c?x(s(a))?2:0:p(b.substr(c-2,1))?0:2:1):r(a)&&(b=1);return b};this.lookRightForCharacter=function(a){var b=!1,c=0;a&&a.nodeType===
Node.TEXT_NODE&&(c=a.length);0<c?b=!p(a.data.substr(0,1)):r(a)&&(b=!0);return b};this.scanLeftForAnyCharacter=function(a){var b=!1,c;for(a=a&&t(a);a;){c=a.nodeType===Node.TEXT_NODE?a.length:0;if(0<c&&!p(a.data)){b=!0;break}if(r(a)){b=!0;break}a=s(a)}return b};this.scanRightForAnyCharacter=v;this.isTrailingWhitespace=z;this.isSignificantWhitespace=u;this.isDowngradableSpaceElement=function(a){return b(a)?x(s(a))&&v(w(a)):!1};this.getFirstNonWhitespaceChild=function(a){for(a=a&&a.firstChild;a&&a.nodeType===
Node.TEXT_NODE&&B.test(a.nodeValue);)a=a.nextSibling;return a};this.parseLength=C;this.parseNonNegativeLength=I;this.parseFoFontSize=function(a){var b;b=(b=C(a))&&(0>=b.value||"%"===b.unit)?null:b;return b||A(a)};this.parseFoLineHeight=function(a){return I(a)||A(a)};this.isTextContentContainingNode=K;this.getTextNodes=function(a,b){var c;c=X.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;a.nodeType===Node.TEXT_NODE?Boolean(m(a)&&(!p(a.textContent)||u(a,0)))&&(b=NodeFilter.FILTER_ACCEPT):
K(a)&&(b=NodeFilter.FILTER_SKIP);return b},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);b||J(a,c);return c};this.getTextElements=H;this.getParagraphElements=function(a){var b;b=X.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;if(e(a))b=NodeFilter.FILTER_ACCEPT;else if(K(a)||q(a))b=NodeFilter.FILTER_SKIP;return b},NodeFilter.SHOW_ELEMENT);U(a.startContainer,b,e);return b};this.getImageElements=function(a){var b;b=X.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_SKIP;f(a)&&(b=
NodeFilter.FILTER_ACCEPT);return b},NodeFilter.SHOW_ELEMENT);U(a.startContainer,b,f);return b};this.getHyperlinkElements=function(a){var b=[],d=a.cloneRange();a.collapsed&&a.endContainer.nodeType===Node.ELEMENT_NODE&&(a=W(a.endContainer,a.endOffset),a.nodeType===Node.TEXT_NODE&&d.setEnd(a,1));H(d,!0,!1).forEach(function(a){for(a=a.parentNode;!e(a);){if(c(a)&&-1===b.indexOf(a)){b.push(a);break}a=a.parentNode}});d.detach();return b};this.getNormalizedFontFamilyName=function(a){/^(["'])(?:.|[\n\r])*?\1$/.test(a)||
(a=a.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(a)&&(a="'"+a.replace(/[ \t\r\n\f]+/g," ")+"'"));return a}};gui.AnnotatableCanvas=function(){};gui.AnnotatableCanvas.prototype.refreshSize=function(){};gui.AnnotatableCanvas.prototype.getZoomLevel=function(){};gui.AnnotatableCanvas.prototype.getSizer=function(){};
gui.AnnotationViewManager=function(f,g,d,c){function e(a){var b=a.annotationEndElement,c=n.createRange(),d=a.getAttributeNS(odf.Namespaces.officens,"name");b&&(c.setStart(a,a.childNodes.length),c.setEnd(b,0),a=r.getTextNodes(c,!1),a.forEach(function(a){var b=n.createElement("span");b.className="webodf-annotationHighlight";b.setAttribute("annotation",d);a.parentNode.insertBefore(b,a);b.appendChild(a)}));c.detach()}function m(a){var c=f.getSizer();a?(d.style.display="inline-block",c.style.paddingRight=
b.getComputedStyle(d).width):(d.style.display="none",c.style.paddingRight=0);f.refreshSize()}function h(){q.sort(function(a,b){return 0!==(a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function p(){var a;for(a=0;a<q.length;a+=1){var b=q[a],c=b.parentNode,e=c.nextElementSibling,h=e.nextElementSibling,g=c.parentNode,m=0,m=q[q.indexOf(b)-1],r=void 0,b=f.getZoomLevel();c.style.left=(d.getBoundingClientRect().left-g.getBoundingClientRect().left)/b+"px";c.style.width=d.getBoundingClientRect().width/
b+"px";e.style.width=parseFloat(c.style.left)-30+"px";m&&(r=m.parentNode.getBoundingClientRect(),20>=(g.getBoundingClientRect().top-r.bottom)/b?c.style.top=Math.abs(g.getBoundingClientRect().top-r.bottom)/b+20+"px":c.style.top="0px");h.style.left=e.getBoundingClientRect().width/b+"px";var e=h.style,g=h.getBoundingClientRect().left/b,m=h.getBoundingClientRect().top/b,r=c.getBoundingClientRect().left/b,n=c.getBoundingClientRect().top/b,p=0,C=0,p=r-g,p=p*p,C=n-m,C=C*C,g=Math.sqrt(p+C);e.width=g+"px";
m=Math.asin((c.getBoundingClientRect().top-h.getBoundingClientRect().top)/(b*parseFloat(h.style.width)));h.style.transform="rotate("+m+"rad)";h.style.MozTransform="rotate("+m+"rad)";h.style.WebkitTransform="rotate("+m+"rad)";h.style.msTransform="rotate("+m+"rad)"}}var q=[],n=g.ownerDocument,r=new odf.OdfUtils,b=runtime.getWindow();runtime.assert(Boolean(b),"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=p;this.getMinimumHeightForAnnotationPane=
function(){return"none"!==d.style.display&&0<q.length?(q[q.length-1].parentNode.getBoundingClientRect().bottom-d.getBoundingClientRect().top)/f.getZoomLevel()+"px":null};this.addAnnotation=function(a){m(!0);q.push(a);h();var b=n.createElement("div"),d=n.createElement("div"),f=n.createElement("div"),g=n.createElement("div"),w;b.className="annotationWrapper";b.setAttribute("creator",r.getAnnotationCreator(a));a.parentNode.insertBefore(b,a);d.className="annotationNote";d.appendChild(a);c&&(w=n.createElement("div"),
w.className="annotationRemoveButton",d.appendChild(w));f.className="annotationConnector horizontal";g.className="annotationConnector angular";b.appendChild(d);b.appendChild(f);b.appendChild(g);a.annotationEndElement&&e(a);p()};this.forgetAnnotations=function(){for(;q.length;){var a=q[0],b=q.indexOf(a),c=a.parentNode.parentNode;"div"===c.localName&&(c.parentNode.insertBefore(a,c),c.parentNode.removeChild(c));for(var a=a.getAttributeNS(odf.Namespaces.officens,"name"),a=n.querySelectorAll('span.webodf-annotationHighlight[annotation="'+
a+'"]'),d=c=void 0,c=0;c<a.length;c+=1){for(d=a.item(c);d.firstChild;)d.parentNode.insertBefore(d.firstChild,d);d.parentNode.removeChild(d)}-1!==b&&q.splice(b,1);0===q.length&&m(!1)}}};(function(){function f(d,g,h,p,q){var n,r=0,b;for(b in d)if(d.hasOwnProperty(b)){if(r===h){n=b;break}r+=1}n?g.getPartData(d[n].href,function(a,b){if(a)runtime.log(a);else if(b){var k="@font-face { font-family: "+(d[n].family||n)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+c.convertUTF8ArrayToBase64(b)+') format("truetype"); }';try{p.insertRule(k,p.cssRules.length)}catch(r){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(r)+"\nRule: "+k)}}else runtime.log("missing font data for "+
d[n].href);f(d,g,h+1,p,q)}):q&&q()}var g=xmldom.XPath,d=new odf.OdfUtils,c=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(c,m){for(var h=c.rootElement.fontFaceDecls;m.cssRules.length;)m.deleteRule(m.cssRules.length-1);if(h){var p={},q,n,r,b;if(h)for(h=g.getODFElementsWithXPath(h,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),q=0;q<h.length;q+=1)n=h[q],r=n.getAttributeNS(odf.Namespaces.stylens,"name"),b=d.getNormalizedFontFamilyName(n.getAttributeNS(odf.Namespaces.svgns,
"font-family")),n=g.getODFElementsWithXPath(n,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<n.length&&(n=n[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),p[r]={href:n,family:b});f(p,c,0,m)}}}})();odf.Formatting=function(){function f(a){return(a=C[a])?z.mergeObjects({},a):{}}function g(){for(var a=b.rootElement.fontFaceDecls,c={},d,e,a=a&&a.firstElementChild;a;){if(d=a.getAttributeNS(k,"name"))if((e=a.getAttributeNS(l,"font-family"))||0<a.getElementsByTagNameNS(l,"font-face-uri").length)c[d]=e;a=a.nextElementSibling}return c}function d(a){for(var c=b.rootElement.styles.firstElementChild;c;){if(c.namespaceURI===k&&"default-style"===c.localName&&c.getAttributeNS(k,"family")===a)return c;c=c.nextElementSibling}return null}
function c(a,c,d){var e,f,h;d=d||[b.rootElement.automaticStyles,b.rootElement.styles];for(h=0;h<d.length;h+=1)for(e=d[h],e=e.firstElementChild;e;){f=e.getAttributeNS(k,"name");if(e.namespaceURI===k&&"style"===e.localName&&e.getAttributeNS(k,"family")===c&&f===a||"list-style"===c&&e.namespaceURI===t&&"list-style"===e.localName&&f===a||"data"===c&&e.namespaceURI===s&&f===a)return e;e=e.nextElementSibling}return null}function e(a){for(var b,c,d,e,f={},h=a.firstElementChild;h;){if(h.namespaceURI===k)for(d=
f[h.nodeName]={},c=h.attributes,b=0;b<c.length;b+=1)e=c.item(b),d[e.name]=e.value;h=h.nextElementSibling}c=a.attributes;for(b=0;b<c.length;b+=1)e=c.item(b),f[e.name]=e.value;return f}function m(a,h){for(var l=b.rootElement.styles,g,m={},r=a.getAttributeNS(k,"family"),n=a;n;)g=e(n),m=z.mergeObjects(g,m),n=(g=n.getAttributeNS(k,"parent-style-name"))?c(g,r,[l]):null;if(n=d(r))g=e(n),m=z.mergeObjects(g,m);!1!==h&&(g=f(r),m=z.mergeObjects(g,m));return m}function h(b,c){function d(a){Object.keys(a).forEach(function(b){Object.keys(a[b]).forEach(function(a){h+=
"|"+b+":"+a+"|"})})}for(var e=b.nodeType===Node.TEXT_NODE?b.parentNode:b,k,f=[],h="",l=!1;e;)!l&&x.isGroupingElement(e)&&(l=!0),(k=a.determineStylesForNode(e))&&f.push(k),e=e.parentNode;l&&(f.forEach(d),c&&(c[h]=f));return l?f:void 0}function p(a){var d={orderedStyles:[]};a.forEach(function(a){Object.keys(a).forEach(function(e){var f=Object.keys(a[e])[0],h={name:f,family:e,displayName:void 0,isCommonStyle:!1},l;(l=c(f,e))?(e=m(l),d=z.mergeObjects(e,d),h.displayName=l.getAttributeNS(k,"display-name")||
void 0,h.isCommonStyle=l.parentNode===b.rootElement.styles):runtime.log("No style element found for '"+f+"' of family '"+e+"'");d.orderedStyles.push(h)})});return d}function q(a,b){var c={},d=[];b||(b={});a.forEach(function(a){h(a,c)});Object.keys(c).forEach(function(a){b[a]||(b[a]=p(c[a]));d.push(b[a])});return d}function n(a){for(var c=b.rootElement.masterStyles.firstElementChild;c&&(c.namespaceURI!==k||"master-page"!==c.localName||c.getAttributeNS(k,"name")!==a);)c=c.nextElementSibling;return c}
function r(a,b){var c;a&&(c=u.convertMeasure(a,"px"));void 0===c&&b&&(c=u.convertMeasure(b,"px"));return c}var b,a=new odf.StyleInfo,l=odf.Namespaces.svgns,k=odf.Namespaces.stylens,t=odf.Namespaces.textns,s=odf.Namespaces.numberns,w=odf.Namespaces.fons,x=new odf.OdfUtils,v=new core.DomUtils,z=new core.Utils,u=new core.CSSUnits,C={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=f;this.setOdfContainer=function(a){b=a};this.getFontMap=g;this.getAvailableParagraphStyles=
function(){for(var a=b.rootElement.styles,c,d,e=[],a=a&&a.firstElementChild;a;)"style"===a.localName&&a.namespaceURI===k&&(c=a.getAttributeNS(k,"family"),"paragraph"===c&&(c=a.getAttributeNS(k,"name"),d=a.getAttributeNS(k,"display-name")||c,c&&d&&e.push({name:c,displayName:d}))),a=a.nextElementSibling;return e};this.isStyleUsed=function(c){var d,e=b.rootElement;d=a.hasDerivedStyles(e,odf.Namespaces.lookupNamespaceURI,c);c=(new a.UsedStyleList(e.styles)).uses(c)||(new a.UsedStyleList(e.automaticStyles)).uses(c)||
(new a.UsedStyleList(e.body)).uses(c);return d||c};this.getDefaultStyleElement=d;this.getStyleElement=c;this.getStyleAttributes=e;this.getInheritedStyleAttributes=m;this.getFirstCommonParentStyleNameOrSelf=function(a){var d=b.rootElement.styles,e;if(e=c(a,"paragraph",[b.rootElement.automaticStyles]))if(a=e.getAttributeNS(k,"parent-style-name"),!a)return null;return(e=c(a,"paragraph",[d]))?a:null};this.hasParagraphStyle=function(a){return Boolean(c(a,"paragraph"))};this.getAppliedStyles=q;this.getAppliedStylesForElement=
function(a,b){return q([a],b)[0]};this.updateStyle=function(a,c){var d,e;v.mapObjOntoNode(a,c,odf.Namespaces.lookupNamespaceURI);(d=c["style:text-properties"]&&c["style:text-properties"]["style:font-name"])&&!g().hasOwnProperty(d)&&(e=a.ownerDocument.createElementNS(k,"style:font-face"),e.setAttributeNS(k,"style:name",d),e.setAttributeNS(l,"svg:font-family",d),b.rootElement.fontFaceDecls.appendChild(e))};this.createDerivedStyleObject=function(a,d,k){var f=c(a,d);runtime.assert(Boolean(f),"No style element found for '"+
a+"' of family '"+d+"'");a=f.parentNode===b.rootElement.styles?{"style:parent-style-name":a}:e(f);a["style:family"]=d;z.mergeObjects(a,k);return a};this.getDefaultTabStopDistance=function(){for(var a=d("paragraph"),a=a&&a.firstElementChild,b;a;)a.namespaceURI===k&&"paragraph-properties"===a.localName&&(b=a.getAttributeNS(k,"tab-stop-distance")),a=a.nextElementSibling;b||(b="1.25cm");return x.parseNonNegativeLength(b)};this.getMasterPageElement=n;this.getContentSize=function(a,d){var e,f,h,l,g,m,p,
q,t,s;a:{f=c(a,d);runtime.assert("paragraph"===d||"table"===d,"styleFamily must be either paragraph or table");if(f){if(f=f.getAttributeNS(k,"master-page-name"))(e=n(f))||runtime.log("WARN: No master page definition found for "+f);e||(e=n("Standard"));e||(e=b.rootElement.masterStyles.getElementsByTagNameNS(k,"master-page")[0])||runtime.log("WARN: Document has no master pages defined");if(e)for(f=e.getAttributeNS(k,"page-layout-name"),h=v.getElementsByTagNameNS(b.rootElement.automaticStyles,k,"page-layout"),
l=0;l<h.length;l+=1)if(e=h[l],e.getAttributeNS(k,"name")===f)break a}e=null}e||(e=v.getDirectChild(b.rootElement.styles,k,"default-page-layout"));(e=v.getDirectChild(e,k,"page-layout-properties"))?("landscape"===e.getAttributeNS(k,"print-orientation")?(f="29.7cm",h="21.001cm"):(f="21.001cm",h="29.7cm"),f=r(e.getAttributeNS(w,"page-width"),f),h=r(e.getAttributeNS(w,"page-height"),h),l=r(e.getAttributeNS(w,"margin")),void 0===l?(l=r(e.getAttributeNS(w,"margin-left"),"2cm"),g=r(e.getAttributeNS(w,"margin-right"),
"2cm"),m=r(e.getAttributeNS(w,"margin-top"),"2cm"),p=r(e.getAttributeNS(w,"margin-bottom"),"2cm")):l=g=m=p=l,q=r(e.getAttributeNS(w,"padding")),void 0===q?(q=r(e.getAttributeNS(w,"padding-left"),"0cm"),t=r(e.getAttributeNS(w,"padding-right"),"0cm"),s=r(e.getAttributeNS(w,"padding-top"),"0cm"),e=r(e.getAttributeNS(w,"padding-bottom"),"0cm")):q=t=s=e=q):(f=r("21.001cm"),h=r("29.7cm"),l=g=m=p=l=r("2cm"),q=t=s=e=q=r("0cm"));return{width:f-l-g-q-t,height:h-m-p-s-e}}};(function(){var f=odf.Namespaces.stylens,g=odf.Namespaces.textns,d={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(c){this.derivedStyles={};this.element=c};odf.StyleTree=function(c,e){function m(c){var b,a,d,e={};if(!c)return e;for(c=c.firstElementChild;c;){if(a=c.namespaceURI!==f||"style"!==c.localName&&
"default-style"!==c.localName?c.namespaceURI===g&&"list-style"===c.localName?"list":c.namespaceURI!==f||"page-layout"!==c.localName&&"default-page-layout"!==c.localName?void 0:"page":c.getAttributeNS(f,"family"))(b=c.getAttributeNS(f,"name"))||(b=""),e.hasOwnProperty(a)?d=e[a]:e[a]=d={},d[b]=c;c=c.nextElementSibling}return e}function h(c,b){if(c.hasOwnProperty(b))return c[b];var a=null,d=Object.keys(c),e;for(e=0;e<d.length&&!(a=h(c[d[e]].derivedStyles,b));e+=1);return a}function p(c,b,a){var d,e,
g;if(!b.hasOwnProperty(c))return null;d=new odf.StyleTreeNode(b[c]);e=d.element.getAttributeNS(f,"parent-style-name");g=null;e&&(g=h(a,e)||p(e,b,a));g?g.derivedStyles[c]=d:a[c]=d;delete b[c];return d}function q(c,b){c&&Object.keys(c).forEach(function(a){p(a,c,b)})}var n={};this.getStyleTree=function(){return n};(function(){var f,b,a;b=m(c);a=m(e);Object.keys(d).forEach(function(c){f=n[c]={};q(b[c],f);q(a[c],f)})})()}})();(function(){var f=odf.Namespaces.fons,g=odf.Namespaces.stylens,d=odf.Namespaces.textns,c={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function e(c){var b=n.parseLength(c);return b?q.convert(b.value,b.unit,"px"):(runtime.log("Could not parse value '"+c+"'."),0)}function m(c,b){try{c.insertRule(b,c.cssRules.length)}catch(a){runtime.log("cannot load rule: "+b+" - "+a)}}function h(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function p(c,
b,a,h){b='text|list[text|style-name="'+b+'"]';for(var k=a.getAttributeNS(d,"level"),n,p,q,x,v,z,k=k&&parseInt(k,10);1<k;)b+=" > text|list-item > text|list",k-=1;(k=a.getElementsByTagNameNS(g,"list-level-properties")[0])?(n=k.getAttributeNS(d,"list-level-position-and-space-mode"),q=k.getAttributeNS(f,"text-align")||"left","label-alignment"===n?(p=k.getElementsByTagNameNS(g,"list-level-label-alignment")[0],a=p.getAttributeNS(f,"margin-left")||"0px",z=p.getAttributeNS(f,"text-indent")||"0px",p=p.getAttributeNS(d,
"label-followed-by"),k=e(a)):(a=k.getAttributeNS(d,"space-before")||"0px",x=k.getAttributeNS(d,"min-label-width")||"0px",v=k.getAttributeNS(d,"min-label-distance")||"0px",k=e(a)+e(x))):(v=x="0px",k=e("0px")+e(x));switch(q){case "end":q="right";break;case "start":q="left"}a=b+" > text|list-item{";a+="margin-left: "+k+"px;";a+="}";m(c,a);a=b+" > text|list-item > text|list{";a+="margin-left: "+-k+"px;";a+="}";m(c,a);a=b+" > text|list-item > *:not(text|list):first-child:before{";a+="text-align: "+q+";";
a+="counter-increment:list;";a+="display: inline-block;";"label-alignment"===n?(a+="margin-left: "+z+";","space"===p?h+=" '\\a0'":"listtab"===p&&(a+="padding-right: 0.2cm;")):(a+="min-width: "+x+";",a+="margin-left: -"+x+";",a+="padding-right: "+v+";");a+="\n"+h+";\n";a+="}";m(c,a)}var q=new core.CSSUnits,n=new odf.OdfUtils;this.applyListStyles=function(e,b){var a,f;(a=b.list)&&Object.keys(a).forEach(function(b){f=a[b];for(var m=f.element.firstChild,n,q;m;){if(m.namespaceURI===d)if(n=m,"list-level-style-number"===
m.localName){var x=n;q=x.getAttributeNS(g,"num-format");var v=x.getAttributeNS(g,"num-suffix")||"",x=x.getAttributeNS(g,"num-prefix")||"",z="";x&&(z+='"'+h(x)+'"\n');z=c.hasOwnProperty(q)?z+(" counter(list, "+c[q]+")"):q?z+(' "'+q+'"'):z+' ""';q="content:"+z+' "'+h(v)+'"';p(e,b,n,q)}else"list-level-style-image"===m.localName?(q="content: none",p(e,b,n,q)):"list-level-style-bullet"===m.localName&&(q=n.getAttributeNS(d,"bullet-char"),q='content: "'+h(q)+'"',p(e,b,n,q));m=m.nextSibling}})}}})();odf.Style2CSS=function(){function f(a,b,c){var d=[];c=c.derivedStyles;var e;var h=k[a],l;void 0===h?b=null:(l=b?"["+h+'|style-name="'+b+'"]':"","presentation"===h&&(h="draw",l=b?'[presentation|style-name="'+b+'"]':""),b=h+"|"+t[a].join(l+","+h+"|")+l);null!==b&&d.push(b);for(e in c)c.hasOwnProperty(e)&&(b=f(a,e,c[e]),d=d.concat(b));return d}function g(a,b){var c="",d,e,k;for(d=0;d<b.length;d+=1)if(e=b[d],k=a.getAttributeNS(e[0],e[1])){k=k.trim();if(J.hasOwnProperty(e[1])){var f=k.indexOf(" "),h=void 0,
l=void 0;-1!==f?(h=k.substring(0,f),l=k.substring(f)):(h=k,l="");(h=U.parseLength(h))&&"pt"===h.unit&&0.75>h.value&&(k="0.75pt"+l)}e[2]&&(c+=e[2]+":"+k+";")}return c}function d(a){return(a=l.getDirectChild(a,q,"text-properties"))?U.parseFoFontSize(a.getAttributeNS(h,"font-size")):null}function c(a,b,c,d){return b+b+c+c+d+d}function e(k,n,t,J){if("page"===n){var D=J.element;t="";var S,y;y=S="";var P=l.getDirectChild(D,q,"page-layout-properties"),M;if(P)if(M=D.getAttributeNS(q,"name"),t+=g(P,A),(S=
l.getDirectChild(P,q,"background-image"))&&(y=S.getAttributeNS(b,"href"))&&(t=t+("background-image: url('odfkit:"+y+"');")+g(S,w)),"presentation"===W)for(D=(D=l.getDirectChild(D.parentNode.parentNode,p,"master-styles"))&&D.firstElementChild;D;)D.namespaceURI===q&&"master-page"===D.localName&&D.getAttributeNS(q,"page-layout-name")===M&&(y=D.getAttributeNS(q,"name"),S="draw|page[draw|master-page-name="+y+"] {"+t+"}",y="office|body, draw|page[draw|master-page-name="+y+"] {"+g(P,K)+" }",k.insertRule(S,
k.cssRules.length),k.insertRule(y,k.cssRules.length)),D=D.nextElementSibling;else"text"===W?(t=""+g(P,K),S="office|text {"+t+"}",y="office|body {width: "+P.getAttributeNS(h,"page-width")+";}",k.insertRule(S,k.cssRules.length),k.insertRule(y,k.cssRules.length)):"spreadsheet"===W&&(S="office|spreadsheet {"+t+"}",y=P.getAttributeNS(h,"page-width")?"office|body {width: "+P.getAttributeNS(h,"page-width")+";}":"office|body {width: 20cm;}",k.insertRule(S,k.cssRules.length),k.insertRule(y,k.cssRules.length))}else{t=
f(n,t,J).join(",");P="";if(M=l.getDirectChild(J.element,q,"text-properties")){y=M;var Y,N,D=Y="";S=1;M=""+g(y,s);N=y.getAttributeNS(q,"text-underline-style");"solid"===N&&(Y+=" underline");N=y.getAttributeNS(q,"text-line-through-style");"solid"===N&&(Y+=" line-through");Y.length&&(M+="text-decoration:"+Y+";");if(Y=y.getAttributeNS(q,"font-name")||y.getAttributeNS(h,"font-family"))N=H[Y],M+="font-family: "+(N||Y)+";";N=y.parentNode;if(y=d(N)){for(;N;){if(y=d(N)){if("%"!==y.unit){D="font-size: "+y.value*
S+y.unit+";";break}S*=y.value/100}y=N;Y=N="";N=null;"default-style"===y.localName?N=null:(N=y.getAttributeNS(q,"parent-style-name"),Y=y.getAttributeNS(q,"family"),N=O.getODFElementsWithXPath(E,N?"//style:*[@style:name='"+N+"'][@style:family='"+Y+"']":"//style:default-style[@style:family='"+Y+"']",odf.Namespaces.lookupNamespaceURI)[0])}D||(D="font-size: "+parseFloat(aa)*S+B.getUnits(aa)+";");M+=D}P+=M}if(M=l.getDirectChild(J.element,q,"paragraph-properties"))D=M,M=""+g(D,x),(S=l.getDirectChild(D,q,
"background-image"))&&(y=S.getAttributeNS(b,"href"))&&(M=M+("background-image: url('odfkit:"+y+"');")+g(S,w)),(D=D.getAttributeNS(h,"line-height"))&&"normal"!==D&&(D=U.parseFoLineHeight(D),M="%"!==D.unit?M+("line-height: "+D.value+D.unit+";"):M+("line-height: "+D.value/100+";")),P+=M;if(M=l.getDirectChild(J.element,q,"graphic-properties"))y=M,M=""+g(y,v),D=y.getAttributeNS(m,"opacity"),S=y.getAttributeNS(m,"fill"),y=y.getAttributeNS(m,"fill-color"),"solid"===S||"hatch"===S?y&&"none"!==y?(D=isNaN(parseFloat(D))?
1:parseFloat(D)/100,S=y.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,c),(y=(S=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(S))?{r:parseInt(S[1],16),g:parseInt(S[2],16),b:parseInt(S[3],16)}:null)&&(M+="background-color: rgba("+y.r+","+y.g+","+y.b+","+D+");")):M+="background: none;":"none"===S&&(M+="background: none;"),P+=M;if(M=l.getDirectChild(J.element,q,"drawing-page-properties"))D=""+g(M,v),"true"===M.getAttributeNS(a,"background-visible")&&(D+="background: none;"),P+=D;if(M=l.getDirectChild(J.element,
q,"table-cell-properties"))M=""+g(M,z),P+=M;if(M=l.getDirectChild(J.element,q,"table-row-properties"))M=""+g(M,C),P+=M;if(M=l.getDirectChild(J.element,q,"table-column-properties"))M=""+g(M,u),P+=M;if(M=l.getDirectChild(J.element,q,"table-properties"))D=M,M=""+g(D,I),D=D.getAttributeNS(r,"border-model"),"collapsing"===D?M+="border-collapse:collapse;":"separating"===D&&(M+="border-collapse:separate;"),P+=M;0!==P.length&&k.insertRule(t+"{"+P+"}",k.cssRules.length)}for(var ca in J.derivedStyles)J.derivedStyles.hasOwnProperty(ca)&&
e(k,n,ca,J.derivedStyles[ca])}var m=odf.Namespaces.drawns,h=odf.Namespaces.fons,p=odf.Namespaces.officens,q=odf.Namespaces.stylens,n=odf.Namespaces.svgns,r=odf.Namespaces.tablens,b=odf.Namespaces.xlinkns,a=odf.Namespaces.presentationns,l=new core.DomUtils,k={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},t={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),
paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),
ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),
list:["list-item"]},s=[[h,"color","color"],[h,"background-color","background-color"],[h,"font-weight","font-weight"],[h,"font-style","font-style"]],w=[[q,"repeat","background-repeat"]],x=[[h,"background-color","background-color"],[h,"text-align","text-align"],[h,"text-indent","text-indent"],[h,"padding","padding"],[h,"padding-left","padding-left"],[h,"padding-right","padding-right"],[h,"padding-top","padding-top"],[h,"padding-bottom","padding-bottom"],[h,"border-left","border-left"],[h,"border-right",
"border-right"],[h,"border-top","border-top"],[h,"border-bottom","border-bottom"],[h,"margin","margin"],[h,"margin-left","margin-left"],[h,"margin-right","margin-right"],[h,"margin-top","margin-top"],[h,"margin-bottom","margin-bottom"],[h,"border","border"]],v=[[h,"background-color","background-color"],[h,"min-height","min-height"],[m,"stroke","border"],[n,"stroke-color","border-color"],[n,"stroke-width","border-width"],[h,"border","border"],[h,"border-left","border-left"],[h,"border-right","border-right"],
[h,"border-top","border-top"],[h,"border-bottom","border-bottom"]],z=[[h,"background-color","background-color"],[h,"border-left","border-left"],[h,"border-right","border-right"],[h,"border-top","border-top"],[h,"border-bottom","border-bottom"],[h,"border","border"]],u=[[q,"column-width","width"]],C=[[q,"row-height","height"],[h,"keep-together",null]],I=[[q,"width","width"],[h,"margin-left","margin-left"],[h,"margin-right","margin-right"],[h,"margin-top","margin-top"],[h,"margin-bottom","margin-bottom"]],
A=[[h,"background-color","background-color"],[h,"padding","padding"],[h,"padding-left","padding-left"],[h,"padding-right","padding-right"],[h,"padding-top","padding-top"],[h,"padding-bottom","padding-bottom"],[h,"border","border"],[h,"border-left","border-left"],[h,"border-right","border-right"],[h,"border-top","border-top"],[h,"border-bottom","border-bottom"],[h,"margin","margin"],[h,"margin-left","margin-left"],[h,"margin-right","margin-right"],[h,"margin-top","margin-top"],[h,"margin-bottom","margin-bottom"]],
K=[[h,"page-width","width"],[h,"page-height","height"]],J={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},H={},U=new odf.OdfUtils,W,E,aa,O=xmldom.XPath,B=new core.CSSUnits;this.style2css=function(a,b,c,d,f){var h,l,g;for(E=b;c.cssRules.length;)c.deleteRule(c.cssRules.length-1);odf.Namespaces.forEachPrefix(function(a,b){h="@namespace "+a+" url("+b+");";try{c.insertRule(h,c.cssRules.length)}catch(d){}});H=d;W=a;aa=runtime.getWindow().getComputedStyle(document.body,
null).getPropertyValue("font-size")||"12pt";for(g in k)if(k.hasOwnProperty(g))for(l in a=f[g],a)a.hasOwnProperty(l)&&e(c,g,l,a[l])}};(function(){function f(g,d){var c=this;this.getDistance=function(d){var f=c.x-d.x;d=c.y-d.y;return Math.sqrt(f*f+d*d)};this.getCenter=function(d){return new f((c.x+d.x)/2,(c.y+d.y)/2)};c.x=g;c.y=d}gui.ZoomHelper=function(){function g(a,b,c,d){a=d?"translate3d("+a+"px, "+b+"px, 0) scale3d("+c+", "+c+", 1)":"translate("+a+"px, "+b+"px) scale("+c+")";n.style.WebkitTransform=a;n.style.MozTransform=a;n.style.msTransform=a;n.style.OTransform=a;n.style.transform=a}function d(b){b?g(-r.x,-r.y,a,!0):(g(0,
0,a,!0),g(0,0,a,!1))}function c(a){if(l&&x){var b=l.style.overflow,c=l.classList.contains("webodf-customScrollbars");a&&c||!a&&!c||(a?(l.classList.add("webodf-customScrollbars"),l.style.overflow="hidden",runtime.requestAnimationFrame(function(){l.style.overflow=b})):l.classList.remove("webodf-customScrollbars"))}}function e(a){return new f(a.pageX-n.offsetLeft,a.pageY-n.offsetTop)}function m(a){var c=a.touches.length,d=0<c?e(a.touches[0]):null;a=1<c?e(a.touches[1]):null;d&&a?(b=d,w=s.PINCH):d&&(b=
d,w=s.SCROLL)}function h(d){var h=d.touches.length,m=0<h?e(d.touches[0]):null,h=1<h?e(d.touches[1]):null;m&&h?(d.preventDefault(),w===s.SCROLL&&(w=s.PINCH)):m&&(w===s.PINCH?(w=s.SCROLL,g(0,0,a,!0),l.scrollLeft=r.x,l.scrollTop=r.y,k.style.overflow=v||"",c(!0)):(b&&(r.x-=m.x-b.x,r.y-=m.y-b.y,r=new f(Math.min(Math.max(r.x,n.offsetLeft),(n.offsetLeft+n.offsetWidth)*a-l.clientWidth),Math.min(Math.max(r.y,n.offsetTop),(n.offsetTop+n.offsetHeight)*a-l.clientHeight))),b=m))}function p(){w=s.NONE}function q(){l&&
(l.removeEventListener("touchstart",m,!1),l.removeEventListener("touchmove",h,!1),l.removeEventListener("touchend",p,!1))}var n,r,b,a,l,k,t=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),s={NONE:0,SCROLL:1,PINCH:2},w=s.NONE,x=runtime.getWindow().hasOwnProperty("ontouchstart"),v="";this.subscribe=function(a,b){t.subscribe(a,b)};this.unsubscribe=function(a,b){t.unsubscribe(a,b)};this.getZoomLevel=function(){return a};this.setZoomLevel=function(b){n&&(a=b,d(!1),t.emit(gui.ZoomHelper.signalZoomChanged,
a))};this.destroy=function(a){q();c(!1);a()};this.setZoomableElement=function(a){q();n=a;l=n.offsetParent;k=n.parentElement;d(!1);l&&(l.addEventListener("touchstart",m,!1),l.addEventListener("touchmove",h,!1),l.addEventListener("touchend",p,!1));c(!0)};a=1;r=new f(0,0)};gui.ZoomHelper.signalZoomChanged="zoomChanged"})();ops.Canvas=function(){};ops.Canvas.prototype.getZoomLevel=function(){};ops.Canvas.prototype.getElement=function(){};ops.Canvas.prototype.getSizer=function(){};ops.Canvas.prototype.getZoomHelper=function(){};(function(){function f(){function a(d){c=!0;runtime.setTimeout(function(){try{d()}catch(e){runtime.log(String(e))}c=!1;0<b.length&&a(b.pop())},10)}var b=[],c=!1;this.clearQueue=function(){b.length=0};this.addToQueue=function(d){if(0===b.length&&!c)return a(d);b.push(d)}}function g(a){function b(){for(;0<c.cssRules.length;)c.deleteRule(0);c.insertRule("#shadowContent draw|page {display:none;}",0);c.insertRule("office|presentation draw|page {display:none;}",1);c.insertRule("#shadowContent draw|page:nth-of-type("+
d+") {display:block;}",2);c.insertRule("office|presentation draw|page:nth-of-type("+d+") {display:block;}",3)}var c=a.sheet,d=1;this.showFirstPage=function(){d=1;b()};this.showNextPage=function(){d+=1;b()};this.showPreviousPage=function(){1<d&&(d-=1,b())};this.showPage=function(a){0<a&&(d=a,b())};this.css=a;this.destroy=function(b){a.parentNode.removeChild(a);b()}}function d(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function c(a){a=a.sheet;for(var b=a.cssRules;b.length;)a.deleteRule(b.length-
1)}function e(a,b,c){var d=new odf.Style2CSS,e=new odf.ListStyleToCss;c=c.sheet;var k=(new odf.StyleTree(a.rootElement.styles,a.rootElement.automaticStyles)).getStyleTree();d.style2css(a.getDocumentType(),a.rootElement,c,b.getFontMap(),k);e.applyListStyles(c,k)}function m(a,b){(new odf.FontLoader).loadFonts(a,b.sheet)}function h(a,b,c){var d=null;a=a.rootElement.body.getElementsByTagNameNS(W,c+"-decl");c=b.getAttributeNS(W,"use-"+c+"-name");var e;if(c&&0<a.length)for(b=0;b<a.length;b+=1)if(e=a[b],
e.getAttributeNS(W,"name")===c){d=e.textContent;break}return d}function p(a,b,c,e){var k=a.ownerDocument;b=a.getElementsByTagNameNS(b,c);for(a=0;a<b.length;a+=1)d(b[a]),e&&(c=b[a],c.appendChild(k.createTextNode(e)))}function q(a,b,c){b.setAttributeNS("urn:webodf:names:helper","styleid",a);var d,e=b.getAttributeNS(J,"anchor-type"),k=b.getAttributeNS(A,"x"),f=b.getAttributeNS(A,"y"),h=b.getAttributeNS(A,"width"),l=b.getAttributeNS(A,"height"),g=b.getAttributeNS(u,"min-height"),m=b.getAttributeNS(u,
"min-width");if("as-char"===e)d="display: inline-block;";else if(e||k||f)d="position: absolute;";else if(h||l||g||m)d="display: block;";k&&(d+="left: "+k+";");f&&(d+="top: "+f+";");h&&(d+="width: "+h+";");l&&(d+="height: "+l+";");g&&(d+="min-height: "+g+";");m&&(d+="min-width: "+m+";");d&&(d="draw|"+b.localName+'[webodfhelper|styleid="'+a+'"] {'+d+"}",c.insertRule(d,c.cssRules.length))}function n(a){for(a=a.firstChild;a;){if(a.namespaceURI===C&&"binary-data"===a.localName)return"data:image/png;base64,"+
a.textContent.replace(/[\r\n\s]/g,"");a=a.nextSibling}return""}function r(a,b,c,d){function e(b){b&&(b='draw|image[webodfhelper|styleid="'+a+'"] {'+("background-image: url("+b+");")+"}",d.insertRule(b,d.cssRules.length))}function k(a){e(a.url)}c.setAttributeNS("urn:webodf:names:helper","styleid",a);var f=c.getAttributeNS(H,"href"),h;if(f)try{h=b.getPart(f),h.onchange=k,h.load()}catch(l){runtime.log("slight problem: "+String(l))}else f=n(c),e(f)}function b(a){var b=a.ownerDocument;B.getElementsByTagNameNS(a,
J,"line-break").forEach(function(a){a.hasChildNodes()||a.appendChild(b.createElement("br"))})}function a(a){var b=a.ownerDocument;B.getElementsByTagNameNS(a,J,"s").forEach(function(a){for(var c,d;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b.createTextNode(" "));d=parseInt(a.getAttributeNS(J,"c"),10);if(1<d)for(a.removeAttributeNS(J,"c"),c=1;c<d;c+=1)a.parentNode.insertBefore(a.cloneNode(!0),a)})}function l(a){B.getElementsByTagNameNS(a,J,"tab").forEach(function(a){a.textContent="\t"})}
function k(a,b){function c(a,d){var f=h.documentElement.namespaceURI;"video/"===d.substr(0,6)?(e=h.createElementNS(f,"video"),e.setAttribute("controls","controls"),k=h.createElementNS(f,"source"),a&&k.setAttribute("src",a),k.setAttribute("type",d),e.appendChild(k),b.parentNode.appendChild(e)):b.innerHtml="Unrecognised Plugin"}function d(a){c(a.url,a.mimetype)}var e,k,f,h=b.ownerDocument,l;if(f=b.getAttributeNS(H,"href"))try{l=a.getPart(f),l.onchange=d,l.load()}catch(g){runtime.log("slight problem: "+
String(g))}else runtime.log("using MP4 data fallback"),f=n(b),c(f,"video/mp4")}function t(a,b){try{a.insertRule(b,a.cssRules.length)}catch(c){runtime.log("cannot load rule: "+b+" - "+c)}}function s(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function w(a){var b=a.getElementsByTagName("head")[0],c,d;c=a.styleSheets.length;for(d=b.firstElementChild;d&&("style"!==d.localName||!d.hasAttribute("webodfcss"));)d=d.nextElementSibling;if(d)return c=parseInt(d.getAttribute("webodfcss"),10),d.setAttribute("webodfcss",
c+1),d;"string"===String(typeof webodf_css)?c=webodf_css:(d="webodf.css",runtime.currentDirectory&&(d=runtime.currentDirectory(),0<d.length&&"/"!==d.substr(-1)&&(d+="/"),d+="../webodf.css"),c=runtime.readFileSync(d,"utf-8"));d=a.createElementNS(b.namespaceURI,"style");d.setAttribute("media","screen, print, handheld, projection");d.setAttribute("type","text/css");d.setAttribute("webodfcss","1");d.appendChild(a.createTextNode(c));b.appendChild(d);return d}function x(a){var b=parseInt(a.getAttribute("webodfcss"),
10);1===b?a.parentNode.removeChild(a):a.setAttribute("count",b-1)}function v(a){var b=a.getElementsByTagName("head")[0],c=a.createElementNS(b.namespaceURI,"style"),d="";c.setAttribute("type","text/css");c.setAttribute("media","screen, print, handheld, projection");odf.Namespaces.forEachPrefix(function(a,b){d+="@namespace "+a+" url("+b+");\n"});d+="@namespace webodfhelper url(urn:webodf:names:helper);\n";c.appendChild(a.createTextNode(d));b.appendChild(c);return c}var z=odf.Namespaces.drawns,u=odf.Namespaces.fons,
C=odf.Namespaces.officens,I=odf.Namespaces.stylens,A=odf.Namespaces.svgns,K=odf.Namespaces.tablens,J=odf.Namespaces.textns,H=odf.Namespaces.xlinkns,U=odf.Namespaces.xmlns,W=odf.Namespaces.presentationns,E=runtime.getWindow(),aa=xmldom.XPath,O=new odf.OdfUtils,B=new core.DomUtils;odf.OdfCanvas=function(n){function A(a,b,c){function d(a,b,c,e){ma.addToQueue(function(){r(a,b,c,e)})}var e,k;e=b.getElementsByTagNameNS(z,"image");for(b=0;b<e.length;b+=1)k=e.item(b),d("image"+String(b),a,k,c)}function u(a,
b){function c(a,b){ma.addToQueue(function(){k(a,b)})}var d,e,f;e=b.getElementsByTagNameNS(z,"plugin");for(d=0;d<e.length;d+=1)f=e.item(d),c(a,f)}function H(){var a;a=Q.firstChild;var b=ea.getZoomLevel();a&&(Q.style.WebkitTransformOrigin="0% 0%",Q.style.MozTransformOrigin="0% 0%",Q.style.msTransformOrigin="0% 0%",Q.style.OTransformOrigin="0% 0%",Q.style.transformOrigin="0% 0%",$&&((a=$.getMinimumHeightForAnnotationPane())?Q.style.minHeight=a:Q.style.removeProperty("min-height")),n.style.width=Math.round(b*
Q.offsetWidth)+"px",n.style.height=Math.round(b*Q.offsetHeight)+"px",n.style.display="inline-block")}function D(c,e){var k=ka.sheet;d(n);Q=Y.createElementNS(n.namespaceURI,"div");Q.style.display="inline-block";Q.style.background="white";Q.style.setProperty("float","left","important");Q.appendChild(e);n.appendChild(Q);V=Y.createElementNS(n.namespaceURI,"div");V.id="annotationsPane";ga=Y.createElementNS(n.namespaceURI,"div");ga.id="shadowContent";ga.style.position="absolute";ga.style.top=0;ga.style.left=
0;c.getContentElement().appendChild(ga);var f=e.body,g,m=[],r;for(g=f.firstElementChild;g&&g!==f;)if(g.namespaceURI===z&&(m[m.length]=g),g.firstElementChild)g=g.firstElementChild;else{for(;g&&g!==f&&!g.nextElementSibling;)g=g.parentNode;g&&g.nextElementSibling&&(g=g.nextElementSibling)}for(r=0;r<m.length;r+=1)g=m[r],q("frame"+String(r),g,k);m=aa.getODFElementsWithXPath(f,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI);for(g=0;g<m.length;g+=1)f=m[g],f.setAttributeNS&&f.setAttributeNS("urn:webodf:names:helper",
"containsparagraphanchor",!0);f=ca;g=ga;var w,x,v,H;H=0;var y,B;r=c.rootElement.ownerDocument;if((m=e.body.firstElementChild)&&m.namespaceURI===C&&("presentation"===m.localName||"drawing"===m.localName))for(m=m.firstElementChild;m;){if(w=(w=m.getAttributeNS(z,"master-page-name"))?f.getMasterPageElement(w):null){x=m.getAttributeNS("urn:webodf:names:helper","styleid");v=r.createElementNS(z,"draw:page");B=w.firstElementChild;for(y=0;B;)"true"!==B.getAttributeNS(W,"placeholder")&&(H=B.cloneNode(!0),v.appendChild(H),
q(x+"_"+y,H,k)),B=B.nextElementSibling,y+=1;B=y=H=void 0;var D=v.getElementsByTagNameNS(z,"frame");for(H=0;H<D.length;H+=1)y=D[H],(B=y.getAttributeNS(W,"class"))&&!/^(date-time|footer|header|page-number)$/.test(B)&&y.parentNode.removeChild(y);g.appendChild(v);H=String(g.getElementsByTagNameNS(z,"page").length);p(v,J,"page-number",H);p(v,W,"header",h(c,m,"header"));p(v,W,"footer",h(c,m,"footer"));q(x,v,k);v.setAttributeNS(z,"draw:master-page-name",w.getAttributeNS(I,"name"))}m=m.nextElementSibling}f=
n.namespaceURI;m=e.body.getElementsByTagNameNS(K,"table-cell");for(g=0;g<m.length;g+=1)r=m.item(g),r.hasAttributeNS(K,"number-columns-spanned")&&r.setAttributeNS(f,"colspan",r.getAttributeNS(K,"number-columns-spanned")),r.hasAttributeNS(K,"number-rows-spanned")&&r.setAttributeNS(f,"rowspan",r.getAttributeNS(K,"number-rows-spanned"));b(e.body);a(e.body);l(e.body);A(c,e.body,k);u(c,e.body);w=e.body;f=n.namespaceURI;m={};r={};var N;x=E.document.getElementsByTagNameNS(J,"list-style");for(g=0;g<x.length;g+=
1)y=x.item(g),(B=y.getAttributeNS(I,"name"))&&(r[B]=y);w=w.getElementsByTagNameNS(J,"list");for(g=0;g<w.length;g+=1)if(y=w.item(g),x=y.getAttributeNS(U,"id")){v=y.getAttributeNS(J,"continue-list");y.setAttributeNS(f,"id",x);H="text|list#"+x+" > text|list-item > *:first-child:before {";if(B=y.getAttributeNS(J,"style-name")){y=r[B];N=O.getFirstNonWhitespaceChild(y);y=void 0;if(N)if("list-level-style-number"===N.localName){B=N;N=B.getAttributeNS(I,"num-format");y=B.getAttributeNS(I,"num-suffix")||"";
B=B.getAttributeNS(I,"num-prefix")||"";var D="",D={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"},L=void 0;B&&(L='"'+s(B)+'"\n');L=D.hasOwnProperty(N)?L+(" counter(list, "+D[N]+")"):N?L+("'"+N+"';"):L+' ""';y&&(L+=' "'+s(y)+'"');y=D="content:"+L+";"}else"list-level-style-image"===N.localName?y="content: none;":"list-level-style-bullet"===N.localName&&(N=N.getAttributeNS(J,"bullet-char"),y='content: "'+s(N)+'"\n;');N=y;N="\n"+N+"\n"}if(v){for(y=m[v];y;)y=m[y];H+="counter-increment:"+
v+";";N?(N=N.replace("list",v),H+=N):H+="content:counter("+v+");"}else v="",N?(N=N.replace("list",x),H+=N):H+="content: counter("+x+");",H+="counter-increment:"+x+";",t(k,"text|list#"+x+" {counter-reset:"+x+"}");H+="}";m[x]=v;H&&t(k,H)}Q.insertBefore(ga,Q.firstChild);ea.setZoomableElement(Q)}function S(a){L?(V.parentNode||Q.appendChild(V),$&&$.forgetAnnotations(),$=new gui.AnnotationViewManager(M,a.body,V,ia),B.getElementsByTagNameNS(a.body,C,"annotation").forEach($.addAnnotation),$.rerenderAnnotations(),
H()):V.parentNode&&(Q.removeChild(V),$.forgetAnnotations(),H())}function y(a){function b(){c(da);c(qa);c(ka);d(n);n.style.display="inline-block";var k=N.rootElement;n.ownerDocument.importNode(k,!0);ca.setOdfContainer(N);m(N,da);e(N,ca,qa);D(N,k);S(k);a||ma.addToQueue(function(){var a=[N];if(la.hasOwnProperty("statereadychange")){var b=la.statereadychange,c;for(c=0;c<b.length;c+=1)b[c].apply(null,a)}})}N.state===odf.OdfContainer.DONE?b():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),
oa=runtime.setTimeout(function G(){N.state===odf.OdfContainer.DONE?b():(runtime.log("will be back later..."),oa=runtime.setTimeout(G,500))},100))}function P(a){ma.clearQueue();n.innerHTML=runtime.tr("Loading File")+"...";n.removeAttribute("style");N=new odf.OdfContainer(a,function(a){N=a;y(!1)})}runtime.assert(null!==n&&void 0!==n,"odf.OdfCanvas constructor needs DOM element");runtime.assert(null!==n.ownerDocument&&void 0!==n.ownerDocument,"odf.OdfCanvas constructor needs DOM");var M=this,Y=n.ownerDocument,
N,ca=new odf.Formatting,T,Q=null,V=null,L=!1,ia=!1,$=null,ba,da,qa,ka,ga,la={},oa,pa,ja=!1,na=!1,ma=new f,ea=new gui.ZoomHelper;this.refreshCSS=function(){ja=!0;pa.trigger()};this.refreshSize=function(){pa.trigger()};this.odfContainer=function(){return N};this.setOdfContainer=function(a,b){N=a;y(!0===b)};this.load=this.load=P;this.save=function(a){N.save(a)};this.addListener=function(a,b){switch(a){case "click":var c=n,d=a;c.addEventListener?c.addEventListener(d,b,!1):c.attachEvent?c.attachEvent("on"+
d,b):c["on"+d]=b;break;default:c=la.hasOwnProperty(a)?la[a]:la[a]=[],b&&-1===c.indexOf(b)&&c.push(b)}};this.getFormatting=function(){return ca};this.getAnnotationViewManager=function(){return $};this.refreshAnnotations=function(){S(N.rootElement)};this.rerenderAnnotations=function(){$&&(na=!0,pa.trigger())};this.getSizer=function(){return Q};this.enableAnnotations=function(a,b){a!==L&&(L=a,ia=b,N&&S(N.rootElement))};this.addAnnotation=function(a){$&&($.addAnnotation(a),H())};this.forgetAnnotations=
function(){$&&($.forgetAnnotations(),H())};this.getZoomHelper=function(){return ea};this.setZoomLevel=function(a){ea.setZoomLevel(a)};this.getZoomLevel=function(){return ea.getZoomLevel()};this.fitToContainingElement=function(a,b){var c=ea.getZoomLevel(),d=n.offsetHeight/c,c=a/(n.offsetWidth/c);b/d<c&&(c=b/d);ea.setZoomLevel(c)};this.fitToWidth=function(a){var b=n.offsetWidth/ea.getZoomLevel();ea.setZoomLevel(a/b)};this.fitSmart=function(a,b){var c,d;d=ea.getZoomLevel();c=n.offsetWidth/d;d=n.offsetHeight/
d;c=a/c;void 0!==b&&b/d<c&&(c=b/d);ea.setZoomLevel(Math.min(1,c))};this.fitToHeight=function(a){var b=n.offsetHeight/ea.getZoomLevel();ea.setZoomLevel(a/b)};this.showFirstPage=function(){T.showFirstPage()};this.showNextPage=function(){T.showNextPage()};this.showPreviousPage=function(){T.showPreviousPage()};this.showPage=function(a){T.showPage(a);H()};this.getElement=function(){return n};this.addCssForFrameWithImage=function(a){var b=a.getAttributeNS(z,"name"),c=a.firstElementChild;q(b,a,ka.sheet);
c&&r(b+"img",N,c,ka.sheet)};this.destroy=function(a){var b=Y.getElementsByTagName("head")[0],c=[T.destroy,pa.destroy];runtime.clearTimeout(oa);V&&V.parentNode&&V.parentNode.removeChild(V);ea.destroy(function(){Q&&(n.removeChild(Q),Q=null)});x(ba);b.removeChild(da);b.removeChild(qa);b.removeChild(ka);core.Async.destroyAll(c,a)};ba=w(Y);T=new g(v(Y));da=v(Y);qa=v(Y);ka=v(Y);pa=core.Task.createRedrawTask(function(){ja&&(e(N,ca,qa),ja=!1);na&&($&&$.rerenderAnnotations(),na=!1);H()});ea.subscribe(gui.ZoomHelper.signalZoomChanged,
H)}})();odf.StepUtils=function(){this.getContentBounds=function(f){var g=f.container(),d,c;runtime.assert(f.isStep(),"Step iterator must be on a step");g.nodeType===Node.TEXT_NODE&&0<f.offset()?d=f.offset():(g=f.leftNode())&&g.nodeType===Node.TEXT_NODE&&(d=g.length);g&&(g.nodeType===Node.TEXT_NODE?(runtime.assert(0<d,"Empty text node found"),c={container:g,startOffset:d-1,endOffset:d}):c={container:g,startOffset:0,endOffset:g.childNodes.length});return c}};ops.MemberProperties=function(){};
ops.Member=function(f,g){var d=new ops.MemberProperties;this.getMemberId=function(){return f};this.getProperties=function(){return d};this.setProperties=function(c){Object.keys(c).forEach(function(e){d[e]=c[e]})};this.removeProperties=function(c){Object.keys(c).forEach(function(c){"fullName"!==c&&"color"!==c&&"imageUrl"!==c&&d.hasOwnProperty(c)&&delete d[c]})};runtime.assert(Boolean(f),"No memberId was supplied!");g.fullName||(g.fullName=runtime.tr("Unknown Author"));g.color||(g.color="black");g.imageUrl||
(g.imageUrl="avatar-joe.png");d=g};gui.SelectionMover=function(f,g){function d(){r.setUnfilteredPosition(f.getNode(),0);return r}function c(a,b){var c,d=null;a&&0<a.length&&(c=b?a.item(a.length-1):a.item(0));c&&(d={top:c.top,left:b?c.right:c.left,bottom:c.bottom});return d}function e(a,b,d,f){var h=a.nodeType;d.setStart(a,b);d.collapse(!f);f=c(d.getClientRects(),!0===f);!f&&0<b&&(d.setStart(a,b-1),d.setEnd(a,b),f=c(d.getClientRects(),!0));f||(h===Node.ELEMENT_NODE&&0<b&&a.childNodes.length>=b?f=e(a,b-1,d,!0):a.nodeType===Node.TEXT_NODE&&
0<b?f=e(a,b-1,d,!0):a.previousSibling?f=e(a.previousSibling,a.previousSibling.nodeType===Node.TEXT_NODE?a.previousSibling.textContent.length:a.previousSibling.childNodes.length,d,!0):a.parentNode&&a.parentNode!==g?f=e(a.parentNode,0,d,!1):(d.selectNode(g),f=c(d.getClientRects(),!1)));runtime.assert(Boolean(f),"No visible rectangle found");return f}function m(a,c,e){for(var f=d(),h=new core.LoopWatchDog(1E4),g=0,m=0;0<a&&f.nextPosition();)h.check(),e.acceptPosition(f)===b&&(g+=1,c.acceptPosition(f)===
b&&(m+=g,g=0,a-=1));return m}function h(a,c,e){for(var f=d(),h=new core.LoopWatchDog(1E4),g=0,m=0;0<a&&f.previousPosition();)h.check(),e.acceptPosition(f)===b&&(g+=1,c.acceptPosition(f)===b&&(m+=g,g=0,a-=1));return m}function p(a,c){var f=d(),h=0,m=0,n=0>a?-1:1;for(a=Math.abs(a);0<a;){for(var p=c,r=n,q=f,u=q.container(),C=0,I=null,A=void 0,K=10,J=void 0,H=0,U=void 0,W=void 0,E=void 0,J=void 0,aa=g.ownerDocument.createRange(),O=new core.LoopWatchDog(1E4),J=e(u,q.unfilteredDomOffset(),aa),U=J.top,W=
J.left,E=U;!0===(0>r?q.previousPosition():q.nextPosition());)if(O.check(),p.acceptPosition(q)===b&&(C+=1,u=q.container(),J=e(u,q.unfilteredDomOffset(),aa),J.top!==U)){if(J.top!==E&&E!==U)break;E=J.top;J=Math.abs(W-J.left);if(null===I||J<K)I=u,A=q.unfilteredDomOffset(),K=J,H=C}null!==I?(q.setUnfilteredPosition(I,A),C=H):C=0;aa.detach();h+=C;if(0===h)break;m+=h;a-=1}return m*n}function q(a,c){var f,h,m,p,r=d(),q=n.getParagraphElement(r.getCurrentNode()),z=0,u=g.ownerDocument.createRange();0>a?(f=r.previousPosition,
h=-1):(f=r.nextPosition,h=1);for(m=e(r.container(),r.unfilteredDomOffset(),u);f.call(r);)if(c.acceptPosition(r)===b){if(n.getParagraphElement(r.getCurrentNode())!==q)break;p=e(r.container(),r.unfilteredDomOffset(),u);if(p.bottom!==m.bottom&&(m=p.top>=m.top&&p.bottom<m.bottom||p.top<=m.top&&p.bottom>m.bottom,!m))break;z+=h;m=p}u.detach();return z}var n=new odf.OdfUtils,r,b=core.PositionFilter.FilterResult.FILTER_ACCEPT;this.getStepCounter=function(){return{convertForwardStepsBetweenFilters:m,convertBackwardStepsBetweenFilters:h,
countLinesSteps:p,countStepsToLineBoundary:q}};(function(){r=gui.SelectionMover.createPositionIterator(g);var a=g.ownerDocument.createRange();a.setStart(r.container(),r.unfilteredDomOffset());a.collapse(!0);f.setSelectedRange(a)})()};
gui.SelectionMover.createPositionIterator=function(f){var g=new function(){this.acceptNode=function(d){return d&&"urn:webodf:names:cursor"!==d.namespaceURI&&"urn:webodf:names:editinfo"!==d.namespaceURI?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}};return new core.PositionIterator(f,5,g,!1)};ops.Document=function(){};ops.Document.prototype.getMemberIds=function(){};ops.Document.prototype.removeCursor=function(f){};ops.Document.prototype.getDocumentElement=function(){};ops.Document.prototype.getRootNode=function(){};ops.Document.prototype.getDOMDocument=function(){};ops.Document.prototype.cloneDocumentElement=function(){};ops.Document.prototype.setDocumentElement=function(f){};ops.Document.prototype.subscribe=function(f,g){};ops.Document.prototype.unsubscribe=function(f,g){};
ops.Document.prototype.getCanvas=function(){};ops.Document.prototype.createRootFilter=function(f){};ops.Document.signalCursorAdded="cursor/added";ops.Document.signalCursorRemoved="cursor/removed";ops.Document.signalCursorMoved="cursor/moved";ops.Document.signalMemberAdded="member/added";ops.Document.signalMemberUpdated="member/updated";ops.Document.signalMemberRemoved="member/removed";ops.OdtCursor=function(f,g){var d=this,c={},e,m,h,p=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){h.remove()};this.subscribe=function(c,d){p.subscribe(c,d)};this.unsubscribe=function(c,d){p.unsubscribe(c,d)};this.getStepCounter=function(){return m.getStepCounter()};this.getMemberId=function(){return f};this.getNode=function(){return h.getNode()};this.getAnchorNode=function(){return h.getAnchorNode()};this.getSelectedRange=function(){return h.getSelectedRange()};
this.setSelectedRange=function(c,e){h.setSelectedRange(c,e);p.emit(ops.OdtCursor.signalCursorUpdated,d)};this.hasForwardSelection=function(){return h.hasForwardSelection()};this.getDocument=function(){return g};this.getSelectionType=function(){return e};this.setSelectionType=function(d){c.hasOwnProperty(d)?e=d:runtime.log("Invalid selection type: "+d)};this.resetSelectionType=function(){d.setSelectionType(ops.OdtCursor.RangeSelection)};h=new core.Cursor(g.getDOMDocument(),f);m=new gui.SelectionMover(h,
g.getRootNode());c[ops.OdtCursor.RangeSelection]=!0;c[ops.OdtCursor.RegionSelection]=!0;d.resetSelectionType()};ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";ops.OdtCursor.signalCursorUpdated="cursorUpdated";(function(){var f=0;ops.StepsCache=function(g,d,c){function e(a,b){var d=this;this.nodeId=a;this.steps=-1;this.node=b;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setPositionBeforeElement(b);c(d.steps,a)}}function m(a,b,d){var e=this;this.nodeId=a;this.steps=b;this.node=d;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setUnfilteredPosition(d,0);c(e.steps,a)}}function h(a,b){var c="["+a.nodeId;b&&(c+=" => "+b.nodeId);return c+
"]"}function p(){for(var a=w,b,c,d,e=new core.LoopWatchDog(0,1E5),f={};a;){e.check();(b=a.previousBookmark)?runtime.assert(b.nextBookmark===a,"Broken bookmark link to previous @"+h(b,a)):(runtime.assert(a===w,"Broken bookmark link @"+h(a)),runtime.assert(void 0===x||w===w||w.steps<=x,"Base point is damaged @"+h(a)));(c=a.nextBookmark)&&runtime.assert(c.previousBookmark===a,"Broken bookmark link to next @"+h(a,c));if(void 0===x||a===w||a.steps<=x)runtime.assert(s.containsNode(g,a.node),"Disconnected node is being reported as undamaged @"+
h(a)),b&&(d=a.node.compareDocumentPosition(b.node),runtime.assert(0===d||0!==(d&z),"Bookmark order with previous does not reflect DOM order @"+h(b,a))),c&&s.containsNode(g,c.node)&&(d=a.node.compareDocumentPosition(c.node),runtime.assert(0===d||0!==(d&v),"Bookmark order with next does not reflect DOM order @"+h(a,c)));a=a.nextBookmark}Object.keys(k).forEach(function(a){var b=k[a];(void 0===x||a<=x)&&runtime.assert(b.steps<=a,"Bookmark step of "+b.steps+" exceeds cached step lookup for "+a+" @"+h(b));
runtime.assert(!1===f.hasOwnProperty(b.nodeId),"Bookmark "+h(b)+" appears twice in cached step lookup at steps "+f[b.nodeId]+" and "+a);f[b.nodeId]=a})}function q(a){var b="";a.nodeType===Node.ELEMENT_NODE&&(b=a.getAttributeNS(l,"nodeId")||"");return b}function n(a){var b=f.toString();a.setAttributeNS(l,"nodeId",b);f+=1;return b}function r(a){var b,c,e=new core.LoopWatchDog(0,1E4);void 0!==x&&a>x&&(a=x);for(b=Math.floor(a/d)*d;!c&&0<=b;)c=k[b],b-=d;for(c=c||w;c.nextBookmark&&c.nextBookmark.steps<=
a;)e.check(),c=c.nextBookmark;runtime.assert(-1===a||c.steps<=a,"Bookmark @"+h(c)+" at step "+c.steps+" exceeds requested step of "+a);return c}function b(a){a.previousBookmark&&(a.previousBookmark.nextBookmark=a.nextBookmark);a.nextBookmark&&(a.nextBookmark.previousBookmark=a.previousBookmark)}function a(a){for(var b,c=null;!c&&a&&a!==g;)(b=q(a))&&(c=t[b])&&c.node!==a&&(runtime.log("Cloned node detected. Creating new bookmark"),c=null,a.removeAttributeNS(l,"nodeId")),a=a.parentNode;return c}var l=
"urn:webodf:names:steps",k={},t={},s=new core.DomUtils,w,x,v=Node.DOCUMENT_POSITION_FOLLOWING,z=Node.DOCUMENT_POSITION_PRECEDING,u;this.updateBookmark=function(a,c){var f,h=Math.ceil(a/d)*d,l,m,p;if(void 0!==x&&x<a){l=r(x);for(m=l.nextBookmark;m&&m.steps<=a;)f=m.nextBookmark,p=Math.ceil(m.steps/d)*d,k[p]===m&&delete k[p],s.containsNode(g,m.node)?m.steps=a+1:(b(m),delete t[m.nodeId]),m=f;x=a}else l=r(a);m=q(c)||n(c);f=t[m];f?f.node!==c&&(runtime.log("Cloned node detected. Creating new bookmark"),m=
n(c),f=t[m]=new e(m,c)):f=t[m]=new e(m,c);m=f;m.steps!==a&&(f=Math.ceil(m.steps/d)*d,f!==h&&k[f]===m&&delete k[f],m.steps=a);if(l!==m&&l.nextBookmark!==m){if(l.steps===m.steps)for(;0!==(m.node.compareDocumentPosition(l.node)&v)&&l!==w;)l=l.previousBookmark;l!==m&&l.nextBookmark!==m&&(b(m),f=l.nextBookmark,m.nextBookmark=l.nextBookmark,m.previousBookmark=l,l.nextBookmark=m,f&&(f.previousBookmark=m))}l=k[h];if(!l||m.steps>l.steps)k[h]=m;u()};this.setToClosestStep=function(a,b){var c;u();c=r(a);c.setIteratorPosition(b);
return c.steps};this.setToClosestDomPoint=function(b,c,d){var e,f;u();if(b===g&&0===c)e=w;else if(b===g&&c===g.childNodes.length)for(f in e=w,k)k.hasOwnProperty(f)&&(b=k[f],b.steps>e.steps&&(e=b));else if(e=a(b.childNodes.item(c)||b),!e)for(d.setUnfilteredPosition(b,c);!e&&d.previousNode();)e=a(d.getCurrentNode());e=e||w;void 0!==x&&e.steps>x&&(e=r(x));e.setIteratorPosition(d);return e.steps};this.damageCacheAfterStep=function(a){0>a&&(a=-1);void 0===x?x=a:a<x&&(x=a);u()};(function(){var a=q(g)||
n(g);w=new m(a,0,g);u=ops.StepsCache.ENABLE_CACHE_VERIFICATION?p:function(){}})()};ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1;ops.StepsCache.Bookmark=function(){};ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(f){}})();(function(){ops.OdtStepsTranslator=function(f,g,d,c){function e(a,b,c){var d=b.getCurrentNode();b.isBeforeNode()&&r.isParagraph(d)&&(c||(a+=1),n.updateBookmark(a,d))}function m(a,b){do{if(d.acceptPosition(b)===l){e(a,b,!0);break}e(a-1,b,!1)}while(b.nextPosition())}function h(){var b=f();b!==q&&(q&&runtime.log("Undo detected. Resetting steps cache"),q=b,n=new ops.StepsCache(q,c,m),a=g(q))}function p(a,b){if(!b||d.acceptPosition(a)===l)return!0;for(;a.previousPosition();)if(d.acceptPosition(a)===l){if(b(0,
a.container(),a.unfilteredDomOffset()))return!0;break}for(;a.nextPosition();)if(d.acceptPosition(a)===l){if(b(1,a.container(),a.unfilteredDomOffset()))return!0;break}return!1}var q,n,r=new odf.OdfUtils,b=new core.DomUtils,a,l=core.PositionFilter.FilterResult.FILTER_ACCEPT;this.convertStepsToDomPoint=function(b){var c,f;if(isNaN(b))throw new TypeError("Requested steps is not numeric ("+b+")");if(0>b)throw new RangeError("Requested steps is negative ("+b+")");h();for(c=n.setToClosestStep(b,a);c<b&&
a.nextPosition();)(f=d.acceptPosition(a)===l)&&(c+=1),e(c,a,f);if(c!==b)throw new RangeError("Requested steps ("+b+") exceeds available steps ("+c+")");return{node:a.container(),offset:a.unfilteredDomOffset()}};this.convertDomPointToSteps=function(c,f,g){var m;h();b.containsNode(q,c)||(f=0>b.comparePoints(q,0,c,f),c=q,f=f?0:q.childNodes.length);a.setUnfilteredPosition(c,f);p(a,g)||a.setUnfilteredPosition(c,f);g=a.container();f=a.unfilteredDomOffset();c=n.setToClosestDomPoint(g,f,a);if(0>b.comparePoints(a.container(),
a.unfilteredDomOffset(),g,f))return 0<c?c-1:c;for(;(a.container()!==g||a.unfilteredDomOffset()!==f)&&a.nextPosition();)(m=d.acceptPosition(a)===l)&&(c+=1),e(c,a,m);return c+0};this.prime=function(){var b,c;h();for(b=n.setToClosestStep(0,a);a.nextPosition();)(c=d.acceptPosition(a)===l)&&(b+=1),e(b,a,c)};this.handleStepsInserted=function(a){h();n.damageCacheAfterStep(a.position)};this.handleStepsRemoved=function(a){h();n.damageCacheAfterStep(a.position-1)};h()};ops.OdtStepsTranslator.PREVIOUS_STEP=
0;ops.OdtStepsTranslator.NEXT_STEP=1})();ops.Operation=function(){};ops.Operation.prototype.init=function(f){};ops.Operation.prototype.execute=function(f){};ops.Operation.prototype.spec=function(){};ops.TextPositionFilter=function(f){function g(c,e,f){var g,b;if(e){if(d.isInlineRoot(e)&&d.isGroupingElement(f))return h;g=d.lookLeftForCharacter(e);if(1===g||2===g&&(d.scanRightForAnyCharacter(f)||d.scanRightForAnyCharacter(d.nextNode(c))))return m}else if(d.isInlineRoot(c.previousSibling)&&d.isGroupingElement(c))return m;g=null===e&&d.isParagraph(c);b=d.lookRightForCharacter(f);if(g)return b?m:d.scanRightForAnyCharacter(f)?h:m;if(!b)return h;e=e||d.previousNode(c);return d.scanLeftForAnyCharacter(e)?
h:m}var d=new odf.OdfUtils,c=Node.ELEMENT_NODE,e=Node.TEXT_NODE,m=core.PositionFilter.FilterResult.FILTER_ACCEPT,h=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(p){var q=p.container(),n=q.nodeType,r,b,a;if(n!==c&&n!==e)return h;if(n===e){if(!d.isGroupingElement(q.parentNode)||d.isWithinTrackedChanges(q.parentNode,f()))return h;n=p.unfilteredDomOffset();r=q.data;runtime.assert(n!==r.length,"Unexpected offset.");if(0<n){p=r[n-1];if(!d.isODFWhitespace(p))return m;if(1<n)if(p=
r[n-2],!d.isODFWhitespace(p))b=m;else{if(!d.isODFWhitespace(r.substr(0,n)))return h}else a=d.previousNode(q),d.scanLeftForNonSpace(a)&&(b=m);if(b===m)return d.isTrailingWhitespace(q,n)?h:m;b=r[n];return d.isODFWhitespace(b)?h:d.scanLeftForAnyCharacter(d.previousNode(q))?h:m}a=p.leftNode();b=q;q=q.parentNode;b=g(q,a,b)}else!d.isGroupingElement(q)||d.isWithinTrackedChanges(q,f())?b=h:(a=p.leftNode(),b=p.rightNode(),b=g(q,a,b));return b}};ops.OdtDocument=function(f){function g(){var a=f.odfContainer().getContentElement(),b=a&&a.localName;runtime.assert("text"===b,"Unsupported content element type '"+b+"' for OdtDocument");return a}function d(){return a.getDocumentElement().ownerDocument}function c(a){for(;a&&!(a.namespaceURI===odf.Namespaces.officens&&"text"===a.localName||a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName);)a=a.parentNode;return a}function e(a){this.acceptPosition=function(b){b=b.container();var d;
d="string"===typeof a?s[a].getNode():a;return c(b)===c(d)?v:z}}function m(a,b,c,d){d=gui.SelectionMover.createPositionIterator(d);var e;1===c.length?e=c[0]:(e=new core.PositionFilterChain,c.forEach(e.addFilter));c=new core.StepIterator(e,d);c.setPosition(a,b);return c}function h(a){var b=gui.SelectionMover.createPositionIterator(g());a=C.convertStepsToDomPoint(a);b.setUnfilteredPosition(a.node,a.offset);return b}function p(a){return k.getParagraphElement(a)}function q(a,b){return f.getFormatting().getStyleElement(a,
b)}function n(a){return q(a,"paragraph")}function r(a){var b,c=[],d,e=2;runtime.assert(a.isStep(),"positionIterator is not at a step");do{if(b=l.getContentBounds(a))if(b=b.container,k.isDowngradableSpaceElement(b)){for(d=b.lastChild;b.firstChild;)c.push(b.firstChild),b.parentNode.insertBefore(b.firstChild,b);b.parentNode.removeChild(b);a.setPosition(d,d.nodeType===Node.TEXT_NODE?d.length:d.childNodes.length);a.roundToPreviousStep()}e-=1}while(0<e&&a.nextStep());c.forEach(t.normalizeTextNodes)}function b(a,
b,c){a=a.childNodes.item(b)||a;return(a=p(a))&&t.containsNode(c,a)?a:c}var a=this,l,k,t,s={},w={},x=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,
ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated]),v=core.PositionFilter.FilterResult.FILTER_ACCEPT,z=core.PositionFilter.FilterResult.FILTER_REJECT,u,C,I;this.getDocumentElement=function(){return f.odfContainer().rootElement};this.getDOMDocument=
function(){return this.getDocumentElement().ownerDocument};this.cloneDocumentElement=function(){var b=a.getDocumentElement(),c=f.getAnnotationViewManager();c&&c.forgetAnnotations();b=b.cloneNode(!0);f.refreshAnnotations();return b};this.setDocumentElement=function(a){var b=f.odfContainer();b.setRootElement(a);f.setOdfContainer(b,!0);f.refreshCSS()};this.getDOMDocument=d;this.getRootElement=c;this.createStepIterator=m;this.getIteratorAtPosition=h;this.convertCursorStepToDomPoint=function(a){return C.convertStepsToDomPoint(a)};
this.convertDomPointToCursorStep=function(a,b,c){return C.convertDomPointToSteps(a,b,c)};this.convertDomToCursorRange=function(a){var b;b=C.convertDomPointToSteps(a.anchorNode,a.anchorOffset);a=a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset?b:C.convertDomPointToSteps(a.focusNode,a.focusOffset);return{position:b,length:a-b}};this.convertCursorToDomRange=function(a,b){var c=d().createRange(),e,f;e=C.convertStepsToDomPoint(a);b?(f=C.convertStepsToDomPoint(a+b),0<b?(c.setStart(e.node,e.offset),
c.setEnd(f.node,f.offset)):(c.setStart(f.node,f.offset),c.setEnd(e.node,e.offset))):c.setStart(e.node,e.offset);return c};this.getStyleElement=q;this.upgradeWhitespacesAtPosition=function(a){var b=h(a),b=new core.StepIterator(u,b),c,d=2;runtime.assert(b.isStep(),"positionIterator is not at a step (requested step: "+a+")");do{if(c=l.getContentBounds(b))if(a=c.container,c=c.startOffset,a.nodeType===Node.TEXT_NODE&&k.isSignificantWhitespace(a,c)){runtime.assert(" "===a.data[c],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");
var e=a.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),f=a.parentNode,g=a;e.appendChild(a.ownerDocument.createTextNode(" "));1===a.length?f.replaceChild(e,a):(a.deleteData(c,1),0<c&&(c<a.length&&a.splitText(c),g=a.nextSibling),f.insertBefore(e,g));a=e;b.setPosition(a,a.childNodes.length);b.roundToPreviousStep()}d-=1}while(0<d&&b.nextStep())};this.downgradeWhitespaces=r;this.downgradeWhitespacesAtPosition=function(a){a=h(a);a=new core.StepIterator(u,a);r(a)};this.getParagraphStyleElement=
n;this.getParagraphElement=p;this.getParagraphStyleAttributes=function(a){return(a=n(a))?f.getFormatting().getInheritedStyleAttributes(a,!1):null};this.getTextNodeAtStep=function(b,c){var e=h(b),f=e.container(),k,l=0,g=null;f.nodeType===Node.TEXT_NODE?(k=f,l=e.unfilteredDomOffset(),0<k.length&&(0<l&&(k=k.splitText(l)),k.parentNode.insertBefore(d().createTextNode(""),k),k=k.previousSibling,l=0)):(k=d().createTextNode(""),l=0,f.insertBefore(k,e.rightNode()));if(c){if(s[c]&&a.getCursorPosition(c)===
b){for(g=s[c].getNode();g.nextSibling&&"cursor"===g.nextSibling.localName;)g.parentNode.insertBefore(g.nextSibling,g);0<k.length&&k.nextSibling!==g&&(k=d().createTextNode(""),l=0);g.parentNode.insertBefore(k,g)}}else for(;k.nextSibling&&"cursor"===k.nextSibling.localName;)k.parentNode.insertBefore(k.nextSibling,k);for(;k.previousSibling&&k.previousSibling.nodeType===Node.TEXT_NODE;)e=k.previousSibling,e.appendData(k.data),l=e.length,k=e,k.parentNode.removeChild(k.nextSibling);for(;k.nextSibling&&
k.nextSibling.nodeType===Node.TEXT_NODE;)e=k.nextSibling,k.appendData(e.data),k.parentNode.removeChild(e);return{textNode:k,offset:l}};this.fixCursorPositions=function(){Object.keys(s).forEach(function(d){var e=s[d],f=c(e.getNode()),k=a.createRootFilter(f),h,l,g,n=!1;g=e.getSelectedRange();h=b(g.startContainer,g.startOffset,f);l=m(g.startContainer,g.startOffset,[u,k],h);g.collapsed?f=l:(h=b(g.endContainer,g.endOffset,f),f=m(g.endContainer,g.endOffset,[u,k],h));l.isStep()&&f.isStep()?l.container()!==
f.container()||l.offset()!==f.offset()||g.collapsed&&e.getAnchorNode()===e.getNode()||(n=!0,g.setStart(l.container(),l.offset()),g.collapse(!0)):(n=!0,runtime.assert(l.roundToClosestStep(),"No walkable step found for cursor owned by "+d),g.setStart(l.container(),l.offset()),runtime.assert(f.roundToClosestStep(),"No walkable step found for cursor owned by "+d),g.setEnd(f.container(),f.offset()));n&&(e.setSelectedRange(g,e.hasForwardSelection()),a.emit(ops.Document.signalCursorMoved,e))})};this.getCursorPosition=
function(a){return(a=s[a])?C.convertDomPointToSteps(a.getNode(),0):0};this.getCursorSelection=function(a){a=s[a];var b=0,c=0;a&&(b=C.convertDomPointToSteps(a.getNode(),0),c=C.convertDomPointToSteps(a.getAnchorNode(),0));return{position:c,length:b-c}};this.getPositionFilter=function(){return u};this.getOdfCanvas=function(){return f};this.getCanvas=function(){return f};this.getRootNode=g;this.addMember=function(a){runtime.assert(void 0===w[a.getMemberId()],"This member already exists");w[a.getMemberId()]=
a};this.getMember=function(a){return w.hasOwnProperty(a)?w[a]:null};this.removeMember=function(a){delete w[a]};this.getCursor=function(a){return s[a]};this.getMemberIds=function(){var a=[],b;for(b in s)s.hasOwnProperty(b)&&a.push(s[b].getMemberId());return a};this.addCursor=function(b){runtime.assert(Boolean(b),"OdtDocument::addCursor without cursor");var c=b.getMemberId(),d=a.convertCursorToDomRange(0,0);runtime.assert("string"===typeof c,"OdtDocument::addCursor has cursor without memberid");runtime.assert(!s[c],
"OdtDocument::addCursor is adding a duplicate cursor with memberid "+c);b.setSelectedRange(d,!0);s[c]=b};this.removeCursor=function(b){var c=s[b];return c?(c.removeFromDocument(),delete s[b],a.emit(ops.Document.signalCursorRemoved,b),!0):!1};this.moveCursor=function(b,c,d,e){b=s[b];c=a.convertCursorToDomRange(c,d);b&&(b.setSelectedRange(c,0<=d),b.setSelectionType(e||ops.OdtCursor.RangeSelection))};this.getFormatting=function(){return f.getFormatting()};this.emit=function(a,b){x.emit(a,b)};this.subscribe=
function(a,b){x.subscribe(a,b)};this.unsubscribe=function(a,b){x.unsubscribe(a,b)};this.createRootFilter=function(a){return new e(a)};this.close=function(a){a()};this.destroy=function(a){a()};u=new ops.TextPositionFilter(g);k=new odf.OdfUtils;t=new core.DomUtils;l=new odf.StepUtils;C=new ops.OdtStepsTranslator(g,gui.SelectionMover.createPositionIterator,u,500);x.subscribe(ops.OdtDocument.signalStepsInserted,C.handleStepsInserted);x.subscribe(ops.OdtDocument.signalStepsRemoved,C.handleStepsRemoved);
x.subscribe(ops.OdtDocument.signalOperationEnd,function(b){var c=b.spec(),d=c.memberid,e=(new Date(c.timestamp)).toISOString(),k=f.odfContainer(),h={setProperties:{},removedProperties:[]};b.isEdit&&("UpdateMetadata"===c.optype&&(h.setProperties=JSON.parse(JSON.stringify(c.setProperties)),c.removedProperties&&(h.removedProperties=c.removedProperties.attributes.split(","))),c=a.getMember(d).getProperties().fullName,k.setMetadata({"dc:creator":c,"dc:date":e},null),h.setProperties["dc:creator"]=c,h.setProperties["dc:date"]=
e,I||(h.setProperties["meta:editing-cycles"]=k.incrementEditingCycles(),k.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),I=b,a.emit(ops.OdtDocument.signalMetadataUpdated,h))});x.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)};ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";
ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";ops.OdtDocument.signalOperationStart="operation/start";ops.OdtDocument.signalOperationEnd="operation/end";ops.OdtDocument.signalProcessingBatchStart="router/batchstart";ops.OdtDocument.signalProcessingBatchEnd="router/batchend";ops.OdtDocument.signalUndoStackChanged="undo/changed";ops.OdtDocument.signalStepsInserted="steps/inserted";ops.OdtDocument.signalStepsRemoved="steps/removed";ops.OdtDocument.signalMetadataUpdated="metadata/updated";ops.OpAddAnnotation=function(){function f(c,d,e){var f=c.getTextNodeAtStep(e,g);f&&(c=f.textNode,e=c.parentNode,f.offset!==c.length&&c.splitText(f.offset),e.insertBefore(d,c.nextSibling),0===c.length&&e.removeChild(c))}var g,d,c,e,m,h;this.init=function(f){g=f.memberid;d=parseInt(f.timestamp,10);c=parseInt(f.position,10);e=parseInt(f.length,10)||0;m=f.name};this.isEdit=!0;this.group=void 0;this.execute=function(p){var q=p.getCursor(g),n,r;r=new core.DomUtils;h=p.getDOMDocument();var b=new Date(d),
a,l,k,t;a=h.createElementNS(odf.Namespaces.officens,"office:annotation");a.setAttributeNS(odf.Namespaces.officens,"office:name",m);n=h.createElementNS(odf.Namespaces.dcns,"dc:creator");n.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g);n.textContent=p.getMember(g).getProperties().fullName;l=h.createElementNS(odf.Namespaces.dcns,"dc:date");l.appendChild(h.createTextNode(b.toISOString()));b=h.createElementNS(odf.Namespaces.textns,"text:list");k=h.createElementNS(odf.Namespaces.textns,
"text:list-item");t=h.createElementNS(odf.Namespaces.textns,"text:p");k.appendChild(t);b.appendChild(k);a.appendChild(n);a.appendChild(l);a.appendChild(b);e&&(n=h.createElementNS(odf.Namespaces.officens,"office:annotation-end"),n.setAttributeNS(odf.Namespaces.officens,"office:name",m),a.annotationEndElement=n,f(p,n,c+e));f(p,a,c);p.emit(ops.OdtDocument.signalStepsInserted,{position:c});q&&(n=h.createRange(),r=r.getElementsByTagNameNS(a,odf.Namespaces.textns,"p")[0],n.selectNodeContents(r),q.setSelectedRange(n,
!1),q.setSelectionType(ops.OdtCursor.RangeSelection),p.emit(ops.Document.signalCursorMoved,q));p.getOdfCanvas().addAnnotation(a);p.fixCursorPositions();return!0};this.spec=function(){return{optype:"AddAnnotation",memberid:g,timestamp:d,position:c,length:e,name:m}}};ops.OpAddCursor=function(){var f,g;this.init=function(d){f=d.memberid;g=d.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(d){var c=d.getCursor(f);if(c)return!1;c=new ops.OdtCursor(f,d);d.addCursor(c);d.emit(ops.Document.signalCursorAdded,c);return!0};this.spec=function(){return{optype:"AddCursor",memberid:f,timestamp:g}}};ops.OpAddMember=function(){var f,g,d;this.init=function(c){f=c.memberid;g=parseInt(c.timestamp,10);d=c.setProperties};this.isEdit=!1;this.group=void 0;this.execute=function(c){var e;if(c.getMember(f))return!1;e=new ops.Member(f,d);c.addMember(e);c.emit(ops.Document.signalMemberAdded,e);return!0};this.spec=function(){return{optype:"AddMember",memberid:f,timestamp:g,setProperties:d}}};ops.OpAddStyle=function(){var f,g,d,c,e,m,h=odf.Namespaces.stylens;this.init=function(h){f=h.memberid;g=h.timestamp;d=h.styleName;c=h.styleFamily;e="true"===h.isAutomaticStyle||!0===h.isAutomaticStyle;m=h.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(f){var g=f.getOdfCanvas().odfContainer(),n=f.getFormatting(),r=f.getDOMDocument().createElementNS(h,"style:style");if(!r)return!1;m&&n.updateStyle(r,m);r.setAttributeNS(h,"style:family",c);r.setAttributeNS(h,"style:name",d);e?
g.rootElement.automaticStyles.appendChild(r):g.rootElement.styles.appendChild(r);f.getOdfCanvas().refreshCSS();e||f.emit(ops.OdtDocument.signalCommonStyleCreated,{name:d,family:c});return!0};this.spec=function(){return{optype:"AddStyle",memberid:f,timestamp:g,styleName:d,styleFamily:c,isAutomaticStyle:e,setProperties:m}}};odf.ObjectNameGenerator=function(f,g){function d(a,b){var c={};this.generateName=function(){var d=b(),e=0,f;do f=a+e,e+=1;while(c[f]||d[f]);c[f]=!0;return f}}function c(){var a={};[f.rootElement.automaticStyles,f.rootElement.styles].forEach(function(b){for(b=b.firstElementChild;b;)b.namespaceURI===e&&"style"===b.localName&&(a[b.getAttributeNS(e,"name")]=!0),b=b.nextElementSibling});return a}var e=odf.Namespaces.stylens,m=odf.Namespaces.drawns,h=odf.Namespaces.xlinkns,p=new core.DomUtils,q=(new core.Utils).hashString(g),
n=null,r=null,b=null,a={},l={};this.generateStyleName=function(){null===n&&(n=new d("auto"+q+"_",function(){return c()}));return n.generateName()};this.generateFrameName=function(){null===r&&(p.getElementsByTagNameNS(f.rootElement.body,m,"frame").forEach(function(b){a[b.getAttributeNS(m,"name")]=!0}),r=new d("fr"+q+"_",function(){return a}));return r.generateName()};this.generateImageName=function(){null===b&&(p.getElementsByTagNameNS(f.rootElement.body,m,"image").forEach(function(a){a=a.getAttributeNS(h,
"href");a=a.substring(9,a.lastIndexOf("."));l[a]=!0}),b=new d("img"+q+"_",function(){return l}));return b.generateName()}};odf.TextStyleApplicator=function(f,g,d){function c(c){function d(a,b){return"object"===typeof a&&"object"===typeof b?Object.keys(a).every(function(c){return d(a[c],b[c])}):a===b}var b={};this.isStyleApplied=function(a){a=g.getAppliedStylesForElement(a,b);return d(c,a)}}function e(c){var e={};this.applyStyleToContainer=function(b){var a;a=b.getAttributeNS(p,"style-name");var h=b.ownerDocument;a=a||"";if(!e.hasOwnProperty(a)){var k=a,m;m=a?g.createDerivedStyleObject(a,"text",c):c;h=h.createElementNS(q,
"style:style");g.updateStyle(h,m);h.setAttributeNS(q,"style:name",f.generateStyleName());h.setAttributeNS(q,"style:family","text");h.setAttributeNS("urn:webodf:names:scope","scope","document-content");d.appendChild(h);e[k]=h}a=e[a].getAttributeNS(q,"name");b.setAttributeNS(p,"text:style-name",a)}}function m(c,d){var b=c.ownerDocument,a=c.parentNode,e,f,g,m=new core.LoopWatchDog(1E4);f=[];f.push(c);for(g=c.nextSibling;g&&h.rangeContainsNode(d,g);)m.check(),f.push(g),g=g.nextSibling;"span"!==a.localName||
a.namespaceURI!==p?(e=b.createElementNS(p,"text:span"),a.insertBefore(e,c),b=!1):(c.previousSibling&&!h.rangeContainsNode(d,a.firstChild)?(e=a.cloneNode(!1),a.parentNode.insertBefore(e,a.nextSibling)):e=a,b=!0);f.forEach(function(a){a.parentNode!==e&&e.appendChild(a)});if(g&&b)for(f=e.cloneNode(!1),e.parentNode.insertBefore(f,e.nextSibling);g;)m.check(),b=g.nextSibling,f.appendChild(g),g=b;return e}var h=new core.DomUtils,p=odf.Namespaces.textns,q=odf.Namespaces.stylens;this.applyStyle=function(d,
f,b){var a={},h,k,g,p;runtime.assert(b&&b.hasOwnProperty("style:text-properties"),"applyStyle without any text properties");a["style:text-properties"]=b["style:text-properties"];g=new e(a);p=new c(a);d.forEach(function(a){h=p.isStyleApplied(a);!1===h&&(k=m(a,f),g.applyStyleToContainer(k))})}};ops.OpApplyDirectStyling=function(){function f(c,d,e){var b=c.getOdfCanvas().odfContainer(),a=p.splitBoundaries(d),f=h.getTextNodes(d,!1);(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(b,g),c.getFormatting(),b.rootElement.automaticStyles)).applyStyle(f,d,e);a.forEach(p.normalizeTextNodes)}var g,d,c,e,m,h=new odf.OdfUtils,p=new core.DomUtils;this.init=function(f){g=f.memberid;d=f.timestamp;c=parseInt(f.position,10);e=parseInt(f.length,10);m=f.setProperties};this.isEdit=!0;this.group=void 0;
this.execute=function(p){var n=p.convertCursorToDomRange(c,e),r=h.getParagraphElements(n);f(p,n,m);n.detach();p.getOdfCanvas().refreshCSS();p.fixCursorPositions();r.forEach(function(b){p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:b,memberId:g,timeStamp:d})});p.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:g,timestamp:d,position:c,length:e,setProperties:m}}};ops.OpApplyHyperlink=function(){function f(c){for(;c;){if(p.isHyperlink(c))return!0;c=c.parentNode}return!1}var g,d,c,e,m,h=new core.DomUtils,p=new odf.OdfUtils;this.init=function(f){g=f.memberid;d=f.timestamp;c=f.position;e=f.length;m=f.hyperlink};this.isEdit=!0;this.group=void 0;this.execute=function(q){var n=q.getDOMDocument(),r=q.convertCursorToDomRange(c,e),b=h.splitBoundaries(r),a=[],l=p.getTextNodes(r,!1);if(0===l.length)return!1;l.forEach(function(b){var c=p.getParagraphElement(b);runtime.assert(!1===
f(b),"The given range should not contain any link.");var d=m,e=n.createElementNS(odf.Namespaces.textns,"text:a");e.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple");e.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",d);b.parentNode.insertBefore(e,b);e.appendChild(b);-1===a.indexOf(c)&&a.push(c)});b.forEach(h.normalizeTextNodes);r.detach();q.getOdfCanvas().refreshSize();q.getOdfCanvas().rerenderAnnotations();a.forEach(function(a){q.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,
memberId:g,timeStamp:d})});return!0};this.spec=function(){return{optype:"ApplyHyperlink",memberid:g,timestamp:d,position:c,length:e,hyperlink:m}}};ops.OpInsertImage=function(){var f,g,d,c,e,m,h,p,q=odf.Namespaces.drawns,n=odf.Namespaces.svgns,r=odf.Namespaces.textns,b=odf.Namespaces.xlinkns;this.init=function(a){f=a.memberid;g=a.timestamp;d=a.position;c=a.filename;e=a.frameWidth;m=a.frameHeight;h=a.frameStyleName;p=a.frameName};this.isEdit=!0;this.group=void 0;this.execute=function(a){var l=a.getOdfCanvas(),k=a.getTextNodeAtStep(d,f),t,s;if(!k)return!1;t=k.textNode;s=a.getParagraphElement(t);var k=k.offset!==t.length?t.splitText(k.offset):t.nextSibling,
w=a.getDOMDocument(),x=w.createElementNS(q,"draw:image"),w=w.createElementNS(q,"draw:frame");x.setAttributeNS(b,"xlink:href",c);x.setAttributeNS(b,"xlink:type","simple");x.setAttributeNS(b,"xlink:show","embed");x.setAttributeNS(b,"xlink:actuate","onLoad");w.setAttributeNS(q,"draw:style-name",h);w.setAttributeNS(q,"draw:name",p);w.setAttributeNS(r,"text:anchor-type","as-char");w.setAttributeNS(n,"svg:width",e);w.setAttributeNS(n,"svg:height",m);w.appendChild(x);t.parentNode.insertBefore(w,k);a.emit(ops.OdtDocument.signalStepsInserted,
{position:d});0===t.length&&t.parentNode.removeChild(t);l.addCssForFrameWithImage(w);l.refreshCSS();a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:s,memberId:f,timeStamp:g});l.rerenderAnnotations();return!0};this.spec=function(){return{optype:"InsertImage",memberid:f,timestamp:g,filename:c,position:d,frameWidth:e,frameHeight:m,frameStyleName:h,frameName:p}}};ops.OpInsertTable=function(){function f(d,b){var a;if(1===n.length)a=n[0];else if(3===n.length)switch(d){case 0:a=n[0];break;case c-1:a=n[2];break;default:a=n[1]}else a=n[d];if(1===a.length)return a[0];if(3===a.length)switch(b){case 0:return a[0];case e-1:return a[2];default:return a[1]}return a[b]}var g,d,c,e,m,h,p,q,n;this.init=function(f){g=f.memberid;d=f.timestamp;m=f.position;c=f.initialRows;e=f.initialColumns;h=f.tableName;p=f.tableStyleName;q=f.tableColumnStyleName;n=f.tableCellStyleMatrix};
this.isEdit=!0;this.group=void 0;this.execute=function(n){var b=n.getTextNodeAtStep(m),a=n.getRootNode();if(b){var l=n.getDOMDocument(),k=l.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),t=l.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),s,w,x,v;p&&k.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",p);h&&k.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",h);t.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0",
"table:number-columns-repeated",e);q&&t.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",q);k.appendChild(t);for(x=0;x<c;x+=1){t=l.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(v=0;v<e;v+=1)s=l.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(w=f(x,v))&&s.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",w),w=l.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0",
"text:p"),s.appendChild(w),t.appendChild(s);k.appendChild(t)}b=n.getParagraphElement(b.textNode);a.insertBefore(k,b.nextSibling);n.emit(ops.OdtDocument.signalStepsInserted,{position:m});n.getOdfCanvas().refreshSize();n.emit(ops.OdtDocument.signalTableAdded,{tableElement:k,memberId:g,timeStamp:d});n.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertTable",memberid:g,timestamp:d,position:m,initialRows:c,initialColumns:e,tableName:h,tableStyleName:p,tableColumnStyleName:q,
tableCellStyleMatrix:n}}};ops.OpInsertText=function(){var f,g,d,c,e,m=new odf.OdfUtils;this.init=function(h){f=h.memberid;g=h.timestamp;d=h.position;e=h.text;c="true"===h.moveCursor||!0===h.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(h){var p,q,n,r=null,b=h.getDOMDocument(),a,l=0,k,t=h.getCursor(f),s;h.upgradeWhitespacesAtPosition(d);if(p=h.getTextNodeAtStep(d)){q=p.textNode;r=q.nextSibling;n=q.parentNode;a=h.getParagraphElement(q);for(s=0;s<e.length;s+=1)if("\t"===e[s]||"\t"!==e[s]&&m.isODFWhitespace(e[s])&&
(0===s||s===e.length-1||"\t"!==e[s-1]&&m.isODFWhitespace(e[s-1])))0===l?(p.offset!==q.length&&(r=q.splitText(p.offset)),0<s&&q.appendData(e.substring(0,s))):l<s&&(l=e.substring(l,s),n.insertBefore(b.createTextNode(l),r)),l=s+1,"\t"===e[s]?(k=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),k.appendChild(b.createTextNode("\t"))):(" "!==e[s]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+e.charCodeAt(s)+")"),
k=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),k.appendChild(b.createTextNode(" "))),n.insertBefore(k,r);0===l?q.insertData(p.offset,e):l<e.length&&(p=e.substring(l),n.insertBefore(b.createTextNode(p),r));n=q.parentNode;r=q.nextSibling;n.removeChild(q);n.insertBefore(q,r);0===q.length&&q.parentNode.removeChild(q);h.emit(ops.OdtDocument.signalStepsInserted,{position:d});t&&c&&(h.moveCursor(f,d+e.length,0),h.emit(ops.Document.signalCursorMoved,t));h.downgradeWhitespacesAtPosition(d);
h.downgradeWhitespacesAtPosition(d+e.length);h.getOdfCanvas().refreshSize();h.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,memberId:f,timeStamp:g});h.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertText",memberid:f,timestamp:g,position:d,text:e,moveCursor:c}}};odf.CollapsingRules=function(f){function g(d){return c.isODFNode(d)||"br"===d.localName&&c.isLineBreak(d.parentNode)||d.nodeType===Node.TEXT_NODE&&c.isODFNode(d.parentNode)}function d(m){var h;m.nodeType===Node.TEXT_NODE?(h=m.parentNode,h.removeChild(m)):h=e.removeUnwantedNodes(m,g);return h&&!c.isParagraph(h)&&h!==f&&c.hasNoODFContent(h)?d(h):h}var c=new odf.OdfUtils,e=new core.DomUtils;this.mergeChildrenIntoParent=d};ops.OpMergeParagraph=function(){function f(a){a.collapsed||(r.splitBoundaries(a),a=n.getTextElements(a,!1,!0),a.forEach(function(a){runtime.assert(a.nodeType===Node.TEXT_NODE,"Expected node type 3 (Node.TEXT_NODE), found node type "+a.nodeType);0<a.length?(runtime.assert(n.isODFWhitespace(a.data),"Non-whitespace node found between paragraph boundary and first or last step"),runtime.assert(!1===n.isSignificantWhitespace(a,0),"Significant whitespace node found between paragraph boundary and first or last step")):
runtime.log("WARN: Empty text node found during merge operation");a.parentNode.removeChild(a)}))}function g(a,b){var c=b.ownerDocument.createRange();a.setPosition(b,0);a.roundToNextStep();c.setStart(b,0);c.setEnd(a.container(),a.offset());f(c);a.setPosition(b,b.childNodes.length);a.roundToPreviousStep();c.setStart(a.container(),a.offset());c.setEnd(b,b.childNodes.length);f(c)}function d(a,b){var c=a.convertCursorStepToDomPoint(b),c=n.getParagraphElement(c.node,c.offset);runtime.assert(Boolean(c),
"Paragraph not found at step "+b);return c}var c,e,m,h,p,q,n=new odf.OdfUtils,r=new core.DomUtils,b=odf.Namespaces.textns;this.init=function(a){c=a.memberid;e=a.timestamp;m=a.moveCursor;h=a.paragraphStyleName;p=parseInt(a.sourceStartPosition,10);q=parseInt(a.destinationStartPosition,10)};this.isEdit=!0;this.group=void 0;this.execute=function(a){var f,k,t=a.getCursor(c);f=a.getRootNode();var s=new odf.CollapsingRules(f),w=a.createStepIterator(f,0,[a.getPositionFilter()],f),x;runtime.assert(q<p,"Destination paragraph ("+
q+") must be before source paragraph ("+p+")");k=d(a,q);f=d(a,p);w.setPosition(f,0);w.previousStep();runtime.assert(r.containsNode(k,w.container()),"Destination paragraph must be adjacent to the source paragraph");g(w,k);x=k.childNodes.length;g(w,f);var v;for(v=f.firstChild;v;)"editinfo"===v.localName||n.isGroupingElement(v)&&n.hasNoODFContent(v)?f.removeChild(v):k.appendChild(v),v=f.firstChild;s.mergeChildrenIntoParent(f);a.emit(ops.OdtDocument.signalStepsRemoved,{position:p-1});w.setPosition(k,
x);w.roundToClosestStep();w.previousStep()||w.roundToNextStep();a.downgradeWhitespaces(w);h?k.setAttributeNS(b,"text:style-name",h):k.removeAttributeNS(b,"style-name");t&&m&&(a.moveCursor(c,p-1,0),a.emit(ops.Document.signalCursorMoved,t));a.fixCursorPositions();a.getOdfCanvas().refreshSize();a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:k,memberId:c,timeStamp:e});a.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"MergeParagraph",memberid:c,timestamp:e,
moveCursor:m,paragraphStyleName:h,sourceStartPosition:p,destinationStartPosition:q}}};ops.OpMoveCursor=function(){var f,g,d,c,e;this.init=function(m){f=m.memberid;g=m.timestamp;d=m.position;c=m.length||0;e=m.selectionType||ops.OdtCursor.RangeSelection};this.isEdit=!1;this.group=void 0;this.execute=function(g){var h=g.getCursor(f),p;if(!h)return!1;p=g.convertCursorToDomRange(d,c);h.setSelectedRange(p,0<=c);h.setSelectionType(e);g.emit(ops.Document.signalCursorMoved,h);return!0};this.spec=function(){return{optype:"MoveCursor",memberid:f,timestamp:g,position:d,length:c,selectionType:e}}};ops.OpRemoveAnnotation=function(){var f,g,d,c,e;this.init=function(m){f=m.memberid;g=m.timestamp;d=parseInt(m.position,10);c=parseInt(m.length,10);e=new core.DomUtils};this.isEdit=!0;this.group=void 0;this.execute=function(c){function f(c){q.parentNode.insertBefore(c,q)}for(var g=c.getIteratorAtPosition(d).container(),q;g.namespaceURI!==odf.Namespaces.officens||"annotation"!==g.localName;)g=g.parentNode;if(null===g)return!1;q=g;g=q.annotationEndElement;c.getOdfCanvas().forgetAnnotations();e.getElementsByTagNameNS(q,
"urn:webodf:names:cursor","cursor").forEach(f);e.getElementsByTagNameNS(q,"urn:webodf:names:cursor","anchor").forEach(f);q.parentNode.removeChild(q);g&&g.parentNode.removeChild(g);c.emit(ops.OdtDocument.signalStepsRemoved,{position:0<d?d-1:d});c.fixCursorPositions();c.getOdfCanvas().refreshAnnotations();return!0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:f,timestamp:g,position:d,length:c}}};ops.OpRemoveBlob=function(){var f,g,d;this.init=function(c){f=c.memberid;g=c.timestamp;d=c.filename};this.isEdit=!0;this.group=void 0;this.execute=function(c){c.getOdfCanvas().odfContainer().removeBlob(d);return!0};this.spec=function(){return{optype:"RemoveBlob",memberid:f,timestamp:g,filename:d}}};ops.OpRemoveCursor=function(){var f,g;this.init=function(d){f=d.memberid;g=d.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(d){return d.removeCursor(f)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:f,timestamp:g}}};ops.OpRemoveHyperlink=function(){var f,g,d,c,e=new core.DomUtils,m=new odf.OdfUtils;this.init=function(e){f=e.memberid;g=e.timestamp;d=e.position;c=e.length};this.isEdit=!0;this.group=void 0;this.execute=function(h){var p=h.convertCursorToDomRange(d,c),q=m.getHyperlinkElements(p);runtime.assert(1===q.length,"The given range should only contain a single link.");q=e.mergeIntoParent(q[0]);p.detach();h.getOdfCanvas().refreshSize();h.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:m.getParagraphElement(q),
memberId:f,timeStamp:g});h.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveHyperlink",memberid:f,timestamp:g,position:d,length:c}}};ops.OpRemoveMember=function(){var f,g;this.init=function(d){f=d.memberid;g=parseInt(d.timestamp,10)};this.isEdit=!1;this.group=void 0;this.execute=function(d){if(!d.getMember(f))return!1;d.removeMember(f);d.emit(ops.Document.signalMemberRemoved,f);return!0};this.spec=function(){return{optype:"RemoveMember",memberid:f,timestamp:g}}};ops.OpRemoveStyle=function(){var f,g,d,c;this.init=function(e){f=e.memberid;g=e.timestamp;d=e.styleName;c=e.styleFamily};this.isEdit=!0;this.group=void 0;this.execute=function(e){var f=e.getStyleElement(d,c);if(!f)return!1;f.parentNode.removeChild(f);e.getOdfCanvas().refreshCSS();e.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:d,family:c});return!0};this.spec=function(){return{optype:"RemoveStyle",memberid:f,timestamp:g,styleName:d,styleFamily:c}}};ops.OpRemoveText=function(){var f,g,d,c,e,m;this.init=function(h){runtime.assert(0<=h.length,"OpRemoveText only supports positive lengths");f=h.memberid;g=h.timestamp;d=parseInt(h.position,10);c=parseInt(h.length,10);e=new odf.OdfUtils;m=new core.DomUtils};this.isEdit=!0;this.group=void 0;this.execute=function(h){var p,q,n,r=h.getCursor(f),b=new odf.CollapsingRules(h.getRootNode());h.upgradeWhitespacesAtPosition(d);h.upgradeWhitespacesAtPosition(d+c);p=h.convertCursorToDomRange(d,c);m.splitBoundaries(p);
q=e.getTextElements(p,!1,!0);n=e.getParagraphElement(p.startContainer,p.startOffset);runtime.assert(void 0!==n,"Attempting to remove text outside a paragraph element");p.detach();q.forEach(function(a){a.parentNode?(runtime.assert(m.containsNode(n,a),"RemoveText only supports removing elements within the same paragraph"),b.mergeChildrenIntoParent(a)):runtime.log("WARN: text element has already been removed from it's container")});h.emit(ops.OdtDocument.signalStepsRemoved,{position:d});h.downgradeWhitespacesAtPosition(d);
h.fixCursorPositions();h.getOdfCanvas().refreshSize();h.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:n,memberId:f,timeStamp:g});r&&(r.resetSelectionType(),h.emit(ops.Document.signalCursorMoved,r));h.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveText",memberid:f,timestamp:g,position:d,length:c}}};ops.OpSetBlob=function(){var f,g,d,c,e;this.init=function(m){f=m.memberid;g=m.timestamp;d=m.filename;c=m.mimetype;e=m.content};this.isEdit=!0;this.group=void 0;this.execute=function(f){f.getOdfCanvas().odfContainer().setBlob(d,c,e);return!0};this.spec=function(){return{optype:"SetBlob",memberid:f,timestamp:g,filename:d,mimetype:c,content:e}}};ops.OpSetParagraphStyle=function(){function f(c,d,e){var f=[c.getPositionFilter()],g=e.container();e=e.unfilteredDomOffset();return!1===c.createStepIterator(g,e,f,d).previousStep()}var g,d,c,e;this.init=function(f){g=f.memberid;d=f.timestamp;c=f.position;e=f.styleName};this.isEdit=!0;this.group=void 0;this.execute=function(m){var h,p;h=m.getIteratorAtPosition(c);return(p=m.getParagraphElement(h.container()))?(runtime.assert(f(m,p,h),"SetParagraphStyle position should be the first position in the paragraph"),
e?p.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",e):p.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),m.getOdfCanvas().refreshSize(),m.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,timeStamp:d,memberId:g}),m.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:g,timestamp:d,position:c,styleName:e}}};ops.OpSplitParagraph=function(){var f,g,d,c,e,m,h,p=odf.Namespaces.textns;this.init=function(p){f=p.memberid;g=p.timestamp;c=p.position;d=p.sourceParagraphPosition;m=p.paragraphStyleName;e="true"===p.moveCursor||!0===p.moveCursor;h=new odf.OdfUtils};this.isEdit=!0;this.group=void 0;this.execute=function(d){var n,r,b,a,l,k,t,s=d.getCursor(f);d.upgradeWhitespacesAtPosition(c);n=d.getTextNodeAtStep(c);if(!n)return!1;r=d.getParagraphElement(n.textNode);if(!r)return!1;b=h.isListItem(r.parentNode)?r.parentNode:
r;0===n.offset?(t=n.textNode.previousSibling,k=null):(t=n.textNode,k=n.offset>=n.textNode.length?null:n.textNode.splitText(n.offset));for(a=n.textNode;a!==b;){a=a.parentNode;l=a.cloneNode(!1);k&&l.appendChild(k);if(t)for(;t&&t.nextSibling;)l.appendChild(t.nextSibling);else for(;a.firstChild;)l.appendChild(a.firstChild);a.parentNode.insertBefore(l,a.nextSibling);t=a;k=l}h.isListItem(k)&&(k=k.childNodes.item(0));m?k.setAttributeNS(p,"text:style-name",m):k.removeAttributeNS(p,"style-name");0===n.textNode.length&&
n.textNode.parentNode.removeChild(n.textNode);d.emit(ops.OdtDocument.signalStepsInserted,{position:c});s&&e&&(d.moveCursor(f,c+1,0),d.emit(ops.Document.signalCursorMoved,s));d.fixCursorPositions();d.getOdfCanvas().refreshSize();d.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:r,memberId:f,timeStamp:g});d.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:k,memberId:f,timeStamp:g});d.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"SplitParagraph",
memberid:f,timestamp:g,position:c,sourceParagraphPosition:d,paragraphStyleName:m,moveCursor:e}}};ops.OpUpdateMember=function(){function f(d){var e="//dc:creator[@editinfo:memberid='"+g+"']";d=xmldom.XPath.getODFElementsWithXPath(d.getRootNode(),e,function(c){return"editinfo"===c?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(c)});for(e=0;e<d.length;e+=1)d[e].textContent=c.fullName}var g,d,c,e;this.init=function(f){g=f.memberid;d=parseInt(f.timestamp,10);c=f.setProperties;e=f.removedProperties};this.isEdit=!1;this.group=void 0;this.execute=function(d){var h=d.getMember(g);if(!h)return!1;
e&&h.removeProperties(e);c&&(h.setProperties(c),c.fullName&&f(d));d.emit(ops.Document.signalMemberUpdated,h);return!0};this.spec=function(){return{optype:"UpdateMember",memberid:g,timestamp:d,setProperties:c,removedProperties:e}}};ops.OpUpdateMetadata=function(){var f,g,d,c;this.init=function(e){f=e.memberid;g=parseInt(e.timestamp,10);d=e.setProperties;c=e.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(e){e=e.getOdfCanvas().odfContainer();var f=null;c&&(f=c.attributes.split(","));e.setMetadata(d,f);return!0};this.spec=function(){return{optype:"UpdateMetadata",memberid:f,timestamp:g,setProperties:d,removedProperties:c}}};ops.OpUpdateParagraphStyle=function(){function f(c,d){var e,f,b=d?d.split(","):[];for(e=0;e<b.length;e+=1)f=b[e].split(":"),c.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(f[0]),f[1])}var g,d,c,e,m,h=odf.Namespaces.stylens;this.init=function(f){g=f.memberid;d=f.timestamp;c=f.styleName;e=f.setProperties;m=f.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(d){var g=d.getFormatting(),n,r,b;return(n=""!==c?d.getParagraphStyleElement(c):g.getDefaultStyleElement("paragraph"))?
(r=n.getElementsByTagNameNS(h,"paragraph-properties").item(0),b=n.getElementsByTagNameNS(h,"text-properties").item(0),e&&g.updateStyle(n,e),m&&(g=m["style:paragraph-properties"],r&&g&&(f(r,g.attributes),0===r.attributes.length&&n.removeChild(r)),g=m["style:text-properties"],b&&g&&(f(b,g.attributes),0===b.attributes.length&&n.removeChild(b)),f(n,m.attributes)),d.getOdfCanvas().refreshCSS(),d.emit(ops.OdtDocument.signalParagraphStyleModified,c),d.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=
function(){return{optype:"UpdateParagraphStyle",memberid:g,timestamp:d,styleName:c,setProperties:e,removedProperties:m}}};ops.OperationFactory=function(){function f(d){return function(c){return new d}}var g;this.register=function(d,c){g[d]=c};this.create=function(d){var c=null,e=g[d.optype];e&&(c=e(d),c.init(d));return c};g={AddMember:f(ops.OpAddMember),UpdateMember:f(ops.OpUpdateMember),RemoveMember:f(ops.OpRemoveMember),AddCursor:f(ops.OpAddCursor),ApplyDirectStyling:f(ops.OpApplyDirectStyling),SetBlob:f(ops.OpSetBlob),RemoveBlob:f(ops.OpRemoveBlob),InsertImage:f(ops.OpInsertImage),InsertTable:f(ops.OpInsertTable),
InsertText:f(ops.OpInsertText),RemoveText:f(ops.OpRemoveText),MergeParagraph:f(ops.OpMergeParagraph),SplitParagraph:f(ops.OpSplitParagraph),SetParagraphStyle:f(ops.OpSetParagraphStyle),UpdateParagraphStyle:f(ops.OpUpdateParagraphStyle),AddStyle:f(ops.OpAddStyle),RemoveStyle:f(ops.OpRemoveStyle),MoveCursor:f(ops.OpMoveCursor),RemoveCursor:f(ops.OpRemoveCursor),AddAnnotation:f(ops.OpAddAnnotation),RemoveAnnotation:f(ops.OpRemoveAnnotation),UpdateMetadata:f(ops.OpUpdateMetadata),ApplyHyperlink:f(ops.OpApplyHyperlink),
RemoveHyperlink:f(ops.OpRemoveHyperlink)}};ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(f){};ops.OperationRouter.prototype.setPlaybackFunction=function(f){};ops.OperationRouter.prototype.push=function(f){};ops.OperationRouter.prototype.close=function(f){};ops.OperationRouter.prototype.subscribe=function(f,g){};ops.OperationRouter.prototype.unsubscribe=function(f,g){};ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){};ops.OperationRouter.prototype.hasSessionHostConnection=function(){};
ops.OperationRouter.signalProcessingBatchStart="router/batchstart";ops.OperationRouter.signalProcessingBatchEnd="router/batchend";ops.TrivialOperationRouter=function(){var f=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),g,d,c=0;this.setOperationFactory=function(c){g=c};this.setPlaybackFunction=function(c){d=c};this.push=function(e){c+=1;f.emit(ops.OperationRouter.signalProcessingBatchStart,{});e.forEach(function(e){e=e.spec();e.timestamp=Date.now();e=g.create(e);e.group="g"+c;d(e)});f.emit(ops.OperationRouter.signalProcessingBatchEnd,{})};this.close=function(c){c()};
this.subscribe=function(c,d){f.subscribe(c,d)};this.unsubscribe=function(c,d){f.unsubscribe(c,d)};this.hasLocalUnsyncedOps=function(){return!1};this.hasSessionHostConnection=function(){return!0}};ops.Session=function(f){function g(c){e.emit(ops.OdtDocument.signalProcessingBatchStart,c)}function d(c){e.emit(ops.OdtDocument.signalProcessingBatchEnd,c)}var c=new ops.OperationFactory,e=new ops.OdtDocument(f),m=null;this.setOperationFactory=function(d){c=d;m&&m.setOperationFactory(c)};this.setOperationRouter=function(f){m&&(m.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,g),m.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,d));m=f;m.subscribe(ops.OperationRouter.signalProcessingBatchStart,
g);m.subscribe(ops.OperationRouter.signalProcessingBatchEnd,d);f.setPlaybackFunction(function(c){e.emit(ops.OdtDocument.signalOperationStart,c);return c.execute(e)?(e.emit(ops.OdtDocument.signalOperationEnd,c),!0):!1});f.setOperationFactory(c)};this.getOperationFactory=function(){return c};this.getOdtDocument=function(){return e};this.enqueue=function(c){m.push(c)};this.close=function(c){m.close(function(d){d?c(d):e.close(c)})};this.destroy=function(c){e.destroy(c)};this.setOperationRouter(new ops.TrivialOperationRouter)};gui.AnnotationController=function(f,g,d){function c(){var b=p.getCursor(d),b=b&&b.getNode(),a=!1;b&&(a=!r.isWithinAnnotation(b,p.getRootNode()));a!==q&&(q=a,n.emit(gui.AnnotationController.annotatableChanged,q))}function e(b){b.getMemberId()===d&&c()}function m(b){b===d&&c()}function h(b){b.getMemberId()===d&&c()}var p=f.getOdtDocument(),q=!1,n=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),r=new odf.OdfUtils;this.isAnnotatable=function(){return q};this.addAnnotation=function(){var b=
new ops.OpAddAnnotation,a=p.getCursorSelection(d),c=a.length,a=a.position;q&&(a=0<=c?a:a+c,c=Math.abs(c),b.init({memberid:d,position:a,length:c,name:d+Date.now()}),f.enqueue([b]))};this.removeAnnotation=function(b){var a,c;a=p.getMember(d).getProperties().fullName;if(!0!==g.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||a===r.getAnnotationCreator(b))a=p.convertDomPointToCursorStep(b,0)+1,c=p.convertDomPointToCursorStep(b,b.childNodes.length),b=new ops.OpRemoveAnnotation,b.init({memberid:d,
position:a,length:c-a}),c=new ops.OpMoveCursor,c.init({memberid:d,position:0<a?a-1:a,length:0}),f.enqueue([b,c])};this.subscribe=function(b,a){n.subscribe(b,a)};this.unsubscribe=function(b,a){n.unsubscribe(b,a)};this.destroy=function(b){p.unsubscribe(ops.Document.signalCursorAdded,e);p.unsubscribe(ops.Document.signalCursorRemoved,m);p.unsubscribe(ops.Document.signalCursorMoved,h);b()};g.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN);p.subscribe(ops.Document.signalCursorAdded,
e);p.subscribe(ops.Document.signalCursorRemoved,m);p.subscribe(ops.Document.signalCursorMoved,h);c()};gui.AnnotationController.annotatableChanged="annotatable/changed";gui.Avatar=function(f,g){var d=this,c,e,m;this.setColor=function(c){e.style.borderColor=c};this.setImageUrl=function(c){d.isVisible()?e.src=c:m=c};this.isVisible=function(){return"block"===c.style.display};this.show=function(){m&&(e.src=m,m=void 0);c.style.display="block"};this.hide=function(){c.style.display="none"};this.markAsFocussed=function(d){d?c.classList.add("active"):c.classList.remove("active")};this.destroy=function(d){f.removeChild(c);d()};(function(){var d=f.ownerDocument,m=d.documentElement.namespaceURI;
c=d.createElementNS(m,"div");e=d.createElementNS(m,"img");e.width=64;e.height=64;c.appendChild(e);c.style.width="64px";c.style.height="70px";c.style.position="absolute";c.style.top="-80px";c.style.left="-34px";c.style.display=g?"block":"none";c.className="handle";f.appendChild(c)})()};gui.GuiStepUtils=function(){var f=new odf.OdfUtils,g=new odf.StepUtils,d=new core.DomUtils;this.getContentRect=function(c){c=g.getContentBounds(c);var e,m=null;if(c)if(c.container.nodeType===Node.TEXT_NODE)e=c.container.ownerDocument.createRange(),e.setStart(c.container,c.startOffset),e.setEnd(c.container,c.endOffset),(m=0<e.getClientRects().length?e.getBoundingClientRect():null)&&" "===c.container.data.substring(c.startOffset,c.endOffset)&&1>=m.width&&(m=null),e.detach();else if(f.isCharacterElement(c.container)||
f.isCharacterFrame(c.container))m=d.getBoundingClientRect(c.container);return m}};gui.Caret=function(f,g,d){function c(){n.style.opacity="0"===n.style.opacity?"1":"0";v.trigger()}function e(){l.selectNodeContents(a);return l.getBoundingClientRect()}function m(){Object.keys(I).forEach(function(a){A[a]=I[a]})}function h(){var a,c,h,g;if(!1===I.isShown||f.getSelectionType()!==ops.OdtCursor.RangeSelection||!d&&!f.getSelectedRange().collapsed)I.visibility="hidden",n.style.visibility="hidden",v.cancel();else{I.visibility="visible";n.style.visibility="visible";if(!1===I.isFocused)n.style.opacity=
"1",v.cancel();else{if(z||A.visibility!==I.visibility)n.style.opacity="1",v.cancel();v.trigger()}if(C||u||A.visibility!==I.visibility){a=f.getNode();var l;h=t.getBoundingClientRect(k.getSizer());g=!1;if(0<a.getClientRects().length)l=e(),g=!0;else if(w.setPosition(a,0),l=s.getContentRect(w),!l&&w.nextStep()&&(c=s.getContentRect(w))&&(l=c,g=!0),l||(a.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active","true"),l=e(),g=!0),!l)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+
f.getMemberId());a;){if(0<a.getClientRects().length){l=t.getBoundingClientRect(a);g=!0;break}a=a.parentNode}l=t.translateRect(l,h,k.getZoomLevel());a={top:l.top,height:l.height,right:g?l.left:l.right};8>a.height&&(a={top:a.top-(8-a.height)/2,height:8,right:a.right});q.style.height=a.height+"px";q.style.top=a.top+"px";q.style.left=a.right+"px";b&&(a=runtime.getWindow().getComputedStyle(n,null),a.font?b.style.font=a.font:(b.style.fontStyle=a.fontStyle,b.style.fontVariant=a.fontVariant,b.style.fontWeight=
a.fontWeight,b.style.fontSize=a.fontSize,b.style.lineHeight=a.lineHeight,b.style.fontFamily=a.fontFamily))}if(u){l=f.getDocument().getCanvas().getElement().parentNode;var p;h=l.offsetWidth-l.clientWidth+5;g=l.offsetHeight-l.clientHeight+5;p=n.getBoundingClientRect();a=p.left-h;c=p.top-g;h=p.right+h;g=p.bottom+g;p=l.getBoundingClientRect();c<p.top?l.scrollTop-=p.top-c:g>p.bottom&&(l.scrollTop+=g-p.bottom);a<p.left?l.scrollLeft-=p.left-a:h>p.right&&(l.scrollLeft+=h-p.right)}}A.isFocused!==I.isFocused&&
r.markAsFocussed(I.isFocused);m();C=u=z=!1}function p(b){q.parentNode.removeChild(q);a.parentNode.removeChild(a);b()}var q,n,r,b,a,l,k=f.getDocument().getCanvas(),t=new core.DomUtils,s=new gui.GuiStepUtils,w,x,v,z=!1,u=!1,C=!1,I={isFocused:!1,isShown:!0,visibility:"hidden"},A={isFocused:!I.isFocused,isShown:!I.isShown,visibility:"hidden"};this.handleUpdate=function(){C=!0;"hidden"!==I.visibility&&(I.visibility="hidden",n.style.visibility="hidden",f.getNode().removeAttributeNS("urn:webodf:names:cursor",
"caret-sizer-active"));x.trigger()};this.refreshCursorBlinking=function(){z=!0;x.trigger()};this.setFocus=function(){I.isFocused=!0;x.trigger()};this.removeFocus=function(){I.isFocused=!1;x.trigger()};this.show=function(){I.isShown=!0;x.trigger()};this.hide=function(){I.isShown=!1;x.trigger()};this.setAvatarImageUrl=function(a){r.setImageUrl(a)};this.setColor=function(a){n.style.borderColor=a;r.setColor(a)};this.getCursor=function(){return f};this.getFocusElement=function(){return n};this.toggleHandleVisibility=
function(){r.isVisible()?r.hide():r.show()};this.showHandle=function(){r.show()};this.hideHandle=function(){r.hide()};this.setOverlayElement=function(a){b=a;q.appendChild(a);C=!0;x.trigger()};this.ensureVisible=function(){u=!0;x.trigger()};this.destroy=function(a){core.Async.destroyAll([x.destroy,v.destroy,r.destroy,p],a)};(function(){var b=f.getDocument(),d=[b.createRootFilter(f.getMemberId()),b.getPositionFilter()],e=b.getDOMDocument();l=e.createRange();a=e.createElement("span");a.className="webodf-caretSizer";
a.textContent="|";f.getNode().appendChild(a);q=e.createElement("div");q.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",f.getMemberId());q.className="webodf-caretOverlay";n=e.createElement("div");n.className="caret";q.appendChild(n);r=new gui.Avatar(q,g);k.getSizer().appendChild(q);w=b.createStepIterator(f.getNode(),0,d,b.getRootNode());x=core.Task.createRedrawTask(h);v=core.Task.createTimeoutTask(c,500);x.triggerImmediate()})()};odf.TextSerializer=function(){function f(c){var e="",m=g.filter?g.filter.acceptNode(c):NodeFilter.FILTER_ACCEPT,h=c.nodeType,p;if((m===NodeFilter.FILTER_ACCEPT||m===NodeFilter.FILTER_SKIP)&&d.isTextContentContainingNode(c))for(p=c.firstChild;p;)e+=f(p),p=p.nextSibling;m===NodeFilter.FILTER_ACCEPT&&(h===Node.ELEMENT_NODE&&d.isParagraph(c)?e+="\n":h===Node.TEXT_NODE&&c.textContent&&(e+=c.textContent));return e}var g=this,d=new odf.OdfUtils;this.filter=null;this.writeToString=function(c){if(!c)return"";
c=f(c);"\n"===c[c.length-1]&&(c=c.substr(0,c.length-1));return c}};gui.MimeDataExporter=function(){var f;this.exportRangeToDataTransfer=function(g,d){var c;c=d.startContainer.ownerDocument.createElement("span");c.appendChild(d.cloneContents());c=f.writeToString(c);try{g.setData("text/plain",c)}catch(e){g.setData("Text",c)}};f=new odf.TextSerializer;f.filter=new odf.OdfNodeFilter};gui.Clipboard=function(f){this.setDataFromRange=function(g,d){var c,e=g.clipboardData;c=runtime.getWindow();!e&&c&&(e=c.clipboardData);e?(c=!0,f.exportRangeToDataTransfer(e,d),g.preventDefault()):c=!1;return c}};gui.SessionContext=function(f,g){var d=f.getOdtDocument(),c=new odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var e=d.getCursor(g),f;if(!e)return!1;f=e&&e.getNode();e=d.getMember(g).getProperties().fullName;return(f=c.getParentAnnotation(f,d.getRootNode()))&&c.getAnnotationCreator(f)===e?!0:!1}};gui.StyleSummary=function(f){function g(c,d){var g=c+"|"+d,q;e.hasOwnProperty(g)||(q=[],f.forEach(function(e){e=(e=e[c])&&e[d];-1===q.indexOf(e)&&q.push(e)}),e[g]=q);return e[g]}function d(c,d,e){return function(){var f=g(c,d);return e.length>=f.length&&f.every(function(c){return-1!==e.indexOf(c)})}}function c(c,d){var e=g(c,d);return 1===e.length?e[0]:void 0}var e={};this.getPropertyValues=g;this.getCommonValue=c;this.isBold=d("style:text-properties","fo:font-weight",["bold"]);this.isItalic=d("style:text-properties",
"fo:font-style",["italic"]);this.hasUnderline=d("style:text-properties","style:text-underline-style",["solid"]);this.hasStrikeThrough=d("style:text-properties","style:text-line-through-style",["solid"]);this.fontSize=function(){var d=c("style:text-properties","fo:font-size");return d&&parseFloat(d)};this.fontName=function(){return c("style:text-properties","style:font-name")};this.isAlignedLeft=d("style:paragraph-properties","fo:text-align",["left","start"]);this.isAlignedCenter=d("style:paragraph-properties",
"fo:text-align",["center"]);this.isAlignedRight=d("style:paragraph-properties","fo:text-align",["right","end"]);this.isAlignedJustified=d("style:paragraph-properties","fo:text-align",["justify"]);this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName};this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,isAlignedJustified:this.isAlignedJustified}};gui.DirectFormattingController=function(f,g,d,c,e,m,h){function p(){return P.value().styleSummary}function q(a){var b;a.collapsed?(b=a.startContainer,b.hasChildNodes()&&a.startOffset<b.childNodes.length&&(b=b.childNodes.item(a.startOffset)),a=[b]):a=fa.getTextElements(a,!0,!1);return a}function n(){var a=B.getCursor(c),a=(a=a&&a.getSelectedRange())?q(a):[],a=B.getFormatting().getAppliedStyles(a);a[0]&&S&&(a[0]=X.mergeObjects(a[0],S));return{appliedStyles:a,styleSummary:new gui.StyleSummary(a)}}function r(a,
b){var c={};Object.keys(a).forEach(function(d){var e=a[d](),f=b[d]();e!==f&&(c[d]=f)});return c}function b(){var a,b,c=p();a=r(y.text,c.text);b=r(y.paragraph,c.paragraph);y=c;0<Object.keys(a).length&&ha.emit(gui.DirectFormattingController.textStylingChanged,a);0<Object.keys(b).length&&ha.emit(gui.DirectFormattingController.paragraphStylingChanged,b)}function a(){var a=!0;!0===g.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(a=d.isLocalCursorWithinOwnAnnotation());a!==M&&(M=a,ha.emit(gui.DirectFormattingController.enabledChanged,
M))}function l(b){("string"===typeof b?b:b.getMemberId())===c&&(P.reset(),a())}function k(){P.reset()}function t(a){var b=B.getCursor(c);a=a.paragraphElement;b&&B.getParagraphElement(b.getNode())===a&&P.reset()}function s(a,b){b(!a());return!0}function w(a){if(M){var b=B.getCursorSelection(c),d={"style:text-properties":a};0!==b.length?(a=new ops.OpApplyDirectStyling,a.init({memberid:c,position:b.position,length:b.length,setProperties:d}),f.enqueue([a])):(S=X.mergeObjects(S||{},d),P.reset())}}function x(a,
b){var c={};c[a]=b;w(c)}function v(a){a=a.spec();S&&a.memberid===c&&"SplitParagraph"!==a.optype&&(S=null,P.reset())}function z(a){x("fo:font-weight",a?"bold":"normal")}function u(a){x("fo:font-style",a?"italic":"normal")}function C(a){x("style:text-underline-style",a?"solid":"none")}function I(a){x("style:text-line-through-style",a?"solid":"none")}function A(a){return a===ops.OdtStepsTranslator.NEXT_STEP}function K(a){if(M){var b=B.getCursor(c).getSelectedRange(),b=fa.getParagraphElements(b),d=B.getFormatting(),
k=[],g={},h;b.forEach(function(b){var f=B.convertDomPointToCursorStep(b,0,A),l=b.getAttributeNS(odf.Namespaces.textns,"style-name"),m;b=l?g.hasOwnProperty(l)?g[l]:void 0:h;b||(b=e.generateStyleName(),l?(g[l]=b,m=d.createDerivedStyleObject(l,"paragraph",{})):(h=b,m={}),m=a(m),l=new ops.OpAddStyle,l.init({memberid:c,styleName:b.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:m}),k.push(l));l=new ops.OpSetParagraphStyle;l.init({memberid:c,styleName:b.toString(),position:f});k.push(l)});
f.enqueue(k)}}function J(a){K(function(b){return X.mergeObjects(b,a)})}function H(a){J({"style:paragraph-properties":{"fo:text-align":a}})}function U(a,b){var c=B.getFormatting().getDefaultTabStopDistance(),d=b["style:paragraph-properties"],e;d&&(d=d["fo:margin-left"],e=fa.parseLength(d));return X.mergeObjects(b,{"style:paragraph-properties":{"fo:margin-left":e&&e.unit===c.unit?e.value+a*c.value+e.unit:a*c.value+c.unit}})}function W(a,b){var c=q(a),d=B.getFormatting().getAppliedStyles(c)[0],e=B.getFormatting().getAppliedStylesForElement(b);
if(!d||"text"!==d["style:family"]||!d["style:text-properties"])return!1;if(!e||!e["style:text-properties"])return!0;d=d["style:text-properties"];e=e["style:text-properties"];return!Object.keys(d).every(function(a){return d[a]===e[a]})}function E(){}function aa(){return!1}var O=this,B=f.getOdtDocument(),X=new core.Utils,fa=new odf.OdfUtils,ha=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),
Z=odf.Namespaces.textns,D=core.PositionFilter.FilterResult.FILTER_ACCEPT,S,y,P,M=!1;this.isEnabled=function(){return M};this.formatTextSelection=w;this.createCursorStyleOp=function(a,b,d){var e=null;(d=d?P.value().appliedStyles[0]:S)&&d["style:text-properties"]&&(e=new ops.OpApplyDirectStyling,e.init({memberid:c,position:a,length:b,setProperties:{"style:text-properties":d["style:text-properties"]}}),S=null,P.reset());return e};this.setBold=z;this.setItalic=u;this.setHasUnderline=C;this.setHasStrikethrough=
I;this.setFontSize=function(a){x("fo:font-size",a+"pt")};this.setFontName=function(a){x("style:font-name",a)};this.getAppliedStyles=function(){return P.value().appliedStyles};this.toggleBold=s.bind(O,function(){return p().isBold()},z);this.toggleItalic=s.bind(O,function(){return p().isItalic()},u);this.toggleUnderline=s.bind(O,function(){return p().hasUnderline()},C);this.toggleStrikethrough=s.bind(O,function(){return p().hasStrikeThrough()},I);this.isBold=function(){return p().isBold()};this.isItalic=
function(){return p().isItalic()};this.hasUnderline=function(){return p().hasUnderline()};this.hasStrikeThrough=function(){return p().hasStrikeThrough()};this.fontSize=function(){return p().fontSize()};this.fontName=function(){return p().fontName()};this.isAlignedLeft=function(){return p().isAlignedLeft()};this.isAlignedCenter=function(){return p().isAlignedCenter()};this.isAlignedRight=function(){return p().isAlignedRight()};this.isAlignedJustified=function(){return p().isAlignedJustified()};this.alignParagraphLeft=
function(){H("left");return!0};this.alignParagraphCenter=function(){H("center");return!0};this.alignParagraphRight=function(){H("right");return!0};this.alignParagraphJustified=function(){H("justify");return!0};this.indent=function(){K(U.bind(null,1));return!0};this.outdent=function(){K(U.bind(null,-1));return!0};this.createParagraphStyleOps=function(a){if(!M)return[];var b=B.getCursor(c),d=b.getSelectedRange(),f=[],k,g;b.hasForwardSelection()?(k=b.getAnchorNode(),g=b.getNode()):(k=b.getNode(),g=b.getAnchorNode());
b=B.getParagraphElement(g);runtime.assert(Boolean(b),"DirectFormattingController: Cursor outside paragraph");var h;a:{h=b;var l=gui.SelectionMover.createPositionIterator(h),m=new core.PositionFilterChain;m.addFilter(B.getPositionFilter());m.addFilter(B.createRootFilter(c));for(l.setUnfilteredPosition(d.endContainer,d.endOffset);l.nextPosition();)if(m.acceptPosition(l)===D){h=B.getParagraphElement(l.getCurrentNode())!==h;break a}h=!0}if(!h)return f;g!==k&&(b=B.getParagraphElement(k));if(!S&&!W(d,b))return f;
d=P.value().appliedStyles[0];if(!d)return f;if(k=b.getAttributeNS(Z,"style-name"))d={"style:text-properties":d["style:text-properties"]},d=B.getFormatting().createDerivedStyleObject(k,"paragraph",d);b=e.generateStyleName();k=new ops.OpAddStyle;k.init({memberid:c,styleName:b,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:d});f.push(k);k=new ops.OpSetParagraphStyle;k.init({memberid:c,styleName:b,position:a});f.push(k);return f};this.subscribe=function(a,b){ha.subscribe(a,b)};this.unsubscribe=
function(a,b){ha.unsubscribe(a,b)};this.destroy=function(c){B.unsubscribe(ops.Document.signalCursorAdded,l);B.unsubscribe(ops.Document.signalCursorRemoved,l);B.unsubscribe(ops.Document.signalCursorMoved,l);B.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,k);B.unsubscribe(ops.OdtDocument.signalParagraphChanged,t);B.unsubscribe(ops.OdtDocument.signalOperationEnd,v);B.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,b);g.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a);c()};(function(){B.subscribe(ops.Document.signalCursorAdded,
l);B.subscribe(ops.Document.signalCursorRemoved,l);B.subscribe(ops.Document.signalCursorMoved,l);B.subscribe(ops.OdtDocument.signalParagraphStyleModified,k);B.subscribe(ops.OdtDocument.signalParagraphChanged,t);B.subscribe(ops.OdtDocument.signalOperationEnd,v);B.subscribe(ops.OdtDocument.signalProcessingBatchEnd,b);g.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a);P=new core.LazyProperty(n);y=p();a();m||(O.formatTextSelection=E,O.setBold=E,O.setItalic=E,O.setHasUnderline=E,O.setHasStrikethrough=
E,O.setFontSize=E,O.setFontName=E,O.toggleBold=aa,O.toggleItalic=aa,O.toggleUnderline=aa,O.toggleStrikethrough=aa);h||(O.alignParagraphCenter=E,O.alignParagraphJustified=E,O.alignParagraphLeft=E,O.alignParagraphRight=E,O.createParagraphStyleOps=function(){return[]},O.indent=E,O.outdent=E)})()};gui.DirectFormattingController.enabledChanged="enabled/changed";gui.DirectFormattingController.textStylingChanged="textStyling/changed";gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed";gui.KeyboardHandler=function(){function f(c,d){d||(d=g.None);switch(c){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:d|=g.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:d|=g.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:d|=g.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:d|=g.Shift}return c+":"+d}var g=gui.KeyboardHandler.Modifier,d=null,c={};this.setDefault=function(c){d=c};this.bind=function(d,g,h,p){d=f(d,
g);runtime.assert(p||!1===c.hasOwnProperty(d),"tried to overwrite the callback handler of key combo: "+d);c[d]=h};this.unbind=function(d,g){var h=f(d,g);delete c[h]};this.reset=function(){d=null;c={}};this.handleEvent=function(e){var m=e.keyCode,h=g.None;e.metaKey&&(h|=g.Meta);e.ctrlKey&&(h|=g.Ctrl);e.altKey&&(h|=g.Alt);e.shiftKey&&(h|=g.Shift);m=f(m,h);m=c[m];h=!1;m?h=m():null!==d&&(h=d(e));h&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}};
gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224};gui.HyperlinkClickHandler=function(f,g,d){function c(){var a=f();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.remove("webodf-inactiveLinks")}function e(){var a=f();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.add("webodf-inactiveLinks")}function m(){b.removeEventListener("focus",e,!1);l.forEach(function(a){g.unbind(a.keyCode,a.modifier);d.unbind(a.keyCode,a.modifier)});l.length=0}function h(a){m();
if(a!==p.None){b.addEventListener("focus",e,!1);switch(a){case p.Ctrl:l.push({keyCode:q.Ctrl,modifier:p.None});break;case p.Meta:l.push({keyCode:q.LeftMeta,modifier:p.None}),l.push({keyCode:q.RightMeta,modifier:p.None}),l.push({keyCode:q.MetaInMozilla,modifier:p.None})}l.forEach(function(a){g.bind(a.keyCode,a.modifier,c);d.bind(a.keyCode,a.modifier,e)})}}var p=gui.KeyboardHandler.Modifier,q=gui.KeyboardHandler.KeyCode,n=xmldom.XPath,r=new odf.OdfUtils,b=runtime.getWindow(),a=p.None,l=[];runtime.assert(null!==
b,"Expected to be run in an environment which has a global window, like a browser.");this.handleClick=function(c){var d=c.target||c.srcElement,e,g;c.ctrlKey?e=p.Ctrl:c.metaKey&&(e=p.Meta);if(a===p.None||a===e){a:{for(;null!==d;){if(r.isHyperlink(d))break a;if(r.isParagraph(d))break;d=d.parentNode}d=null}d&&(d=r.getHyperlinkTarget(d),""!==d&&("#"===d[0]?(d=d.substring(1),e=f(),g=n.getODFElementsWithXPath(e,"//text:bookmark-start[@text:name='"+d+"']",odf.Namespaces.lookupNamespaceURI),0===g.length&&
(g=n.getODFElementsWithXPath(e,"//text:bookmark[@text:name='"+d+"']",odf.Namespaces.lookupNamespaceURI)),0<g.length&&g[0].scrollIntoView(!0)):b.open(d),c.preventDefault?c.preventDefault():c.returnValue=!1))}};this.setModifier=function(b){a!==b&&(runtime.assert(b===p.None||b===p.Ctrl||b===p.Meta,"Unsupported KeyboardHandler.Modifier value: "+b),a=b,a!==p.None?e():c(),h(a))};this.getModifier=function(){return a};this.destroy=function(a){e();m();a()}};gui.EventManager=function(f){function g(a){function b(a,c,d){var e,f=!1;e="on"+c;a.attachEvent&&(a.attachEvent(e,d),f=!0);!f&&a.addEventListener&&(a.addEventListener(c,d,!1),f=!0);f&&!z[c]||!a.hasOwnProperty(e)||(a[e]=d)}function c(a,b,d){var e="on"+b;a.detachEvent&&a.detachEvent(e,d);a.removeEventListener&&a.removeEventListener(b,d,!1);a[e]===d&&(a[e]=null)}function d(b){if(-1===f.indexOf(b)){f.push(b);if(e.filters.every(function(a){return a(b)}))try{k.emit(a,b)}catch(c){runtime.log("Error occurred while processing "+
a+":\n"+c.message+"\n"+c.stack)}runtime.setTimeout(function(){f.splice(f.indexOf(b),1)},0)}}var e=this,f=[],k=new core.EventNotifier([a]);this.filters=[];this.subscribe=function(b){k.subscribe(a,b)};this.unsubscribe=function(b){k.unsubscribe(a,b)};this.destroy=function(){c(v,a,d);c(A,a,d);c(K,a,d)};u[a]&&b(v,a,d);b(A,a,d);b(K,a,d)}function d(a,b,c){function d(b){c(b,e,function(b){b.type=a;f.emit(a,b)})}var e={},f=new core.EventNotifier([a]);this.subscribe=function(b){f.subscribe(a,b)};this.unsubscribe=
function(b){f.unsubscribe(a,b)};this.destroy=function(){b.forEach(function(a){J.unsubscribe(a,d)})};(function(){b.forEach(function(a){J.subscribe(a,d)})})()}function c(a){runtime.clearTimeout(a);delete H[a]}function e(a,b){var d=runtime.setTimeout(function(){a();c(d)},b);H[d]=!0;return d}function m(a,b,d){var f=a.touches.length,k=a.touches[0],g=b.timer;"touchmove"===a.type||"touchend"===a.type?g&&c(g):"touchstart"===a.type&&(1!==f?runtime.clearTimeout(g):g=e(function(){d({clientX:k.clientX,clientY:k.clientY,
pageX:k.pageX,pageY:k.pageY,target:a.target||a.srcElement||null,detail:1})},400));b.timer=g}function h(a,b,c){var d=a.touches[0],e=a.target||a.srcElement||null,f=b.target;1!==a.touches.length||"touchend"===a.type?f=null:"touchstart"===a.type&&"webodf-draggable"===e.getAttribute("class")?f=e:"touchmove"===a.type&&f&&(a.preventDefault(),a.stopPropagation(),c({clientX:d.clientX,clientY:d.clientY,pageX:d.pageX,pageY:d.pageY,target:f,detail:1}));b.target=f}function p(a,b,c){var d=a.target||a.srcElement||
null,e=b.dragging;"drag"===a.type?e=!0:"touchend"===a.type&&e&&(e=!1,a=a.changedTouches[0],c({clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY,target:d,detail:1}));b.dragging=e}function q(){K.classList.add("webodf-touchEnabled");J.unsubscribe("touchstart",q)}function n(a){var b=a.scrollX,c=a.scrollY;this.restore=function(){a.scrollX===b&&a.scrollY===c||a.scrollTo(b,c)}}function r(a){var b=a.scrollTop,c=a.scrollLeft;this.restore=function(){if(a.scrollTop!==b||a.scrollLeft!==c)a.scrollTop=
b,a.scrollLeft=c}}function b(a,b){var c=I[a]||C[a]||null;!c&&b&&(c=I[a]=new g(a));return c}function a(a,c){b(a,!0).subscribe(c)}function l(a,c){var d=b(a,!1);d&&d.unsubscribe(c)}function k(){return f.getDOMDocument().activeElement===A}function t(){k()&&A.blur();A.setAttribute("disabled","true")}function s(){A.removeAttribute("disabled")}function w(a){for(var b=[];a;)(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight)&&b.push(new r(a)),a=a.parentNode;b.push(new n(v));return b}function x(){var a;
k()||(a=w(A),s(),A.focus(),a.forEach(function(a){a.restore()}))}var v=runtime.getWindow(),z={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},u={mousedown:!0,mouseup:!0,focus:!0},C={},I={},A,K=f.getCanvas().getElement(),J=this,H={};this.addFilter=function(a,c){b(a,!0).filters.push(c)};this.removeFilter=function(a,c){var d=b(a,!0),e=d.filters.indexOf(c);-1!==e&&d.filters.splice(e,1)};this.subscribe=a;this.unsubscribe=l;this.hasFocus=k;this.focus=x;this.getEventTrap=function(){return A};
this.setEditing=function(a){var b=k();b&&A.blur();a?A.removeAttribute("readOnly"):A.setAttribute("readOnly","true");b&&x()};this.destroy=function(a){l("touchstart",q);Object.keys(H).forEach(function(a){c(parseInt(a,10))});H.length=0;Object.keys(C).forEach(function(a){C[a].destroy()});C={};l("mousedown",t);l("mouseup",s);l("contextmenu",s);Object.keys(I).forEach(function(a){I[a].destroy()});I={};A.parentNode.removeChild(A);a()};(function(){var b=f.getOdfCanvas().getSizer(),c=b.ownerDocument;runtime.assert(Boolean(v),
"EventManager requires a window object to operate correctly");A=c.createElement("input");A.id="eventTrap";A.setAttribute("tabindex","-1");A.setAttribute("readOnly","true");b.appendChild(A);a("mousedown",t);a("mouseup",s);a("contextmenu",s);C.longpress=new d("longpress",["touchstart","touchmove","touchend"],m);C.drag=new d("drag",["touchstart","touchmove","touchend"],h);C.dragstop=new d("dragstop",["drag","touchend"],p);a("touchstart",q)})()};gui.IOSSafariSupport=function(f){function g(){d.innerHeight!==d.outerHeight&&(c.style.display="none",runtime.requestAnimationFrame(function(){c.style.display="block"}))}var d=runtime.getWindow(),c=f.getEventTrap();this.destroy=function(d){f.unsubscribe("focus",g);c.removeAttribute("autocapitalize");c.style.WebkitTransform="";d()};f.subscribe("focus",g);c.setAttribute("autocapitalize","off");c.style.WebkitTransform="translateX(-10000px)"};gui.HyperlinkController=function(f,g,d,c){function e(){var c=!0;!0===g.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(c=d.isLocalCursorWithinOwnAnnotation());c!==n&&(n=c,q.emit(gui.HyperlinkController.enabledChanged,n))}function m(d){d.getMemberId()===c&&e()}var h=new odf.OdfUtils,p=f.getOdtDocument(),q=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),n=!1;this.isEnabled=function(){return n};this.subscribe=function(c,b){q.subscribe(c,b)};this.unsubscribe=function(c,b){q.unsubscribe(c,
b)};this.addHyperlink=function(d,b){if(n){var a=p.getCursorSelection(c),e=new ops.OpApplyHyperlink,k=[];if(0===a.length||b)b=b||d,e=new ops.OpInsertText,e.init({memberid:c,position:a.position,text:b}),a.length=b.length,k.push(e);e=new ops.OpApplyHyperlink;e.init({memberid:c,position:a.position,length:a.length,hyperlink:d});k.push(e);f.enqueue(k)}};this.removeHyperlinks=function(){if(n){var d=gui.SelectionMover.createPositionIterator(p.getRootNode()),b=p.getCursor(c).getSelectedRange(),a=h.getHyperlinkElements(b),
e=b.collapsed&&1===a.length,k=p.getDOMDocument().createRange(),g=[],m,q;0!==a.length&&(a.forEach(function(a){k.selectNodeContents(a);m=p.convertDomToCursorRange({anchorNode:k.startContainer,anchorOffset:k.startOffset,focusNode:k.endContainer,focusOffset:k.endOffset});q=new ops.OpRemoveHyperlink;q.init({memberid:c,position:m.position,length:m.length});g.push(q)}),e||(e=a[0],-1===b.comparePoint(e,0)&&(k.setStart(e,0),k.setEnd(b.startContainer,b.startOffset),m=p.convertDomToCursorRange({anchorNode:k.startContainer,
anchorOffset:k.startOffset,focusNode:k.endContainer,focusOffset:k.endOffset}),0<m.length&&(q=new ops.OpApplyHyperlink,q.init({memberid:c,position:m.position,length:m.length,hyperlink:h.getHyperlinkTarget(e)}),g.push(q))),a=a[a.length-1],d.moveToEndOfNode(a),d=d.unfilteredDomOffset(),1===b.comparePoint(a,d)&&(k.setStart(b.endContainer,b.endOffset),k.setEnd(a,d),m=p.convertDomToCursorRange({anchorNode:k.startContainer,anchorOffset:k.startOffset,focusNode:k.endContainer,focusOffset:k.endOffset}),0<m.length&&
(q=new ops.OpApplyHyperlink,q.init({memberid:c,position:m.position,length:m.length,hyperlink:h.getHyperlinkTarget(a)}),g.push(q)))),f.enqueue(g),k.detach())}};this.destroy=function(c){p.unsubscribe(ops.Document.signalCursorMoved,m);g.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);c()};p.subscribe(ops.Document.signalCursorMoved,m);g.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);e()};gui.HyperlinkController.enabledChanged="enabled/changed";gui.ImageController=function(f,g,d,c,e){function m(){var c=!0;!0===g.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(c=d.isLocalCursorWithinOwnAnnotation());c!==a&&(a=c,b.emit(gui.ImageController.enabledChanged,a))}function h(a){a.getMemberId()===c&&m()}var p={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},q=odf.Namespaces.textns,n=f.getOdtDocument(),r=n.getFormatting(),b=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),a=!1;this.isEnabled=function(){return a};this.subscribe=
function(a,c){b.subscribe(a,c)};this.unsubscribe=function(a,c){b.unsubscribe(a,c)};this.insertImage=function(b,d,g,h){if(a){runtime.assert(0<g&&0<h,"Both width and height of the image should be greater than 0px.");h={width:g,height:h};if(g=n.getParagraphElement(n.getCursor(c).getNode()).getAttributeNS(q,"style-name")){g=r.getContentSize(g,"paragraph");var m=1,x=1;h.width>g.width&&(m=g.width/h.width);h.height>g.height&&(x=g.height/h.height);g=Math.min(m,x);h={width:h.width*g,height:h.height*g}}g=h.width+
"px";h=h.height+"px";var v=n.getOdfCanvas().odfContainer().rootElement.styles,m=b.toLowerCase(),x=p.hasOwnProperty(m)?p[m]:null,z,m=[];runtime.assert(null!==x,"Image type is not supported: "+b);x="Pictures/"+e.generateImageName()+x;z=new ops.OpSetBlob;z.init({memberid:c,filename:x,mimetype:b,content:d});m.push(z);r.getStyleElement("Graphics","graphic",[v])||(b=new ops.OpAddStyle,b.init({memberid:c,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph",
"svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),m.push(b));b=e.generateStyleName();d=new ops.OpAddStyle;d.init({memberid:c,styleName:b,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline",
"style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}});m.push(d);z=new ops.OpInsertImage;z.init({memberid:c,position:n.getCursorPosition(c),
filename:x,frameWidth:g,frameHeight:h,frameStyleName:b,frameName:e.generateFrameName()});m.push(z);f.enqueue(m)}};this.destroy=function(a){n.unsubscribe(ops.Document.signalCursorMoved,h);g.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,m);a()};n.subscribe(ops.Document.signalCursorMoved,h);g.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,m);m()};gui.ImageController.enabledChanged="enabled/changed";gui.ImageSelector=function(f){function g(){var d=f.getSizer(),g=e.createElement("div");g.id="imageSelector";g.style.borderWidth="1px";d.appendChild(g);c.forEach(function(c){var d=e.createElement("div");d.className=c;g.appendChild(d)});return g}var d=odf.Namespaces.svgns,c="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),e=f.getElement().ownerDocument,m=!1;this.select=function(c){var p,q,n=e.getElementById("imageSelector");n||(n=g());m=!0;p=n.parentNode;
q=c.getBoundingClientRect();var r=p.getBoundingClientRect(),b=f.getZoomLevel();p=(q.left-r.left)/b-1;q=(q.top-r.top)/b-1;n.style.display="block";n.style.left=p+"px";n.style.top=q+"px";n.style.width=c.getAttributeNS(d,"width");n.style.height=c.getAttributeNS(d,"height")};this.clearSelection=function(){var c;m&&(c=e.getElementById("imageSelector"))&&(c.style.display="none");m=!1};this.isSelectorElement=function(c){var d=e.getElementById("imageSelector");return d?c===d||c.parentNode===d:!1}};(function(){function f(f){function d(c){h=c.which&&String.fromCharCode(c.which)===m;m=void 0;return!1===h}function c(){h=!1}function e(c){m=c.data;h=!1}var m,h=!1;this.destroy=function(h){f.unsubscribe("textInput",c);f.unsubscribe("compositionend",e);f.removeFilter("keypress",d);h()};f.subscribe("textInput",c);f.subscribe("compositionend",e);f.addFilter("keypress",d)}gui.InputMethodEditor=function(g,d){function c(c){a&&(c?a.getNode().setAttributeNS(b,"composing","true"):(a.getNode().removeAttributeNS(b,
"composing"),t.textContent=""))}function e(){x&&(x=!1,c(!1),z.emit(gui.InputMethodEditor.signalCompositionEnd,{data:v}),v="")}function m(){e();a&&a.getSelectedRange().collapsed?l.value="":l.value=s;l.setSelectionRange(0,l.value.length)}function h(){d.hasFocus()&&w.trigger()}function p(){u=void 0;w.cancel();c(!0);x||z.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function q(a){a=u=a.data;x=!0;v+=a;w.trigger()}function n(a){a.data!==u&&(a=a.data,x=!0,v+=a,w.trigger());u=void 0}function r(){t.textContent=
l.value}var b="urn:webodf:names:cursor",a=null,l=d.getEventTrap(),k=l.ownerDocument,t,s="b",w,x=!1,v="",z=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),u,C=[],I;this.subscribe=z.subscribe;this.unsubscribe=z.unsubscribe;this.registerCursor=function(b){b.getMemberId()===g&&(a=b,a.getNode().appendChild(t),b.subscribe(ops.OdtCursor.signalCursorUpdated,h),d.subscribe("input",r),d.subscribe("compositionupdate",r))};this.removeCursor=function(b){a&&
b===g&&(a.getNode().removeChild(t),a.unsubscribe(ops.OdtCursor.signalCursorUpdated,h),d.unsubscribe("input",r),d.unsubscribe("compositionupdate",r),a=null)};this.destroy=function(a){d.unsubscribe("compositionstart",p);d.unsubscribe("compositionend",q);d.unsubscribe("textInput",n);d.unsubscribe("keypress",e);d.unsubscribe("focus",m);core.Async.destroyAll(I,a)};(function(){d.subscribe("compositionstart",p);d.subscribe("compositionend",q);d.subscribe("textInput",n);d.subscribe("keypress",e);d.subscribe("focus",
m);C.push(new f(d));I=C.map(function(a){return a.destroy});t=k.createElement("span");t.setAttribute("id","composer");w=core.Task.createTimeoutTask(m,1);I.push(w.destroy)})()};gui.InputMethodEditor.signalCompositionStart="input/compositionstart";gui.InputMethodEditor.signalCompositionEnd="input/compositionend"})();gui.MetadataController=function(f,g){function d(c){m.emit(gui.MetadataController.signalMetadataChanged,c)}function c(c){var d=-1===h.indexOf(c);d||runtime.log("Setting "+c+" is restricted.");return d}var e=f.getOdtDocument(),m=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),h=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(d,e){var h={},m="",b;d&&Object.keys(d).filter(c).forEach(function(a){h[a]=d[a]});
e&&(m=e.filter(c).join(","));if(0<m.length||0<Object.keys(h).length)b=new ops.OpUpdateMetadata,b.init({memberid:g,setProperties:h,removedProperties:0<m.length?{attributes:m}:null}),f.enqueue([b])};this.getMetadata=function(c){var d;runtime.assert("string"===typeof c,"Property must be a string");d=c.split(":");runtime.assert(2===d.length,"Property must be a namespace-prefixed string");c=odf.Namespaces.lookupNamespaceURI(d[0]);runtime.assert(Boolean(c),"Prefix must be for an ODF namespace.");return e.getOdfCanvas().odfContainer().getMetadata(c,
d[1])};this.subscribe=function(c,d){m.subscribe(c,d)};this.unsubscribe=function(c,d){m.unsubscribe(c,d)};this.destroy=function(c){e.unsubscribe(ops.OdtDocument.signalMetadataUpdated,d);c()};e.subscribe(ops.OdtDocument.signalMetadataUpdated,d)};gui.MetadataController.signalMetadataChanged="metadata/changed";gui.PasteController=function(f,g,d,c){function e(){q=!0===g.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?d.isLocalCursorWithinOwnAnnotation():!0}function m(d){d.getMemberId()===c&&e()}function h(c){return c===ops.OdtStepsTranslator.NEXT_STEP}var p=f.getOdtDocument(),q=!1,n=odf.Namespaces.textns;this.isEnabled=function(){return q};this.paste=function(d){if(q){var b=p.getCursorPosition(c),a=p.getCursor(c).getNode(),a=p.getParagraphElement(a),e=a.getAttributeNS(n,"style-name")||"",k=b,g=[],m=p.convertDomPointToCursorStep(a,
0,h);d.replace(/\r/g,"").split("\n").forEach(function(a){var b=new ops.OpInsertText,d=new ops.OpSplitParagraph;b.init({memberid:c,position:k,text:a,moveCursor:!0});g.push(b);k+=a.length;d.init({memberid:c,position:k,paragraphStyleName:e,sourceParagraphPosition:m,moveCursor:!0});g.push(d);m=k+=1});g.pop();f.enqueue(g)}};this.destroy=function(c){p.unsubscribe(ops.Document.signalCursorMoved,m);g.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);c()};p.subscribe(ops.Document.signalCursorMoved,m);
g.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);e()};odf.WordBoundaryFilter=function(f,g){function d(a,b,c){for(var d=null,e=f.getRootNode(),g;a!==e&&null!==a&&null===d;)g=0>b?a.previousSibling:a.nextSibling,c(g)===NodeFilter.FILTER_ACCEPT&&(d=g),a=a.parentNode;return d}function c(a,b){var c;return null===a?l.NO_NEIGHBOUR:h.isCharacterElement(a)?l.SPACE_CHAR:a.nodeType===e||h.isTextSpan(a)||h.isHyperlink(a)?(c=a.textContent.charAt(b()),q.test(c)?l.SPACE_CHAR:p.test(c)?l.PUNCTUATION_CHAR:l.WORD_CHAR):l.OTHER}var e=Node.TEXT_NODE,m=Node.ELEMENT_NODE,
h=new odf.OdfUtils,p=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,
q=/\s/,n=core.PositionFilter.FilterResult.FILTER_ACCEPT,r=core.PositionFilter.FilterResult.FILTER_REJECT,b=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,a=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,l={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(e){var f=e.container(),h=e.leftNode(),p=e.rightNode(),q=e.unfilteredDomOffset,v=function(){return e.unfilteredDomOffset()-1};f.nodeType===m&&(null===p&&(p=d(f,1,e.getNodeFilter())),null===h&&(h=
d(f,-1,e.getNodeFilter())));f!==p&&(q=function(){return 0});f!==h&&null!==h&&(v=function(){return h.textContent.length-1});f=c(h,v);p=c(p,q);return f===l.WORD_CHAR&&p===l.WORD_CHAR||f===l.PUNCTUATION_CHAR&&p===l.PUNCTUATION_CHAR||g===b&&f!==l.NO_NEIGHBOUR&&p===l.SPACE_CHAR||g===a&&f===l.SPACE_CHAR&&p!==l.NO_NEIGHBOUR?r:n}};odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2};gui.SelectionController=function(f,g){function d(a,b,c){c=new odf.WordBoundaryFilter(s,c);var d=s.getRootElement(a),e=s.createRootFilter(d);return s.createStepIterator(a,b,[v,e,c],d)}function c(a,b){return b?{anchorNode:a.startContainer,anchorOffset:a.startOffset,focusNode:a.endContainer,focusOffset:a.endOffset}:{anchorNode:a.endContainer,anchorOffset:a.endOffset,focusNode:a.startContainer,focusOffset:a.startOffset}}function e(a,b,c){var d=new ops.OpMoveCursor;d.init({memberid:g,position:a,length:b||
0,selectionType:c});return d}function m(a,b,d){var k;k=s.getCursor(g);k=c(k.getSelectedRange(),k.hasForwardSelection());k.focusNode=a;k.focusOffset=b;d||(k.anchorNode=k.focusNode,k.anchorOffset=k.focusOffset);a=s.convertDomToCursorRange(k);f.enqueue([e(a.position,a.length)])}function h(a){var b;b=d(a.startContainer,a.startOffset,C);b.roundToPreviousStep()&&a.setStart(b.container(),b.offset());b=d(a.endContainer,a.endOffset,I);b.roundToNextStep()&&a.setEnd(b.container(),b.offset())}function p(a){var b=
x.getParagraphElements(a),c=b[0],b=b[b.length-1];c&&a.setStart(c,0);b&&(x.isParagraph(a.endContainer)&&0===a.endOffset?a.setEndBefore(b):a.setEnd(b,b.childNodes.length))}function q(a,b,c,d){var e,f;d?(e=c.startContainer,f=c.startOffset):(e=c.endContainer,f=c.endOffset);w.containsNode(a,e)||(f=0>w.comparePoints(a,0,e,f)?0:a.childNodes.length,e=a);a=s.createStepIterator(e,f,b,x.getParagraphElement(e)||a);a.roundToClosestStep()||runtime.assert(!1,"No step found in requested range");d?c.setStart(a.container(),
a.offset()):c.setEnd(a.container(),a.offset())}function n(a){var b=s.getCursorSelection(g),c=s.getCursor(g).getStepCounter();0!==a&&(a=0<a?c.convertForwardStepsBetweenFilters(a,z,v):-c.convertBackwardStepsBetweenFilters(-a,z,v),a=b.length+a,f.enqueue([e(b.position,a)]))}function r(a){var b=s.getCursorPosition(g),c=s.getCursor(g).getStepCounter();0!==a&&(a=0<a?c.convertForwardStepsBetweenFilters(a,z,v):-c.convertBackwardStepsBetweenFilters(-a,z,v),f.enqueue([e(b+a,0)]))}function b(a,b){var c;c=s.getCursor(g).getNode();
c=s.createStepIterator(c,0,[v,u],s.getRootElement(c));c.advanceStep(a)&&m(c.container(),c.offset(),b)}function a(a,b){var c=s.getParagraphElement(s.getCursor(g).getNode()),d=a===K?1:-1;runtime.assert(Boolean(c),"SelectionController: Cursor outside paragraph");c=s.getCursor(g).getStepCounter().countLinesSteps(d,z);b?n(c):r(c)}function l(a,b){var c=a===core.StepDirection.NEXT?1:-1,c=s.getCursor(g).getStepCounter().countStepsToLineBoundary(c,z);b?n(c):r(c)}function k(a,b){var e=s.getCursor(g),e=c(e.getSelectedRange(),
e.hasForwardSelection()),e=d(e.focusNode,e.focusOffset,C);e.advanceStep(a)&&m(e.container(),e.offset(),b)}function t(a,b,d){var e=!1,f=s.getCursor(g),f=c(f.getSelectedRange(),f.hasForwardSelection()),e=s.getRootElement(f.focusNode);runtime.assert(Boolean(e),"SelectionController: Cursor outside root");f=s.createStepIterator(f.focusNode,f.focusOffset,[v,u],e);f.roundToClosestStep();f.advanceStep(a)&&(d=d(f.container()))&&(a===A?(f.setPosition(d,0),e=f.roundToNextStep()):(f.setPosition(d,d.childNodes.length),
e=f.roundToPreviousStep()),e&&m(f.container(),f.offset(),b))}var s=f.getOdtDocument(),w=new core.DomUtils,x=new odf.OdfUtils,v=s.getPositionFilter(),z=new core.PositionFilterChain,u=s.createRootFilter(g),C=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,I=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,A=core.StepDirection.PREVIOUS,K=core.StepDirection.NEXT;this.selectionToRange=function(a){var b=0<=w.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset),c=a.focusNode.ownerDocument.createRange();
b?(c.setStart(a.anchorNode,a.anchorOffset),c.setEnd(a.focusNode,a.focusOffset)):(c.setStart(a.focusNode,a.focusOffset),c.setEnd(a.anchorNode,a.anchorOffset));return{range:c,hasForwardSelection:b}};this.rangeToSelection=c;this.selectImage=function(a){var b=s.getRootElement(a),c=s.createRootFilter(b),b=s.createStepIterator(a,0,[c,s.getPositionFilter()],b),d;b.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame");c=b.container();d=b.offset();b.setPosition(a,a.childNodes.length);
b.roundToNextStep()||runtime.assert(!1,"No walkable position after frame");a=s.convertDomToCursorRange({anchorNode:c,anchorOffset:d,focusNode:b.container(),focusOffset:b.offset()});a=e(a.position,a.length,ops.OdtCursor.RegionSelection);f.enqueue([a])};this.expandToWordBoundaries=h;this.expandToParagraphBoundaries=p;this.selectRange=function(a,b,d){var k=s.getOdfCanvas().getElement(),l,m=[v];l=w.containsNode(k,a.startContainer);k=w.containsNode(k,a.endContainer);if(l||k)if(l&&k&&(2===d?h(a):3<=d&&
p(a)),(d=b?s.getRootElement(a.startContainer):s.getRootElement(a.endContainer))||(d=s.getRootNode()),m.push(s.createRootFilter(d)),q(d,m,a,!0),q(d,m,a,!1),a=c(a,b),b=s.convertDomToCursorRange(a),a=s.getCursorSelection(g),b.position!==a.position||b.length!==a.length)a=e(b.position,b.length,ops.OdtCursor.RangeSelection),f.enqueue([a])};this.moveCursorToLeft=function(){b(A,!1);return!0};this.moveCursorToRight=function(){b(K,!1);return!0};this.extendSelectionToLeft=function(){b(A,!0);return!0};this.extendSelectionToRight=
function(){b(K,!0);return!0};this.moveCursorUp=function(){a(A,!1);return!0};this.moveCursorDown=function(){a(K,!1);return!0};this.extendSelectionUp=function(){a(A,!0);return!0};this.extendSelectionDown=function(){a(K,!0);return!0};this.moveCursorBeforeWord=function(){k(A,!1);return!0};this.moveCursorPastWord=function(){k(K,!1);return!0};this.extendSelectionBeforeWord=function(){k(A,!0);return!0};this.extendSelectionPastWord=function(){k(K,!0);return!0};this.moveCursorToLineStart=function(){l(A,!1);
return!0};this.moveCursorToLineEnd=function(){l(K,!1);return!0};this.extendSelectionToLineStart=function(){l(A,!0);return!0};this.extendSelectionToLineEnd=function(){l(K,!0);return!0};this.extendSelectionToParagraphStart=function(){t(A,!0,s.getParagraphElement);return!0};this.extendSelectionToParagraphEnd=function(){t(K,!0,s.getParagraphElement);return!0};this.moveCursorToParagraphStart=function(){t(A,!1,s.getParagraphElement);return!0};this.moveCursorToParagraphEnd=function(){t(K,!1,s.getParagraphElement);
return!0};this.moveCursorToDocumentStart=function(){t(A,!1,s.getRootElement);return!0};this.moveCursorToDocumentEnd=function(){t(K,!1,s.getRootElement);return!0};this.extendSelectionToDocumentStart=function(){t(A,!0,s.getRootElement);return!0};this.extendSelectionToDocumentEnd=function(){t(K,!0,s.getRootElement);return!0};this.extendSelectionToEntireDocument=function(){var a=s.getCursor(g),a=s.getRootElement(a.getNode()),b,c,d;runtime.assert(Boolean(a),"SelectionController: Cursor outside root");
d=s.createStepIterator(a,0,[v,u],a);d.roundToClosestStep();b=d.container();c=d.offset();d.setPosition(a,a.childNodes.length);d.roundToClosestStep();a=s.convertDomToCursorRange({anchorNode:b,anchorOffset:c,focusNode:d.container(),focusOffset:d.offset()});f.enqueue([e(a.position,a.length)]);return!0};z.addFilter(v);z.addFilter(s.createRootFilter(g))};gui.TextController=function(f,g,d,c,e,m){function h(){s=!0===g.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?d.isLocalCursorWithinOwnAnnotation():!0}function p(a){a.getMemberId()===c&&h()}function q(a){return a===ops.OdtStepsTranslator.NEXT_STEP}function n(a,b,c){var d=[l.getPositionFilter()];c&&d.push(l.createRootFilter(a.startContainer));c=l.createStepIterator(a.startContainer,a.startOffset,d,b);c.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start");
b=l.convertDomPointToCursorStep(c.container(),c.offset());a.collapsed?a=b:(c.setPosition(a.endContainer,a.endOffset),c.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),a=l.convertDomPointToCursorStep(c.container(),c.offset()));return{position:b,length:a-b}}function r(a){var b,d,e,f=k.getParagraphElements(a),g=a.cloneRange(),h=[];b=f[0];1<f.length&&(k.hasNoODFContent(b)&&(b=f[f.length-1]),d=b.getAttributeNS(odf.Namespaces.textns,"style-name")||"");
f.forEach(function(b,f){var k,l;g.setStart(b,0);g.collapse(!0);k=n(g,b,!1).position;0<f&&(l=new ops.OpMergeParagraph,l.init({memberid:c,paragraphStyleName:d,destinationStartPosition:e,sourceStartPosition:k,moveCursor:1===f}),h.unshift(l));e=k;g.selectNodeContents(b);if(k=t.rangeIntersection(g,a))k=n(k,b,!0),0<k.length&&(l=new ops.OpRemoveText,l.init({memberid:c,position:k.position,length:k.length}),h.unshift(l))});return h}function b(a){0>a.length&&(a.position+=a.length,a.length=-a.length);return a}
function a(a){if(!s)return!1;var d,e=l.getCursor(c).getSelectedRange().cloneRange(),g=b(l.getCursorSelection(c)),k;if(0===g.length){g=void 0;d=l.getCursor(c).getNode();k=l.getRootElement(d);var h=[l.getPositionFilter(),l.createRootFilter(k)];k=l.createStepIterator(d,0,h,k);k.roundToClosestStep()&&(a?k.nextStep():k.previousStep())&&(g=b(l.convertDomToCursorRange({anchorNode:d,anchorOffset:0,focusNode:k.container(),focusOffset:k.offset()})),a?(e.setStart(d,0),e.setEnd(k.container(),k.offset())):(e.setStart(k.container(),
k.offset()),e.setEnd(d,0)))}g&&f.enqueue(r(e));return void 0!==g}var l=f.getOdtDocument(),k=new odf.OdfUtils,t=new core.DomUtils,s=!1,w=odf.Namespaces.textns;this.isEnabled=function(){return s};this.enqueueParagraphSplittingOps=function(){if(!s)return!1;var a=l.getCursor(c),d=a.getSelectedRange(),e=b(l.getCursorSelection(c)),k=[],a=l.getParagraphElement(a.getNode()),g=a.getAttributeNS(w,"style-name")||"";0<e.length&&(k=k.concat(r(d)));d=new ops.OpSplitParagraph;d.init({memberid:c,position:e.position,
paragraphStyleName:g,sourceParagraphPosition:l.convertDomPointToCursorStep(a,0,q),moveCursor:!0});k.push(d);m&&(e=m(e.position+1),k=k.concat(e));f.enqueue(k);return!0};this.removeTextByBackspaceKey=function(){return a(!1)};this.removeTextByDeleteKey=function(){return a(!0)};this.removeCurrentSelection=function(){if(!s)return!1;var a=l.getCursor(c).getSelectedRange();f.enqueue(r(a));return!0};this.insertText=function(a){if(s){var d=l.getCursor(c).getSelectedRange(),k=b(l.getCursorSelection(c)),g=[],
h=!1;0<k.length&&(g=g.concat(r(d)),h=!0);d=new ops.OpInsertText;d.init({memberid:c,position:k.position,text:a,moveCursor:!0});g.push(d);e&&(a=e(k.position,a.length,h))&&g.push(a);f.enqueue(g)}};this.destroy=function(a){l.unsubscribe(ops.Document.signalCursorMoved,p);g.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,h);a()};l.subscribe(ops.Document.signalCursorMoved,p);g.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,h);h()};gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(f,g){};gui.UndoManager.prototype.unsubscribe=function(f,g){};gui.UndoManager.prototype.setDocument=function(f){};gui.UndoManager.prototype.setInitialState=function(){};gui.UndoManager.prototype.initialize=function(){};gui.UndoManager.prototype.purgeInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(f){};gui.UndoManager.prototype.hasUndoStates=function(){};
gui.UndoManager.prototype.hasRedoStates=function(){};gui.UndoManager.prototype.moveForward=function(f){};gui.UndoManager.prototype.moveBackward=function(f){};gui.UndoManager.prototype.onOperationExecuted=function(f){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1};
(function(){var f=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(g,d,c,e){function m(a){return a.target||a.srcElement||null}function h(a,b){var c=B.getDOMDocument(),d=null;c.caretRangeFromPoint?(c=c.caretRangeFromPoint(a,b),d={container:c.startContainer,offset:c.startOffset}):c.caretPositionFromPoint&&(c=c.caretPositionFromPoint(a,b))&&c.offsetNode&&(d={container:c.offsetNode,offset:c.offset});return d}function p(a){var b=B.getCursor(d).getSelectedRange();b.collapsed?
a.preventDefault():S.setDataFromRange(a,b)?da.removeCurrentSelection():runtime.log("Cut operation failed")}function q(){return!1!==B.getCursor(d).getSelectedRange().collapsed}function n(a){var b=B.getCursor(d).getSelectedRange();b.collapsed?a.preventDefault():S.setDataFromRange(a,b)||runtime.log("Copy operation failed")}function r(a){var b;O.clipboardData&&O.clipboardData.getData?b=O.clipboardData.getData("Text"):a.clipboardData&&a.clipboardData.getData&&(b=a.clipboardData.getData("text/plain"));
b&&(da.removeCurrentSelection(),pa.paste(b));a.preventDefault?a.preventDefault():a.returnValue=!1}function b(){return!1}function a(a){if(V)V.onOperationExecuted(a)}function l(a){B.emit(ops.OdtDocument.signalUndoStackChanged,a)}function k(){var a;return V?(a=L.hasFocus(),V.moveBackward(1),a&&L.focus(),!0):!1}function t(){var a;return V?(a=L.hasFocus(),V.moveForward(1),a&&L.focus(),!0):!1}function s(a){var b=B.getCursor(d).getSelectedRange(),e=m(a).getAttribute("end");b&&e&&(a=h(a.clientX,a.clientY))&&
(ga.setUnfilteredPosition(a.container,a.offset),T.acceptPosition(ga)===f&&(b=b.cloneRange(),"left"===e?b.setStart(ga.container(),ga.unfilteredDomOffset()):b.setEnd(ga.container(),ga.unfilteredDomOffset()),c.setSelectedRange(b,"right"===e),B.emit(ops.Document.signalCursorMoved,c)))}function w(){R.selectRange(c.getSelectedRange(),c.hasForwardSelection(),1)}function x(){var a=O.getSelection(),b=0<a.rangeCount&&R.selectionToRange(a);Y&&b&&(ca=!0,ka.clearSelection(),ga.setUnfilteredPosition(a.focusNode,
a.focusOffset),T.acceptPosition(ga)===f&&(2===na?R.expandToWordBoundaries(b.range):3<=na&&R.expandToParagraphBoundaries(b.range),c.setSelectedRange(b.range,b.hasForwardSelection),B.emit(ops.Document.signalCursorMoved,c)))}function v(a){var b=m(a),c=B.getCursor(d);if(Y=null!==b&&ha.containsNode(B.getOdfCanvas().getElement(),b))ca=!1,T=B.createRootFilter(b),na=0===a.button?a.detail:0,c&&a.shiftKey?O.getSelection().collapse(c.getAnchorNode(),0):(a=O.getSelection(),b=c.getSelectedRange(),a.extend?c.hasForwardSelection()?
(a.collapse(b.startContainer,b.startOffset),a.extend(b.endContainer,b.endOffset)):(a.collapse(b.endContainer,b.endOffset),a.extend(b.startContainer,b.startOffset)):(a.removeAllRanges(),a.addRange(b.cloneRange()))),1<na&&x()}function z(a){var b=B.getRootElement(a),c=B.createRootFilter(b),b=B.createStepIterator(a,0,[c,B.getPositionFilter()],b);b.setPosition(a,a.childNodes.length);return b.roundToNextStep()?{container:b.container(),offset:b.offset()}:null}function u(a){var b;b=(b=O.getSelection())?{anchorNode:b.anchorNode,
anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}:null;var c=O.getSelection().isCollapsed,d,e;b.anchorNode||b.focusNode||!(d=h(a.clientX,a.clientY))||(b.anchorNode=d.container,b.anchorOffset=d.offset,b.focusNode=b.anchorNode,b.focusOffset=b.anchorOffset);if(Z.isImage(b.focusNode)&&0===b.focusOffset&&Z.isCharacterFrame(b.focusNode.parentNode)){if(e=b.focusNode.parentNode,d=e.getBoundingClientRect(),a.clientX>d.left&&(d=z(e)))b.focusNode=d.container,b.focusOffset=d.offset,
c&&(b.anchorNode=b.focusNode,b.anchorOffset=b.focusOffset)}else Z.isImage(b.focusNode.firstChild)&&1===b.focusOffset&&Z.isCharacterFrame(b.focusNode)&&(d=z(b.focusNode))&&(b.anchorNode=b.focusNode=d.container,b.anchorOffset=b.focusOffset=d.offset);b.anchorNode&&b.focusNode&&(b=R.selectionToRange(b),R.selectRange(b.range,b.hasForwardSelection,0===a.button?a.detail:0));L.focus()}function C(a){var b;if(b=h(a.clientX,a.clientY))a=b.container,b=b.offset,a={anchorNode:a,anchorOffset:b,focusNode:a,focusOffset:b},
a=R.selectionToRange(a),R.selectRange(a.range,a.hasForwardSelection,2),L.focus()}function I(a){var b=m(a),d,e;la.processRequests();Y&&(Z.isImage(b)&&Z.isCharacterFrame(b.parentNode)&&O.getSelection().isCollapsed?(R.selectImage(b.parentNode),L.focus()):ka.isSelectorElement(b)?L.focus():ca?(b=c.getSelectedRange(),d=b.collapsed,Z.isImage(b.endContainer)&&0===b.endOffset&&Z.isCharacterFrame(b.endContainer.parentNode)&&(e=b.endContainer.parentNode,e=z(e))&&(b.setEnd(e.container,e.offset),d&&b.collapse(!1)),
R.selectRange(b,c.hasForwardSelection(),0===a.button?a.detail:0),L.focus()):ua?u(a):Q=runtime.setTimeout(function(){u(a)},0),na=0,ca=Y=!1)}function A(a){var b=B.getCursor(d).getSelectedRange();b.collapsed||D.exportRangeToDataTransfer(a.dataTransfer,b)}function K(){Y&&L.focus();na=0;ca=Y=!1}function J(a){I(a)}function H(a){var b=m(a),c=null;"annotationRemoveButton"===b.className?(runtime.assert(ia,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),
c=ha.getElementsByTagNameNS(b.parentNode,odf.Namespaces.officens,"annotation")[0],$.removeAnnotation(c),L.focus()):"webodf-draggable"!==b.getAttribute("class")&&I(a)}function U(a){(a=a.data)&&(-1===a.indexOf("\n")?da.insertText(a):pa.paste(a))}function W(a){return function(){a();return!0}}function E(a){return function(b){return B.getCursor(d).getSelectionType()===ops.OdtCursor.RangeSelection?a(b):!0}}function aa(b){L.unsubscribe("keydown",y.handleEvent);L.unsubscribe("keypress",P.handleEvent);L.unsubscribe("keyup",
M.handleEvent);L.unsubscribe("copy",n);L.unsubscribe("mousedown",v);L.unsubscribe("mousemove",la.trigger);L.unsubscribe("mouseup",H);L.unsubscribe("contextmenu",J);L.unsubscribe("dragstart",A);L.unsubscribe("dragend",K);L.unsubscribe("click",ma.handleClick);L.unsubscribe("longpress",C);L.unsubscribe("drag",s);L.unsubscribe("dragstop",w);B.unsubscribe(ops.OdtDocument.signalOperationEnd,oa.trigger);B.unsubscribe(ops.Document.signalCursorAdded,ja.registerCursor);B.unsubscribe(ops.Document.signalCursorRemoved,
ja.removeCursor);B.unsubscribe(ops.OdtDocument.signalOperationEnd,a);b()}var O=runtime.getWindow(),B=g.getOdtDocument(),X=new gui.SessionConstraints,fa=new gui.SessionContext(g,d),ha=new core.DomUtils,Z=new odf.OdfUtils,D=new gui.MimeDataExporter,S=new gui.Clipboard(D),y=new gui.KeyboardHandler,P=new gui.KeyboardHandler,M=new gui.KeyboardHandler,Y=!1,N=new odf.ObjectNameGenerator(B.getOdfCanvas().odfContainer(),d),ca=!1,T=null,Q,V=null,L=new gui.EventManager(B),ia=e.annotationsEnabled,$=new gui.AnnotationController(g,
X,d),ba=new gui.DirectFormattingController(g,X,fa,d,N,e.directTextStylingEnabled,e.directParagraphStylingEnabled),da=new gui.TextController(g,X,fa,d,ba.createCursorStyleOp,ba.createParagraphStyleOps),qa=new gui.ImageController(g,X,fa,d,N),ka=new gui.ImageSelector(B.getOdfCanvas()),ga=gui.SelectionMover.createPositionIterator(B.getRootNode()),la,oa,pa=new gui.PasteController(g,X,fa,d),ja=new gui.InputMethodEditor(d,L),na=0,ma=new gui.HyperlinkClickHandler(B.getOdfCanvas().getElement,y,M),ea=new gui.HyperlinkController(g,
X,fa,d),R=new gui.SelectionController(g,d),ta=new gui.MetadataController(g,d),F=gui.KeyboardHandler.Modifier,G=gui.KeyboardHandler.KeyCode,ra=-1!==O.navigator.appVersion.toLowerCase().indexOf("mac"),ua=-1!==["iPad","iPod","iPhone"].indexOf(O.navigator.platform),sa;runtime.assert(null!==O,"Expected to be run in an environment which has a global window, like a browser.");this.undo=k;this.redo=t;this.insertLocalCursor=function(){runtime.assert(void 0===g.getOdtDocument().getCursor(d),"Inserting local cursor a second time.");
var a=new ops.OpAddCursor;a.init({memberid:d});g.enqueue([a]);L.focus()};this.removeLocalCursor=function(){runtime.assert(void 0!==g.getOdtDocument().getCursor(d),"Removing local cursor without inserting before.");var a=new ops.OpRemoveCursor;a.init({memberid:d});g.enqueue([a])};this.startEditing=function(){ja.subscribe(gui.InputMethodEditor.signalCompositionStart,da.removeCurrentSelection);ja.subscribe(gui.InputMethodEditor.signalCompositionEnd,U);L.subscribe("beforecut",q);L.subscribe("cut",p);
L.subscribe("beforepaste",b);L.subscribe("paste",r);V&&V.initialize();L.setEditing(!0);ma.setModifier(ra?F.Meta:F.Ctrl);y.bind(G.Backspace,F.None,W(da.removeTextByBackspaceKey),!0);y.bind(G.Delete,F.None,da.removeTextByDeleteKey);y.bind(G.Tab,F.None,E(function(){da.insertText("\t");return!0}));ra?(y.bind(G.Clear,F.None,da.removeCurrentSelection),y.bind(G.B,F.Meta,E(ba.toggleBold)),y.bind(G.I,F.Meta,E(ba.toggleItalic)),y.bind(G.U,F.Meta,E(ba.toggleUnderline)),y.bind(G.L,F.MetaShift,E(ba.alignParagraphLeft)),
y.bind(G.E,F.MetaShift,E(ba.alignParagraphCenter)),y.bind(G.R,F.MetaShift,E(ba.alignParagraphRight)),y.bind(G.J,F.MetaShift,E(ba.alignParagraphJustified)),ia&&y.bind(G.C,F.MetaShift,$.addAnnotation),y.bind(G.Z,F.Meta,k),y.bind(G.Z,F.MetaShift,t)):(y.bind(G.B,F.Ctrl,E(ba.toggleBold)),y.bind(G.I,F.Ctrl,E(ba.toggleItalic)),y.bind(G.U,F.Ctrl,E(ba.toggleUnderline)),y.bind(G.L,F.CtrlShift,E(ba.alignParagraphLeft)),y.bind(G.E,F.CtrlShift,E(ba.alignParagraphCenter)),y.bind(G.R,F.CtrlShift,E(ba.alignParagraphRight)),
y.bind(G.J,F.CtrlShift,E(ba.alignParagraphJustified)),ia&&y.bind(G.C,F.CtrlAlt,$.addAnnotation),y.bind(G.Z,F.Ctrl,k),y.bind(G.Z,F.CtrlShift,t));P.setDefault(E(function(a){var b;b=null===a.which||void 0===a.which?String.fromCharCode(a.keyCode):0!==a.which&&0!==a.charCode?String.fromCharCode(a.which):null;return!b||a.altKey||a.ctrlKey||a.metaKey?!1:(da.insertText(b),!0)}));P.bind(G.Enter,F.None,E(da.enqueueParagraphSplittingOps))};this.endEditing=function(){ja.unsubscribe(gui.InputMethodEditor.signalCompositionStart,
da.removeCurrentSelection);ja.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,U);L.unsubscribe("cut",p);L.unsubscribe("beforecut",q);L.unsubscribe("paste",r);L.unsubscribe("beforepaste",b);L.setEditing(!1);ma.setModifier(F.None);y.bind(G.Backspace,F.None,function(){return!0},!0);y.unbind(G.Delete,F.None);y.unbind(G.Tab,F.None);ra?(y.unbind(G.Clear,F.None),y.unbind(G.B,F.Meta),y.unbind(G.I,F.Meta),y.unbind(G.U,F.Meta),y.unbind(G.L,F.MetaShift),y.unbind(G.E,F.MetaShift),y.unbind(G.R,F.MetaShift),
y.unbind(G.J,F.MetaShift),ia&&y.unbind(G.C,F.MetaShift),y.unbind(G.Z,F.Meta),y.unbind(G.Z,F.MetaShift)):(y.unbind(G.B,F.Ctrl),y.unbind(G.I,F.Ctrl),y.unbind(G.U,F.Ctrl),y.unbind(G.L,F.CtrlShift),y.unbind(G.E,F.CtrlShift),y.unbind(G.R,F.CtrlShift),y.unbind(G.J,F.CtrlShift),ia&&y.unbind(G.C,F.CtrlAlt),y.unbind(G.Z,F.Ctrl),y.unbind(G.Z,F.CtrlShift));P.setDefault(null);P.unbind(G.Enter,F.None)};this.getInputMemberId=function(){return d};this.getSession=function(){return g};this.getSessionConstraints=function(){return X};
this.setUndoManager=function(a){V&&V.unsubscribe(gui.UndoManager.signalUndoStackChanged,l);if(V=a)V.setDocument(B),V.setPlaybackFunction(g.enqueue),V.subscribe(gui.UndoManager.signalUndoStackChanged,l)};this.getUndoManager=function(){return V};this.getMetadataController=function(){return ta};this.getAnnotationController=function(){return $};this.getDirectFormattingController=function(){return ba};this.getHyperlinkClickHandler=function(){return ma};this.getHyperlinkController=function(){return ea};
this.getImageController=function(){return qa};this.getSelectionController=function(){return R};this.getTextController=function(){return da};this.getEventManager=function(){return L};this.getKeyboardHandlers=function(){return{keydown:y,keypress:P}};this.destroy=function(a){var b=[la.destroy,oa.destroy,ba.destroy,ja.destroy,L.destroy,ma.destroy,ea.destroy,ta.destroy,da.destroy,aa];sa&&b.unshift(sa.destroy);runtime.clearTimeout(Q);core.Async.destroyAll(b,a)};la=core.Task.createRedrawTask(x);oa=core.Task.createRedrawTask(function(){var a=
B.getCursor(d);if(a&&a.getSelectionType()===ops.OdtCursor.RegionSelection&&(a=Z.getImageElements(a.getSelectedRange())[0])){ka.select(a.parentNode);return}ka.clearSelection()});y.bind(G.Left,F.None,E(R.moveCursorToLeft));y.bind(G.Right,F.None,E(R.moveCursorToRight));y.bind(G.Up,F.None,E(R.moveCursorUp));y.bind(G.Down,F.None,E(R.moveCursorDown));y.bind(G.Left,F.Shift,E(R.extendSelectionToLeft));y.bind(G.Right,F.Shift,E(R.extendSelectionToRight));y.bind(G.Up,F.Shift,E(R.extendSelectionUp));y.bind(G.Down,
F.Shift,E(R.extendSelectionDown));y.bind(G.Home,F.None,E(R.moveCursorToLineStart));y.bind(G.End,F.None,E(R.moveCursorToLineEnd));y.bind(G.Home,F.Ctrl,E(R.moveCursorToDocumentStart));y.bind(G.End,F.Ctrl,E(R.moveCursorToDocumentEnd));y.bind(G.Home,F.Shift,E(R.extendSelectionToLineStart));y.bind(G.End,F.Shift,E(R.extendSelectionToLineEnd));y.bind(G.Up,F.CtrlShift,E(R.extendSelectionToParagraphStart));y.bind(G.Down,F.CtrlShift,E(R.extendSelectionToParagraphEnd));y.bind(G.Home,F.CtrlShift,E(R.extendSelectionToDocumentStart));
y.bind(G.End,F.CtrlShift,E(R.extendSelectionToDocumentEnd));ra?(y.bind(G.Left,F.Alt,E(R.moveCursorBeforeWord)),y.bind(G.Right,F.Alt,E(R.moveCursorPastWord)),y.bind(G.Left,F.Meta,E(R.moveCursorToLineStart)),y.bind(G.Right,F.Meta,E(R.moveCursorToLineEnd)),y.bind(G.Home,F.Meta,E(R.moveCursorToDocumentStart)),y.bind(G.End,F.Meta,E(R.moveCursorToDocumentEnd)),y.bind(G.Left,F.AltShift,E(R.extendSelectionBeforeWord)),y.bind(G.Right,F.AltShift,E(R.extendSelectionPastWord)),y.bind(G.Left,F.MetaShift,E(R.extendSelectionToLineStart)),
y.bind(G.Right,F.MetaShift,E(R.extendSelectionToLineEnd)),y.bind(G.Up,F.AltShift,E(R.extendSelectionToParagraphStart)),y.bind(G.Down,F.AltShift,E(R.extendSelectionToParagraphEnd)),y.bind(G.Up,F.MetaShift,E(R.extendSelectionToDocumentStart)),y.bind(G.Down,F.MetaShift,E(R.extendSelectionToDocumentEnd)),y.bind(G.A,F.Meta,E(R.extendSelectionToEntireDocument))):(y.bind(G.Left,F.Ctrl,E(R.moveCursorBeforeWord)),y.bind(G.Right,F.Ctrl,E(R.moveCursorPastWord)),y.bind(G.Left,F.CtrlShift,E(R.extendSelectionBeforeWord)),
y.bind(G.Right,F.CtrlShift,E(R.extendSelectionPastWord)),y.bind(G.A,F.Ctrl,E(R.extendSelectionToEntireDocument)));ua&&(sa=new gui.IOSSafariSupport(L));L.subscribe("keydown",y.handleEvent);L.subscribe("keypress",P.handleEvent);L.subscribe("keyup",M.handleEvent);L.subscribe("copy",n);L.subscribe("mousedown",v);L.subscribe("mousemove",la.trigger);L.subscribe("mouseup",H);L.subscribe("contextmenu",J);L.subscribe("dragstart",A);L.subscribe("dragend",K);L.subscribe("click",ma.handleClick);L.subscribe("longpress",
C);L.subscribe("drag",s);L.subscribe("dragstop",w);B.subscribe(ops.OdtDocument.signalOperationEnd,oa.trigger);B.subscribe(ops.Document.signalCursorAdded,ja.registerCursor);B.subscribe(ops.Document.signalCursorRemoved,ja.removeCursor);B.subscribe(ops.OdtDocument.signalOperationEnd,a)}})();gui.CaretManager=function(f){function g(b){return a.hasOwnProperty(b)?a[b]:null}function d(){return Object.keys(a).map(function(b){return a[b]})}function c(b){var c=a[b];c&&(delete a[b],b===f.getInputMemberId()&&f.getEventManager().unsubscribe("compositionupdate",c.handleUpdate),c.destroy(function(){}))}function e(a){a=a.getMemberId();a===f.getInputMemberId()&&(a=g(a))&&a.refreshCursorBlinking()}function m(){var a=g(f.getInputMemberId());t=!1;a&&a.ensureVisible()}function h(){var a=g(f.getInputMemberId());
a&&(a.handleUpdate(),t||(t=!0,k=runtime.setTimeout(m,50)))}function p(a){a.memberId===f.getInputMemberId()&&h()}function q(){var a=g(f.getInputMemberId());a&&a.setFocus()}function n(){var a=g(f.getInputMemberId());a&&a.removeFocus()}function r(){var a=g(f.getInputMemberId());a&&a.show()}function b(){var a=g(f.getInputMemberId());a&&a.hide()}var a={},l=runtime.getWindow(),k,t=!1;this.registerCursor=function(b,c,d){var e=b.getMemberId();c=new gui.Caret(b,c,d);d=f.getEventManager();a[e]=c;e===f.getInputMemberId()?
(runtime.log("Starting to track input on new cursor of "+e),b.subscribe(ops.OdtCursor.signalCursorUpdated,h),d.subscribe("compositionupdate",c.handleUpdate),c.setOverlayElement(d.getEventTrap())):b.subscribe(ops.OdtCursor.signalCursorUpdated,c.handleUpdate);return c};this.getCaret=g;this.getCarets=d;this.destroy=function(g){var h=f.getSession().getOdtDocument(),m=f.getEventManager(),t=d().map(function(a){return a.destroy});runtime.clearTimeout(k);h.unsubscribe(ops.OdtDocument.signalParagraphChanged,
p);h.unsubscribe(ops.Document.signalCursorMoved,e);h.unsubscribe(ops.Document.signalCursorRemoved,c);m.unsubscribe("focus",q);m.unsubscribe("blur",n);l.removeEventListener("focus",r,!1);l.removeEventListener("blur",b,!1);a={};core.Async.destroyAll(t,g)};(function(){var a=f.getSession().getOdtDocument(),d=f.getEventManager();a.subscribe(ops.OdtDocument.signalParagraphChanged,p);a.subscribe(ops.Document.signalCursorMoved,e);a.subscribe(ops.Document.signalCursorRemoved,c);d.subscribe("focus",q);d.subscribe("blur",
n);l.addEventListener("focus",r,!1);l.addEventListener("blur",b,!1)})()};gui.EditInfoHandle=function(f){var g=[],d,c=f.ownerDocument,e=c.documentElement.namespaceURI;this.setEdits=function(f){g=f;var h,p,q,n;d.innerHTML="";for(f=0;f<g.length;f+=1)h=c.createElementNS(e,"div"),h.className="editInfo",p=c.createElementNS(e,"span"),p.className="editInfoColor",p.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[f].memberid),q=c.createElementNS(e,"span"),q.className="editInfoAuthor",q.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[f].memberid),
n=c.createElementNS(e,"span"),n.className="editInfoTime",n.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g[f].memberid),n.innerHTML=g[f].time,h.appendChild(p),h.appendChild(q),h.appendChild(n),d.appendChild(h)};this.show=function(){d.style.display="block"};this.hide=function(){d.style.display="none"};this.destroy=function(c){f.removeChild(d);c()};d=c.createElementNS(e,"div");d.setAttribute("class","editInfoHandle");d.style.display="none";f.appendChild(d)};ops.EditInfo=function(f,g){function d(){var c=[],d;for(d in e)e.hasOwnProperty(d)&&c.push({memberid:d,time:e[d].time});c.sort(function(c,d){return c.time-d.time});return c}var c,e={};this.getNode=function(){return c};this.getOdtDocument=function(){return g};this.getEdits=function(){return e};this.getSortedEdits=function(){return d()};this.addEdit=function(c,d){e[c]={time:d}};this.clearEdits=function(){e={}};this.destroy=function(d){f.parentNode&&f.removeChild(c);d()};c=g.getDOMDocument().createElementNS("urn:webodf:names:editinfo",
"editinfo");f.insertBefore(c,f.firstChild)};gui.EditInfoMarker=function(f,g){function d(c,b){return runtime.setTimeout(function(){h.style.opacity=c},b)}var c=this,e,m,h,p,q,n;this.addEdit=function(c,b){var a=Date.now()-b;f.addEdit(c,b);m.setEdits(f.getSortedEdits());h.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",c);runtime.clearTimeout(q);runtime.clearTimeout(n);1E4>a?(p=d(1,0),q=d(0.5,1E4-a),n=d(0.2,2E4-a)):1E4<=a&&2E4>a?(p=d(0.5,0),n=d(0.2,2E4-a)):p=d(0.2,0)};this.getEdits=function(){return f.getEdits()};this.clearEdits=
function(){f.clearEdits();m.setEdits([]);h.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&h.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return f};this.show=function(){h.style.display="block"};this.hide=function(){c.hideHandle();h.style.display="none"};this.showHandle=function(){m.show()};this.hideHandle=function(){m.hide()};this.destroy=function(c){runtime.clearTimeout(p);runtime.clearTimeout(q);runtime.clearTimeout(n);e.removeChild(h);
m.destroy(function(b){b?c(b):f.destroy(c)})};(function(){var d=f.getOdtDocument().getDOMDocument();h=d.createElementNS(d.documentElement.namespaceURI,"div");h.setAttribute("class","editInfoMarker");h.onmouseover=function(){c.showHandle()};h.onmouseout=function(){c.hideHandle()};e=f.getNode();e.appendChild(h);m=new gui.EditInfoHandle(e);g||c.hide()})()};gui.HyperlinkTooltipView=function(f,g){var d=new core.DomUtils,c=new odf.OdfUtils,e=runtime.getWindow(),m,h,p;runtime.assert(null!==e,"Expected to be run in an environment which has a global window, like a browser.");this.showTooltip=function(q){var n=q.target||q.srcElement,r=f.getSizer(),b=f.getZoomLevel(),a;a:{for(;n;){if(c.isHyperlink(n))break a;if(c.isParagraph(n)||c.isInlineRoot(n))break;n=n.parentNode}n=null}if(n){d.containsNode(r,p)||r.appendChild(p);a=h;var l;switch(g()){case gui.KeyboardHandler.Modifier.Ctrl:l=
runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:l=runtime.tr("\u2318-click to follow link");break;default:l=""}a.textContent=l;m.textContent=c.getHyperlinkTarget(n);p.style.display="block";a=e.innerWidth-p.offsetWidth-15;n=q.clientX>a?a:q.clientX+15;a=e.innerHeight-p.offsetHeight-10;q=q.clientY>a?a:q.clientY+10;r=r.getBoundingClientRect();n=(n-r.left)/b;q=(q-r.top)/b;p.style.left=n+"px";p.style.top=q+"px"}};this.hideTooltip=function(){p.style.display="none"};this.destroy=
function(c){p.parentNode&&p.parentNode.removeChild(p);c()};(function(){var c=f.getElement().ownerDocument;m=c.createElement("span");h=c.createElement("span");m.className="webodf-hyperlinkTooltipLink";h.className="webodf-hyperlinkTooltipText";p=c.createElement("div");p.className="webodf-hyperlinkTooltip";p.appendChild(m);p.appendChild(h);f.getElement().appendChild(p)})()};gui.ShadowCursor=function(f){var g=f.getDOMDocument().createRange(),d=!0;this.removeFromDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return g};this.setSelectedRange=function(c,e){g=c;d=!1!==e};this.hasForwardSelection=function(){return d};this.getDocument=function(){return f};this.getSelectionType=function(){return ops.OdtCursor.RangeSelection};g.setStart(f.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";gui.SelectionView=function(f){};gui.SelectionView.prototype.rerender=function(){};gui.SelectionView.prototype.show=function(){};gui.SelectionView.prototype.hide=function(){};gui.SelectionView.prototype.destroy=function(f){};gui.SelectionViewManager=function(f){function g(){return Object.keys(d).map(function(c){return d[c]})}var d={};this.getSelectionView=function(c){return d.hasOwnProperty(c)?d[c]:null};this.getSelectionViews=g;this.removeSelectionView=function(c){d.hasOwnProperty(c)&&(d[c].destroy(function(){}),delete d[c])};this.hideSelectionView=function(c){d.hasOwnProperty(c)&&d[c].hide()};this.showSelectionView=function(c){d.hasOwnProperty(c)&&d[c].show()};this.rerenderSelectionViews=function(){Object.keys(d).forEach(function(c){d[c].rerender()})};
this.registerCursor=function(c,e){var g=c.getMemberId(),h=new f(c);e?h.show():h.hide();return d[g]=h};this.destroy=function(c){function d(g,p){p?c(p):g<f.length?f[g].destroy(function(c){d(g+1,c)}):c()}var f=g();d(0,void 0)}};gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};
(function(){gui.SessionView=function(f,g,d,c,e,m){function h(){var a=document.getElementsByTagName("head").item(0),b=document.createElement("style");b.type="text/css";b.media="screen, print, handheld, projection";a.appendChild(b);return b}function p(a,b,c){function d(b,c,e){c=b+'[editinfo|memberid="'+a+'"]'+e+c;a:{var f=s.firstChild;for(b=b+'[editinfo|memberid="'+a+'"]'+e+"{";f;){if(f.nodeType===Node.TEXT_NODE&&0===f.data.indexOf(b)){b=f;break a}f=f.nextSibling}b=null}b?b.data=c:s.appendChild(document.createTextNode(c))}
d("div.editInfoMarker","{ background-color: "+c+"; }","");d("span.editInfoColor","{ background-color: "+c+"; }","");d("span.editInfoAuthor",'{ content: "'+b+'"; }',":before");d("dc|creator","{ background-color: "+c+"; }","");d(".webodf-selectionOverlay","{ fill: "+c+"; stroke: "+c+";}","");a!==gui.ShadowCursor.ShadowCursorMemberId&&a!==g||d(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable")}function q(a){var b,c;for(c in v)v.hasOwnProperty(c)&&(b=v[c],a?
b.show():b.hide())}function n(a){e.getCarets().forEach(function(b){a?b.showHandle():b.hideHandle()})}function r(a){var b=a.getMemberId();a=a.getProperties();p(b,a.fullName,a.color);g===b&&p("","",a.color)}function b(a){var b=a.getMemberId(),c=d.getOdtDocument().getMember(b).getProperties();e.registerCursor(a,u,C);m.registerCursor(a,!0);if(a=e.getCaret(b))a.setAvatarImageUrl(c.imageUrl),a.setColor(c.color);runtime.log("+++ View here +++ eagerly created an Caret for '"+b+"'! +++")}function a(a){a=a.getMemberId();
var b=m.getSelectionView(g),c=m.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),d=e.getCaret(g);a===g?(c.hide(),b&&b.show(),d&&d.show()):a===gui.ShadowCursor.ShadowCursorMemberId&&(c.show(),b&&b.hide(),d&&d.hide())}function l(a){m.removeSelectionView(a)}function k(a){var b=a.paragraphElement,c=a.memberId;a=a.timeStamp;var e,f="",k=b.getElementsByTagNameNS(x,"editinfo").item(0);k?(f=k.getAttributeNS(x,"id"),e=v[f]):(f=Math.random().toString(),e=new ops.EditInfo(b,d.getOdtDocument()),e=new gui.EditInfoMarker(e,
z),k=b.getElementsByTagNameNS(x,"editinfo").item(0),k.setAttributeNS(x,"id",f),v[f]=e);e.addEdit(c,new Date(a))}function t(){var a;""!==w.innerHTML&&(w.innerHTML="");!0===c.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(a=d.getOdtDocument().getMember(g))&&(a=a.getProperties().fullName,w.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+a+"']) .annotationRemoveButton { display: none; }")))}var s,w,x="urn:webodf:names:editinfo",v={},z=void 0!==f.editInfoMarkersInitiallyVisible?
Boolean(f.editInfoMarkersInitiallyVisible):!0,u=void 0!==f.caretAvatarsInitiallyVisible?Boolean(f.caretAvatarsInitiallyVisible):!0,C=void 0!==f.caretBlinksOnRangeSelect?Boolean(f.caretBlinksOnRangeSelect):!0;this.showEditInfoMarkers=function(){z||(z=!0,q(z))};this.hideEditInfoMarkers=function(){z&&(z=!1,q(z))};this.showCaretAvatars=function(){u||(u=!0,n(u))};this.hideCaretAvatars=function(){u&&(u=!1,n(u))};this.getSession=function(){return d};this.getCaret=function(a){return e.getCaret(a)};this.destroy=
function(e){var f=d.getOdtDocument(),g=Object.keys(v).map(function(a){return v[a]});f.unsubscribe(ops.Document.signalMemberAdded,r);f.unsubscribe(ops.Document.signalMemberUpdated,r);f.unsubscribe(ops.Document.signalCursorAdded,b);f.unsubscribe(ops.Document.signalCursorRemoved,l);f.unsubscribe(ops.OdtDocument.signalParagraphChanged,k);f.unsubscribe(ops.Document.signalCursorMoved,a);f.unsubscribe(ops.OdtDocument.signalParagraphChanged,m.rerenderSelectionViews);f.unsubscribe(ops.OdtDocument.signalTableAdded,
m.rerenderSelectionViews);f.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,m.rerenderSelectionViews);c.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,t);f.unsubscribe(ops.Document.signalMemberAdded,t);f.unsubscribe(ops.Document.signalMemberUpdated,t);s.parentNode.removeChild(s);w.parentNode.removeChild(w);(function H(a,b){b?e(b):a<g.length?g[a].destroy(function(b){H(a+1,b)}):e()})(0,void 0)};(function(){var e=d.getOdtDocument();e.subscribe(ops.Document.signalMemberAdded,
r);e.subscribe(ops.Document.signalMemberUpdated,r);e.subscribe(ops.Document.signalCursorAdded,b);e.subscribe(ops.Document.signalCursorRemoved,l);e.subscribe(ops.OdtDocument.signalParagraphChanged,k);e.subscribe(ops.Document.signalCursorMoved,a);e.subscribe(ops.OdtDocument.signalParagraphChanged,m.rerenderSelectionViews);e.subscribe(ops.OdtDocument.signalTableAdded,m.rerenderSelectionViews);e.subscribe(ops.OdtDocument.signalParagraphStyleModified,m.rerenderSelectionViews);c.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,
t);e.subscribe(ops.Document.signalMemberAdded,t);e.subscribe(ops.Document.signalMemberUpdated,t);s=h();s.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));s.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));w=h();t()})()}})();gui.SvgSelectionView=function(f){function g(){var b=a.getRootNode();l!==b&&(l=b,k=a.getCanvas().getSizer(),k.appendChild(s),s.setAttribute("class","webodf-selectionOverlay"),x.setAttribute("class","webodf-draggable"),v.setAttribute("class","webodf-draggable"),x.setAttribute("end","left"),v.setAttribute("end","right"),x.setAttribute("r",8),v.setAttribute("r",8),s.appendChild(w),s.appendChild(x),s.appendChild(v))}function d(a){a=a.getBoundingClientRect();return Boolean(a&&0!==a.height)}function c(a){var b=
z.getTextElements(a,!0,!1),c=a.cloneRange(),e=a.cloneRange();a=a.cloneRange();if(!b.length)return null;var f;a:{f=0;var k=b[f],g=c.startContainer===k?c.startOffset:0,h=g;c.setStart(k,g);for(c.setEnd(k,h);!d(c);){if(k.nodeType===Node.ELEMENT_NODE&&h<k.childNodes.length)h=k.childNodes.length;else if(k.nodeType===Node.TEXT_NODE&&h<k.length)h+=1;else if(b[f])k=b[f],f+=1,g=h=0;else{f=!1;break a}c.setStart(k,g);c.setEnd(k,h)}f=!0}if(!f)return null;a:{f=b.length-1;k=b[f];h=g=e.endContainer===k?e.endOffset:
k.nodeType===Node.TEXT_NODE?k.length:k.childNodes.length;e.setStart(k,g);for(e.setEnd(k,h);!d(e);){if(k.nodeType===Node.ELEMENT_NODE&&0<g)g=0;else if(k.nodeType===Node.TEXT_NODE&&0<g)g-=1;else if(b[f])k=b[f],f-=1,g=h=k.length||k.childNodes.length;else{b=!1;break a}e.setStart(k,g);e.setEnd(k,h)}b=!0}if(!b)return null;a.setStart(c.startContainer,c.startOffset);a.setEnd(e.endContainer,e.endOffset);return{firstRange:c,lastRange:e,fillerRange:a}}function e(a,b){var c={};c.top=Math.min(a.top,b.top);c.left=
Math.min(a.left,b.left);c.right=Math.max(a.right,b.right);c.bottom=Math.max(a.bottom,b.bottom);c.width=c.right-c.left;c.height=c.bottom-c.top;return c}function m(a,b){b&&0<b.width&&0<b.height&&(a=a?e(a,b):b);return a}function h(b){function c(a){A.setUnfilteredPosition(a,0);return v.acceptNode(a)===K&&s.acceptPosition(A)===K?K:J}function d(a){var b=null;c(a)===K&&(b=u.getBoundingClientRect(a));return b}var e=b.commonAncestorContainer,f=b.startContainer,k=b.endContainer,g=b.startOffset,h=b.endOffset,
l,n,p=null,r,q=t.createRange(),s,v=new odf.OdfNodeFilter,w;if(f===e||k===e)return q=b.cloneRange(),p=q.getBoundingClientRect(),q.detach(),p;for(b=f;b.parentNode!==e;)b=b.parentNode;for(n=k;n.parentNode!==e;)n=n.parentNode;s=a.createRootFilter(f);for(e=b.nextSibling;e&&e!==n;)r=d(e),p=m(p,r),e=e.nextSibling;if(z.isParagraph(b))p=m(p,u.getBoundingClientRect(b));else if(b.nodeType===Node.TEXT_NODE)e=b,q.setStart(e,g),q.setEnd(e,e===n?h:e.length),r=q.getBoundingClientRect(),p=m(p,r);else for(w=t.createTreeWalker(b,
NodeFilter.SHOW_TEXT,c,!1),e=w.currentNode=f;e&&e!==k;)q.setStart(e,g),q.setEnd(e,e.length),r=q.getBoundingClientRect(),p=m(p,r),l=e,g=0,e=w.nextNode();l||(l=f);if(z.isParagraph(n))p=m(p,u.getBoundingClientRect(n));else if(n.nodeType===Node.TEXT_NODE)e=n,q.setStart(e,e===b?g:0),q.setEnd(e,h),r=q.getBoundingClientRect(),p=m(p,r);else for(w=t.createTreeWalker(n,NodeFilter.SHOW_TEXT,c,!1),e=w.currentNode=k;e&&e!==l;)if(q.setStart(e,0),q.setEnd(e,h),r=q.getBoundingClientRect(),p=m(p,r),e=w.previousNode())h=
e.length;return p}function p(a,b){var c=a.getBoundingClientRect(),d={width:0};d.top=c.top;d.bottom=c.bottom;d.height=c.height;d.left=d.right=b?c.right:c.left;return d}function q(){var a=f.getSelectedRange(),b;if(b=I&&f.getSelectionType()===ops.OdtCursor.RangeSelection&&!a.collapsed){g();var d=u.getBoundingClientRect(k),l=C.getZoomLevel(),a=c(a),m,n,r,q,t,A;if(a){b=a.firstRange;m=a.lastRange;n=a.fillerRange;r=u.translateRect(p(b,!1),d,l);t=u.translateRect(p(m,!0),d,l);q=(q=h(n))?u.translateRect(q,
d,l):e(r,t);A=q.left;q=r.left+Math.max(0,q.width-(r.left-q.left));d=Math.min(r.top,t.top);l=t.top+t.height;A=[{x:r.left,y:d+r.height},{x:r.left,y:d},{x:q,y:d},{x:q,y:l-t.height},{x:t.right,y:l-t.height},{x:t.right,y:l},{x:A,y:l},{x:A,y:d+r.height},{x:r.left,y:d+r.height}];q="";var z;for(z=0;z<A.length;z+=1)q+=A[z].x+","+A[z].y+" ";w.setAttribute("points",q);x.setAttribute("cx",r.left);x.setAttribute("cy",d+r.height/2);v.setAttribute("cx",t.right);v.setAttribute("cy",l-t.height/2);b.detach();m.detach();
n.detach()}b=Boolean(a)}s.style.display=b?"block":"none"}function n(a){I&&a===f&&H.trigger()}function r(a){a=8/a;x.setAttribute("r",a);v.setAttribute("r",a)}function b(a){k.removeChild(s);k.classList.remove("webodf-virtualSelections");f.getDocument().unsubscribe(ops.Document.signalCursorMoved,n);C.unsubscribe(gui.ZoomHelper.signalZoomChanged,r);a()}var a=f.getDocument(),l,k,t=a.getDOMDocument(),s=t.createElementNS("http://www.w3.org/2000/svg","svg"),w=t.createElementNS("http://www.w3.org/2000/svg",
"polygon"),x=t.createElementNS("http://www.w3.org/2000/svg","circle"),v=t.createElementNS("http://www.w3.org/2000/svg","circle"),z=new odf.OdfUtils,u=new core.DomUtils,C=a.getCanvas().getZoomHelper(),I=!0,A=gui.SelectionMover.createPositionIterator(a.getRootNode()),K=NodeFilter.FILTER_ACCEPT,J=NodeFilter.FILTER_REJECT,H;this.rerender=function(){I&&H.trigger()};this.show=function(){I=!0;H.trigger()};this.hide=function(){I=!1;H.trigger()};this.destroy=function(a){core.Async.destroyAll([H.destroy,b],
a)};(function(){var a=f.getMemberId();H=core.Task.createRedrawTask(q);g();s.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",a);k.classList.add("webodf-virtualSelections");f.getDocument().subscribe(ops.Document.signalCursorMoved,n);C.subscribe(gui.ZoomHelper.signalZoomChanged,r);r(C.getZoomLevel())})()};gui.UndoStateRules=function(){function f(c,d){var f=c.length;this.previous=function(){for(f-=1;0<=f;f-=1)if(d(c[f]))return c[f];return null}}function g(c){c=c.spec();var d;c.hasOwnProperty("position")&&(d=c.position);return d}function d(c){return c.isEdit}function c(c,d,f){if(!f)return f=g(c)-g(d),0===f||1===Math.abs(f);c=g(c);d=g(d);f=g(f);return c-d===d-f}this.isEditOperation=d;this.isPartOfOperationSet=function(e,g){var h=void 0!==e.group,p;if(!e.isEdit||0===g.length)return!0;p=g[g.length-1];if(h&&
e.group===p.group)return!0;a:switch(e.spec().optype){case "RemoveText":case "InsertText":p=!0;break a;default:p=!1}if(p&&g.some(d)){if(h){var q;h=e.spec().optype;p=new f(g,d);var n=p.previous(),r=null,b,a;runtime.assert(Boolean(n),"No edit operations found in state");a=n.group;runtime.assert(void 0!==a,"Operation has no group");for(b=1;n&&n.group===a;){if(h===n.spec().optype){q=n;break}n=p.previous()}if(q){for(n=p.previous();n;){if(n.group!==a){if(2===b)break;a=n.group;b+=1}if(h===n.spec().optype){r=
n;break}n=p.previous()}q=c(e,q,r)}else q=!1;return q}q=e.spec().optype;h=new f(g,d);p=h.previous();runtime.assert(Boolean(p),"No edit operations found in state");q=q===p.spec().optype?c(e,p,h.previous()):!1;return q}return!1}};gui.TrivialUndoManager=function(f){function g(a){0<a.length&&(z=!0,l(a),z=!1)}function d(){x.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:q.hasUndoStates(),redoAvailable:q.hasRedoStates()})}function c(){t!==a&&t!==s[s.length-1]&&s.push(t)}function e(a){var b=a.previousSibling||a.nextSibling;a.parentNode.removeChild(a);r.normalizeTextNodes(b)}function m(a){return Object.keys(a).map(function(b){return a[b]})}function h(a){function b(a){var k=a.spec();if(e[k.memberid])switch(k.optype){case "AddCursor":c[k.memberid]||
(c[k.memberid]=a,delete e[k.memberid],f-=1);break;case "MoveCursor":d[k.memberid]||(d[k.memberid]=a)}}var c={},d={},e={},f,g=a.pop();k.getMemberIds().forEach(function(a){e[a]=!0});for(f=Object.keys(e).length;g&&0<f;)g.reverse(),g.forEach(b),g=a.pop();return m(c).concat(m(d))}function p(){var f=b=k.cloneDocumentElement();r.getElementsByTagNameNS(f,n,"cursor").forEach(e);r.getElementsByTagNameNS(f,n,"anchor").forEach(e);c();t=a=h([a].concat(s));s.length=0;w.length=0;d()}var q=this,n="urn:webodf:names:cursor",
r=new core.DomUtils,b,a=[],l,k,t=[],s=[],w=[],x=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.TrivialUndoManager.signalDocumentRootReplaced]),v=f||new gui.UndoStateRules,z=!1;this.subscribe=function(a,b){x.subscribe(a,b)};this.unsubscribe=function(a,b){x.unsubscribe(a,b)};this.hasUndoStates=function(){return 0<s.length};this.hasRedoStates=function(){return 0<w.length};this.setDocument=function(a){k=
a};this.purgeInitialState=function(){s.length=0;w.length=0;a.length=0;t.length=0;b=null;d()};this.setInitialState=p;this.initialize=function(){b||p()};this.setPlaybackFunction=function(a){l=a};this.onOperationExecuted=function(b){z||(v.isEditOperation(b)&&(t===a||0<w.length)||!v.isPartOfOperationSet(b,t)?(w.length=0,c(),t=[b],s.push(t),x.emit(gui.UndoManager.signalUndoStateCreated,{operations:t}),d()):(t.push(b),x.emit(gui.UndoManager.signalUndoStateModified,{operations:t})))};this.moveForward=function(a){for(var b=
0,c;a&&w.length;)c=w.pop(),s.push(c),g(c),a-=1,b+=1;b&&(t=s[s.length-1],d());return b};this.moveBackward=function(c){for(var e=0;c&&s.length;)w.push(s.pop()),c-=1,e+=1;e&&(k.getMemberIds().forEach(function(a){k.removeCursor(a)}),k.setDocumentElement(b.cloneNode(!0)),x.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),g(a),s.forEach(g),t=s[s.length-1]||a,d());return e}};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced";odf.LazyStyleProperties=function(f,g){var d={};this.value=function(c){var e;d.hasOwnProperty(c)?e=d[c]:(e=g[c](),void 0===e&&f&&(e=f.value(c)),d[c]=e);return e};this.reset=function(c){f=c;d={}}};
odf.StyleParseUtils=function(){function f(d){var c,e;d=(d=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(d))?{value:parseFloat(d[1]),unit:d[3]}:null;e=d&&d.unit;"px"===e?c=d.value:"cm"===e?c=96*(d.value/2.54):"mm"===e?c=96*(d.value/25.4):"in"===e?c=96*d.value:"pt"===e?c=d.value/0.75:"pc"===e&&(c=16*d.value);return c}var g=odf.Namespaces.stylens;this.parseLength=f;this.parsePositiveLengthOrPercent=function(d,c,e){var g;d&&(g=parseFloat(d.substr(0,
d.indexOf("%"))),isNaN(g)&&(g=void 0));var h;void 0!==g?(e&&(h=e.value(c)),g=void 0===h?void 0:g*(h/100)):g=f(d);return g};this.getPropertiesElement=function(d,c,e){for(c=e?e.nextElementSibling:c.firstElementChild;null!==c&&(c.localName!==d||c.namespaceURI!==g);)c=c.nextElementSibling;return c}};odf.GraphicProperties=function(f,g,d){var c=this,e=odf.Namespaces.stylens,m=odf.Namespaces.svgns;this.verticalPos=function(){return c.data.value("verticalPos")};this.verticalRel=function(){return c.data.value("verticalRel")};this.horizontalPos=function(){return c.data.value("horizontalPos")};this.horizontalRel=function(){return c.data.value("horizontalRel")};this.strokeWidth=function(){return c.data.value("strokeWidth")};c.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{verticalPos:function(){var c=
f.getAttributeNS(e,"vertical-pos");return""===c?void 0:c},verticalRel:function(){var c=f.getAttributeNS(e,"vertical-rel");return""===c?void 0:c},horizontalPos:function(){var c=f.getAttributeNS(e,"horizontal-pos");return""===c?void 0:c},horizontalRel:function(){var c=f.getAttributeNS(e,"horizontal-rel");return""===c?void 0:c},strokeWidth:function(){var c=f.getAttributeNS(m,"stroke-width");return g.parseLength(c)}})};
odf.ComputedGraphicProperties=function(){var f;this.setGraphicProperties=function(g){f=g};this.verticalPos=function(){return f&&f.verticalPos()||"from-top"};this.verticalRel=function(){return f&&f.verticalRel()||"page"};this.horizontalPos=function(){return f&&f.horizontalPos()||"from-left"};this.horizontalRel=function(){return f&&f.horizontalRel()||"page"}};odf.PageLayoutProperties=function(f,g,d){var c=this,e=odf.Namespaces.fons;this.pageHeight=function(){return c.data.value("pageHeight")||1123};this.pageWidth=function(){return c.data.value("pageWidth")||794};c.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{pageHeight:function(){var c;f&&(c=f.getAttributeNS(e,"page-height"),c=g.parseLength(c));return c},pageWidth:function(){var c;f&&(c=f.getAttributeNS(e,"page-width"),c=g.parseLength(c));return c}})};
odf.PageLayout=function(f,g,d){var c=null;f&&(c=g.getPropertiesElement("page-layout-properties",f));this.pageLayout=new odf.PageLayoutProperties(c,g,d&&d.pageLayout)};odf.PageLayoutCache=function(){};odf.PageLayoutCache.prototype.getPageLayout=function(f){};odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){};odf.ParagraphProperties=function(f,g,d){var c=this,e=odf.Namespaces.fons;this.marginTop=function(){return c.data.value("marginTop")};c.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{marginTop:function(){var c=f.getAttributeNS(e,"margin-top");return g.parsePositiveLengthOrPercent(c,"marginTop",d&&d.data)}})};
odf.ComputedParagraphProperties=function(){var f={},g=[];this.setStyleChain=function(d){g=d;f={}};this.marginTop=function(){var d,c;if(f.hasOwnProperty("marginTop"))d=f.marginTop;else{for(c=0;void 0===d&&c<g.length;c+=1)d=g[c].marginTop();f.marginTop=d}return d||0}};odf.TextProperties=function(f,g,d){var c=this,e=odf.Namespaces.fons;this.fontSize=function(){return c.data.value("fontSize")};c.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{fontSize:function(){var c=f.getAttributeNS(e,"font-size");return g.parsePositiveLengthOrPercent(c,"fontSize",d&&d.data)}})};
odf.ComputedTextProperties=function(){var f={},g=[];this.setStyleChain=function(d){g=d;f={}};this.fontSize=function(){var d,c;if(f.hasOwnProperty("fontSize"))d=f.fontSize;else{for(c=0;void 0===d&&c<g.length;c+=1)d=g[c].fontSize();f.fontSize=d}return d||12}};odf.MasterPage=function(f,g){var d;f?(d=f.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=g.getPageLayout(d)):this.pageLayout=g.getDefaultPageLayout()};odf.MasterPageCache=function(){};odf.MasterPageCache.prototype.getMasterPage=function(f){};
odf.StylePileEntry=function(f,g,d,c){this.masterPage=function(){var c=f.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),g=null;c&&(g=d.getMasterPage(c));return g};(function(d){var m=f.getAttributeNS(odf.Namespaces.stylens,"family"),h=null;if("graphic"===m||"chart"===m)d.graphic=void 0===c?void 0:c.graphic,h=g.getPropertiesElement("graphic-properties",f,h),null!==h&&(d.graphic=new odf.GraphicProperties(h,g,d.graphic));if("paragraph"===m||"table-cell"===m||"graphic"===m||"presentation"===
m||"chart"===m)d.paragraph=void 0===c?void 0:c.paragraph,h=g.getPropertiesElement("paragraph-properties",f,h),null!==h&&(d.paragraph=new odf.ParagraphProperties(h,g,d.paragraph));if("text"===m||"paragraph"===m||"table-cell"===m||"graphic"===m||"presentation"===m||"chart"===m)d.text=void 0===c?void 0:c.text,h=g.getPropertiesElement("text-properties",f,h),null!==h&&(d.text=new odf.TextProperties(h,g,d.text))})(this)};
odf.StylePile=function(f,g){function d(d,b){var a,e;d.hasAttributeNS(c,"parent-style-name")&&(e=d.getAttributeNS(c,"parent-style-name"),-1===b.indexOf(e)&&(a=n(e,b)));return new odf.StylePileEntry(d,f,g,a)}var c=odf.Namespaces.stylens,e={},m={},h,p={},q={},n;n=function(c,b){var a=p[c],f;!a&&(f=e[c])&&(b.push(c),a=d(f,b),p[c]=a);return a};this.getStyle=function(c){var b=q[c]||p[c],a,f=[];b||(a=m[c],a||(a=e[c])&&f.push(c),a&&(b=d(a,f)));return b};this.addCommonStyle=function(d){var b;d.hasAttributeNS(c,
"name")&&(b=d.getAttributeNS(c,"name"),e.hasOwnProperty(b)||(e[b]=d))};this.addAutomaticStyle=function(d){var b;d.hasAttributeNS(c,"name")&&(b=d.getAttributeNS(c,"name"),m.hasOwnProperty(b)||(m[b]=d))};this.setDefaultStyle=function(c){void 0===h&&(h=d(c,[]))};this.getDefaultStyle=function(){return h}};odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties;this.graphic=new odf.ComputedGraphicProperties};
odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties};odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties};
odf.StyleCache=function(f){function g(a,b,c,d){b=c.getAttributeNS(b,"class-names");var e;if(b)for(b=b.split(" "),e=0;e<b.length;e+=1)if(c=b[e])d.push(a),d.push(c)}function d(a,b){var c=s.getStyleName("paragraph",a);void 0!==c&&(b.push("paragraph"),b.push(c));a.namespaceURI!==k||"h"!==a.localName&&"p"!==a.localName||g("paragraph",k,a,b);return b}function c(a,b,c){var d=[],e,f,g,k;for(e=0;e<a.length;e+=2)g=a[e],k=a[e+1],g=p[g],k=g.getStyle(k),void 0!==k&&(k=k[b],void 0!==k&&k!==f&&(d.push(k),f=k));
g=p[c];if(k=g.getDefaultStyle())k=k[b],void 0!==k&&k!==f&&d.push(k);return d}function e(a,b){var c=s.getStyleName("text",a),h=a.parentElement;void 0!==c&&(b.push("text"),b.push(c));"span"===a.localName&&a.namespaceURI===k&&g("text",k,a,b);if(!h||h===f)return b;h.namespaceURI!==k||"p"!==h.localName&&"h"!==h.localName?e(h,b):d(h,b);return b}function m(a){a=a.getAttributeNS(t,"family");return p[a]}var h=this,p,q,n,r,b,a,l,k=odf.Namespaces.textns,t=odf.Namespaces.stylens,s=new odf.StyleInfo,w=new odf.StyleParseUtils,
x,v,z,u,C,I;this.getComputedGraphicStyle=function(a){var b=[];a=s.getStyleName("graphic",a);void 0!==a&&(b.push("graphic"),b.push(a));a=b.join("/");var d=r[a];runtime.assert(0===b.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedGraphicStyle,d.graphic.setGraphicProperties(c(b,"graphic","graphic")[0]),d.text.setStyleChain(c(b,"text","graphic")),d.paragraph.setStyleChain(c(b,"paragraph","graphic")),r[a]=d);return d};this.getComputedParagraphStyle=function(a){a=d(a,[]);var b=a.join("/"),
e=n[b];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===e&&(e=new odf.ComputedParagraphStyle,e.text.setStyleChain(c(a,"text","paragraph")),e.paragraph.setStyleChain(c(a,"paragraph","paragraph")),n[b]=e);return e};this.getComputedTextStyle=function(a){a=e(a,[]);var b=a.join("/"),d=q[b];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedTextStyle,d.text.setStyleChain(c(a,"text","text")),q[b]=d);return d};this.getPageLayout=function(a){var b=I[a];b||((b=
C[a])?(b=new odf.PageLayout(b,w,u),I[a]=b):b=u);return b};this.getDefaultPageLayout=function(){return u};this.getMasterPage=function(a){var b=v[a];void 0===b&&((b=x[a])?(b=new odf.MasterPage(b,h),v[a]=b):b=null);return b};this.getDefaultMasterPage=function(){return z};this.update=function(){var c,d,e=null,k=null;q={};n={};r={};x={};v={};I={};C={};b=new odf.StylePile(w,h);a=new odf.StylePile(w,h);l=new odf.StylePile(w,h);p={text:b,paragraph:a,graphic:l};for(c=f.styles.firstElementChild;c;)c.namespaceURI===
t&&((d=m(c))?"style"===c.localName?d.addCommonStyle(c):"default-style"===c.localName&&d.setDefaultStyle(c):"default-page-layout"===c.localName&&(e=c)),c=c.nextElementSibling;u=new odf.PageLayout(e,w);for(c=f.automaticStyles.firstElementChild;c;)c.namespaceURI===t&&((d=m(c))&&"style"===c.localName?d.addAutomaticStyle(c):"page-layout"===c.localName&&(C[c.getAttributeNS(t,"name")]=c)),c=c.nextElementSibling;for(c=f.masterStyles.firstElementChild;c;)c.namespaceURI===t&&"master-page"===c.localName&&(k=
k||c,d=c,e=d.getAttributeNS(t,"name"),0<e.length&&!x.hasOwnProperty(e)&&(x[e]=d)),c=c.nextElementSibling;z=new odf.MasterPage(k,h)}};ops.OperationTransformMatrix=function(){function f(b){b.position+=b.length;b.length*=-1}function g(b){var a=0>b.length;a&&f(b);return a}function d(b,a){function c(e){b[e]===a&&d.push(e)}var d=[];b&&["style:parent-style-name","style:next-style-name"].forEach(c);return d}function c(b,a){function c(d){b[d]===a&&delete b[d]}b&&["style:parent-style-name","style:next-style-name"].forEach(c)}function e(b){var a={};Object.keys(b).forEach(function(c){a[c]="object"===typeof b[c]?e(b[c]):b[c]});return a}function m(b,
a,c,d){var e,f=!1,g=!1,h,m=[];d&&d.attributes&&(m=d.attributes.split(","));b&&(c||0<m.length)&&Object.keys(b).forEach(function(a){var d=b[a],e;"object"!==typeof d&&(c&&(e=c[a]),void 0!==e?(delete b[a],g=!0,e===d&&(delete c[a],f=!0)):-1!==m.indexOf(a)&&(delete b[a],g=!0))});if(a&&a.attributes&&(c||0<m.length)){h=a.attributes.split(",");for(d=0;d<h.length;d+=1)if(e=h[d],c&&void 0!==c[e]||m&&-1!==m.indexOf(e))h.splice(d,1),d-=1,g=!0;0<h.length?a.attributes=h.join(","):delete a.attributes}return{majorChanged:f,
minorChanged:g}}function h(b){for(var a in b)if(b.hasOwnProperty(a))return!0;return!1}function p(b){for(var a in b)if(b.hasOwnProperty(a)&&("attributes"!==a||0<b.attributes.length))return!0;return!1}function q(b,a,c,d,e){var f=b?b[e]:null,g=a?a[e]:null,n=c?c[e]:null,q=d?d[e]:null,r;r=m(f,g,n,q);f&&!h(f)&&delete b[e];g&&!p(g)&&delete a[e];n&&!h(n)&&delete c[e];q&&!p(q)&&delete d[e];return r}function n(b,a){return{opSpecsA:[b],opSpecsB:[a]}}var r;r={AddCursor:{AddCursor:n,AddMember:n,AddStyle:n,ApplyDirectStyling:n,
InsertText:n,MergeParagraph:n,MoveCursor:n,RemoveCursor:n,RemoveMember:n,RemoveStyle:n,RemoveText:n,SetParagraphStyle:n,SplitParagraph:n,UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},AddMember:{AddStyle:n,InsertText:n,MergeParagraph:n,MoveCursor:n,RemoveCursor:n,RemoveStyle:n,RemoveText:n,SetParagraphStyle:n,SplitParagraph:n,UpdateMetadata:n,UpdateParagraphStyle:n},AddStyle:{AddStyle:n,ApplyDirectStyling:n,InsertText:n,MergeParagraph:n,MoveCursor:n,RemoveCursor:n,RemoveMember:n,RemoveStyle:function(b,
a){var e,f=[b],g=[a];b.styleFamily===a.styleFamily&&(e=d(b.setProperties,a.styleName),0<e.length&&(e={optype:"UpdateParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,styleName:b.styleName,removedProperties:{attributes:e.join(",")}},g.unshift(e)),c(b.setProperties,a.styleName));return{opSpecsA:f,opSpecsB:g}},RemoveText:n,SetParagraphStyle:n,SplitParagraph:n,UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},ApplyDirectStyling:{ApplyDirectStyling:function(b,a,c){var d,f,g,m,n,p,r,u;m=[b];
g=[a];if(!(b.position+b.length<=a.position||b.position>=a.position+a.length)){d=c?b:a;f=c?a:b;if(b.position!==a.position||b.length!==a.length)p=e(d),r=e(f);a=q(f.setProperties,null,d.setProperties,null,"style:text-properties");if(a.majorChanged||a.minorChanged)g=[],b=[],m=d.position+d.length,n=f.position+f.length,f.position<d.position?a.minorChanged&&(u=e(r),u.length=d.position-f.position,b.push(u),f.position=d.position,f.length=n-f.position):d.position<f.position&&a.majorChanged&&(u=e(p),u.length=
f.position-d.position,g.push(u),d.position=f.position,d.length=m-d.position),n>m?a.minorChanged&&(p=r,p.position=m,p.length=n-m,b.push(p),f.length=m-f.position):m>n&&a.majorChanged&&(p.position=n,p.length=m-n,g.push(p),d.length=n-d.position),d.setProperties&&h(d.setProperties)&&g.push(d),f.setProperties&&h(f.setProperties)&&b.push(f),c?(m=g,g=b):m=b}return{opSpecsA:m,opSpecsB:g}},InsertText:function(b,a){a.position<=b.position?b.position+=a.text.length:a.position<=b.position+b.length&&(b.length+=
a.text.length);return{opSpecsA:[b],opSpecsB:[a]}},MergeParagraph:function(b,a){var c=b.position,d=b.position+b.length;c>=a.sourceStartPosition&&(c-=1);d>=a.sourceStartPosition&&(d-=1);b.position=c;b.length=d-c;return{opSpecsA:[b],opSpecsB:[a]}},MoveCursor:n,RemoveCursor:n,RemoveStyle:n,RemoveText:function(b,a){var c=b.position+b.length,d=a.position+a.length,e=[b],f=[a];d<=b.position?b.position-=a.length:a.position<c&&(b.position<a.position?b.length=d<c?b.length-a.length:a.position-b.position:(b.position=
a.position,d<c?b.length=c-d:e=[]));return{opSpecsA:e,opSpecsB:f}},SetParagraphStyle:n,SplitParagraph:function(b,a){a.position<b.position?b.position+=1:a.position<b.position+b.length&&(b.length+=1);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMetadata:n,UpdateParagraphStyle:n},InsertText:{InsertText:function(b,a,c){b.position<a.position?a.position+=b.text.length:b.position>a.position?b.position+=a.text.length:c?a.position+=b.text.length:b.position+=a.text.length;return{opSpecsA:[b],opSpecsB:[a]}},MergeParagraph:function(b,
a){b.position>=a.sourceStartPosition?b.position-=1:(b.position<a.sourceStartPosition&&(a.sourceStartPosition+=b.text.length),b.position<a.destinationStartPosition&&(a.destinationStartPosition+=b.text.length));return{opSpecsA:[b],opSpecsB:[a]}},MoveCursor:function(b,a){var c=g(a);b.position<a.position?a.position+=b.text.length:b.position<a.position+a.length&&(a.length+=b.text.length);c&&f(a);return{opSpecsA:[b],opSpecsB:[a]}},RemoveCursor:n,RemoveMember:n,RemoveStyle:n,RemoveText:function(b,a){var c;
c=a.position+a.length;var d=[b],e=[a];c<=b.position?b.position-=a.length:b.position<=a.position?a.position+=b.text.length:(a.length=b.position-a.position,c={optype:"RemoveText",memberid:a.memberid,timestamp:a.timestamp,position:b.position+b.text.length,length:c-b.position},e.unshift(c),b.position=a.position);return{opSpecsA:d,opSpecsB:e}},SplitParagraph:function(b,a){b.position<a.sourceParagraphPosition&&(a.sourceParagraphPosition+=b.text.length);b.position<=a.position?a.position+=b.text.length:b.position+=
1;return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},MergeParagraph:{MergeParagraph:function(b,a,c){var d=[b],e=[a],f;b.destinationStartPosition===a.destinationStartPosition?(d=[],e=[],b.moveCursor&&(f={optype:"MoveCursor",memberid:b.memberid,timestamp:b.timestamp,position:b.sourceStartPosition-1},d.push(f)),a.moveCursor&&(f={optype:"MoveCursor",memberid:a.memberid,timestamp:a.timestamp,position:a.sourceStartPosition-1},e.push(f)),b=c?b:a,b={optype:"SetParagraphStyle",
memberid:b.memberid,timestamp:b.timestamp,position:b.destinationStartPosition,styleName:b.paragraphStyleName},c?d.push(b):e.push(b)):b.destinationStartPosition<a.destinationStartPosition?(a.destinationStartPosition-=1,a.sourceStartPosition-=1):(b.destinationStartPosition-=1,b.sourceStartPosition-=1);return{opSpecsA:d,opSpecsB:e}},MoveCursor:function(b,a){var c=a.position,d=a.position+a.length,e=Math.min(c,d),c=Math.max(c,d);e>=b.sourceStartPosition&&(e-=1);c>=b.sourceStartPosition&&(c-=1);0<=a.length?
(a.position=e,a.length=c-e):(a.position=c,a.length=e-c);return{opSpecsA:[b],opSpecsB:[a]}},RemoveCursor:n,RemoveMember:n,RemoveStyle:n,RemoveText:function(b,a){a.position>=b.sourceStartPosition?a.position-=1:(a.position<b.destinationStartPosition&&(b.destinationStartPosition-=a.length),a.position<b.sourceStartPosition&&(b.sourceStartPosition-=a.length));return{opSpecsA:[b],opSpecsB:[a]}},SetParagraphStyle:function(b,a){var c=[b],d=[a];if(a.position>b.sourceStartPosition)a.position-=1;else if(a.position===
b.destinationStartPosition||a.position===b.sourceStartPosition)a.position=b.destinationStartPosition,b.paragraphStyleName=a.styleName;return{opSpecsA:c,opSpecsB:d}},SplitParagraph:function(b,a){var c,d=[b],e=[a];a.position<b.destinationStartPosition?(b.destinationStartPosition+=1,b.sourceStartPosition+=1):a.position>=b.destinationStartPosition&&a.position<b.sourceStartPosition?(a.paragraphStyleName=b.paragraphStyleName,c={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,position:b.destinationStartPosition,
styleName:b.paragraphStyleName},d.push(c),a.position===b.sourceStartPosition-1&&b.moveCursor&&(c={optype:"MoveCursor",memberid:b.memberid,timestamp:b.timestamp,position:a.position,length:0},d.push(c)),b.destinationStartPosition=a.position+1,b.sourceStartPosition+=1):a.position>=b.sourceStartPosition&&(a.position-=1,a.sourceParagraphPosition-=1);return{opSpecsA:d,opSpecsB:e}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},MoveCursor:{MoveCursor:n,RemoveCursor:function(b,a){return{opSpecsA:b.memberid===
a.memberid?[]:[b],opSpecsB:[a]}},RemoveMember:n,RemoveStyle:n,RemoveText:function(b,a){var c=g(b),d=b.position+b.length,e=a.position+a.length;e<=b.position?b.position-=a.length:a.position<d&&(b.position<a.position?b.length=e<d?b.length-a.length:a.position-b.position:(b.position=a.position,b.length=e<d?d-e:0));c&&f(b);return{opSpecsA:[b],opSpecsB:[a]}},SetParagraphStyle:n,SplitParagraph:function(b,a){var c=g(b);a.position<b.position?b.position+=1:a.position<b.position+b.length&&(b.length+=1);c&&f(b);
return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},RemoveCursor:{RemoveCursor:function(b,a){var c=b.memberid===a.memberid;return{opSpecsA:c?[]:[b],opSpecsB:c?[]:[a]}},RemoveMember:n,RemoveStyle:n,RemoveText:n,SetParagraphStyle:n,SplitParagraph:n,UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},RemoveMember:{RemoveStyle:n,RemoveText:n,SetParagraphStyle:n,SplitParagraph:n,UpdateMetadata:n,UpdateParagraphStyle:n},RemoveStyle:{RemoveStyle:function(b,a){var c=
b.styleName===a.styleName&&b.styleFamily===a.styleFamily;return{opSpecsA:c?[]:[b],opSpecsB:c?[]:[a]}},RemoveText:n,SetParagraphStyle:function(b,a){var c,d=[b],e=[a];"paragraph"===b.styleFamily&&b.styleName===a.styleName&&(c={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,position:a.position,styleName:""},d.unshift(c),a.styleName="");return{opSpecsA:d,opSpecsB:e}},SplitParagraph:n,UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:function(b,a){var e,f=[b],g=[a];"paragraph"===
b.styleFamily&&(e=d(a.setProperties,b.styleName),0<e.length&&(e={optype:"UpdateParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,styleName:a.styleName,removedProperties:{attributes:e.join(",")}},f.unshift(e)),b.styleName===a.styleName?g=[]:c(a.setProperties,b.styleName));return{opSpecsA:f,opSpecsB:g}}},RemoveText:{RemoveText:function(b,a){var c=b.position+b.length,d=a.position+a.length,e=[b],f=[a];d<=b.position?b.position-=a.length:c<=a.position?a.position-=b.length:a.position<c&&(b.position<
a.position?(b.length=d<c?b.length-a.length:a.position-b.position,c<d?(a.position=b.position,a.length=d-c):f=[]):(c<d?a.length-=b.length:a.position<b.position?a.length=b.position-a.position:f=[],d<c?(b.position=a.position,b.length=c-d):e=[]));return{opSpecsA:e,opSpecsB:f}},SplitParagraph:function(b,a){var c=b.position+b.length,d=[b],e=[a];a.position<=b.position?b.position+=1:a.position<c&&(b.length=a.position-b.position,c={optype:"RemoveText",memberid:b.memberid,timestamp:b.timestamp,position:a.position+
1,length:c-a.position},d.unshift(c));b.position+b.length<=a.position?a.position-=b.length:b.position<a.position&&(a.position=b.position);b.position+b.length<a.sourceParagraphPosition&&(a.sourceParagraphPosition-=b.length);return{opSpecsA:d,opSpecsB:e}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},SetParagraphStyle:{SplitParagraph:function(b,a){var c=[b],d=[a],f;b.position>a.position?b.position+=1:b.position===a.sourceParagraphPosition&&(a.paragraphStyleName=b.styleName,f=e(b),f.position=
a.position+1,c.push(f));return{opSpecsA:c,opSpecsB:d}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},SplitParagraph:{SplitParagraph:function(b,a,c){var d,e;b.position<a.position?d=!0:a.position<b.position?e=!0:b.position===a.position&&(c?d=!0:e=!0);d?(a.position+=1,a.sourceParagraphPosition=b.position<a.sourceParagraphPosition?a.sourceParagraphPosition+1:b.position+1):e&&(b.position+=1,b.sourceParagraphPosition=a.position<a.sourceParagraphPosition?b.sourceParagraphPosition+1:a.position+
1);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},UpdateMember:{UpdateMetadata:n,UpdateParagraphStyle:n},UpdateMetadata:{UpdateMetadata:function(b,a,c){var d,e=[b],f=[a];d=c?b:a;b=c?a:b;m(b.setProperties||null,b.removedProperties||null,d.setProperties||null,d.removedProperties||null);d.setProperties&&h(d.setProperties)||d.removedProperties&&p(d.removedProperties)||(c?e=[]:f=[]);b.setProperties&&h(b.setProperties)||b.removedProperties&&p(b.removedProperties)||
(c?f=[]:e=[]);return{opSpecsA:e,opSpecsB:f}},UpdateParagraphStyle:n},UpdateParagraphStyle:{UpdateParagraphStyle:function(b,a,c){var d,e=[b],f=[a];b.styleName===a.styleName&&(d=c?b:a,b=c?a:b,q(b.setProperties,b.removedProperties,d.setProperties,d.removedProperties,"style:paragraph-properties"),q(b.setProperties,b.removedProperties,d.setProperties,d.removedProperties,"style:text-properties"),m(b.setProperties||null,b.removedProperties||null,d.setProperties||null,d.removedProperties||null),d.setProperties&&
h(d.setProperties)||d.removedProperties&&p(d.removedProperties)||(c?e=[]:f=[]),b.setProperties&&h(b.setProperties)||b.removedProperties&&p(b.removedProperties)||(c?f=[]:e=[]));return{opSpecsA:e,opSpecsB:f}}}};this.passUnchanged=n;this.extendTransformations=function(b){Object.keys(b).forEach(function(a){var c=b[a],d,e=r.hasOwnProperty(a);runtime.log((e?"Extending":"Adding")+" map for optypeA: "+a);e||(r[a]={});d=r[a];Object.keys(c).forEach(function(b){var e=d.hasOwnProperty(b);runtime.assert(a<=b,
"Wrong order:"+a+", "+b);runtime.log("  "+(e?"Overwriting":"Adding")+" entry for optypeB: "+b);d[b]=c[b]})})};this.transformOpspecVsOpspec=function(b,a){var c=b.optype<=a.optype,d;runtime.log("Crosstransforming:");runtime.log(runtime.toJson(b));runtime.log(runtime.toJson(a));c||(d=b,b=a,a=d);(d=(d=r[b.optype])&&d[a.optype])?(d=d(b,a,!c),c||null===d||(d={opSpecsA:d.opSpecsB,opSpecsB:d.opSpecsA})):d=null;runtime.log("result:");d?(runtime.log(runtime.toJson(d.opSpecsA)),runtime.log(runtime.toJson(d.opSpecsB))):
runtime.log("null");return d}};ops.OperationTransformer=function(){function f(d,c){for(var e,m,h=[],p=[];0<d.length&&c;){e=d.shift();e=g.transformOpspecVsOpspec(e,c);if(!e)return null;h=h.concat(e.opSpecsA);if(0===e.opSpecsB.length){h=h.concat(d);c=null;break}for(;1<e.opSpecsB.length;){m=f(d,e.opSpecsB.shift());if(!m)return null;p=p.concat(m.opSpecsB);d=m.opSpecsA}c=e.opSpecsB.pop()}c&&p.push(c);return{opSpecsA:h,opSpecsB:p}}var g=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return g};this.transform=
function(d,c){for(var e,g=[];0<c.length;){e=f(d,c.shift());if(!e)return null;d=e.opSpecsA;g=g.concat(e.opSpecsB)}return{opSpecsA:d,opSpecsB:g}}};var webodf_css="/**\n * Copyright (C) 2010-2014 KO GmbH <copyright@kogmbh.com>\n *\n * @licstart\n * This file is part of WebODF.\n *\n * WebODF is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License (GNU AGPL)\n * as published by the Free Software Foundation, either version 3 of\n * the License, or (at your option) any later version.\n *\n * WebODF is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with WebODF.  If not, see <http://www.gnu.org/licenses/>.\n * @licend\n *\n * @source: http://www.webodf.org/\n * @source: https://github.com/kogmbh/WebODF/\n */\n\n@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);\n@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);\n@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);\n@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);\n@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);\n@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);\n@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);\n@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);\n@namespace webodfhelper url(urn:webodf:names:helper);\n@namespace cursor url(urn:webodf:names:cursor);\n@namespace editinfo url(urn:webodf:names:editinfo);\n@namespace annotation url(urn:webodf:names:annotation);\n@namespace dc url(http://purl.org/dc/elements/1.1/);\n@namespace svgns url(http://www.w3.org/2000/svg);\n\noffice|document > *, office|document-content > * {\n  display: none;\n}\noffice|body, office|document {\n  display: inline-block;\n  position: relative;\n}\n\ntext|p, text|h {\n  display: block;\n  padding: 0;\n  margin: 0;\n  line-height: normal;\n  position: relative;\n  min-height: 1.3em; /* prevent empty paragraphs and headings from collapsing if they are empty */\n}\n*[webodfhelper|containsparagraphanchor] {\n  position: relative;\n}\ntext|s {\n    white-space: pre;\n}\ntext|tab {\n  display: inline;\n  white-space: pre;\n}\ntext|tracked-changes {\n  /*Consumers that do not support change tracking, should ignore changes.*/\n  display: none;\n}\noffice|binary-data {\n  display: none;\n}\noffice|text {\n  display: block;\n  text-align: left;\n  overflow: visible;\n  word-wrap: break-word;\n}\n\noffice|text::selection {\n  /** Let's not draw selection highlight that overflows into the office|text\n   * node when selecting content across several paragraphs\n   */\n  background: transparent;\n}\n\n.webodf-virtualSelections *::selection {\n  background: transparent;\n}\n.webodf-virtualSelections *::-moz-selection {\n  background: transparent;\n}\n\noffice|text * draw|text-box {\n/** only for text documents */\n    display: block;\n    border: 1px solid #d3d3d3;\n}\noffice|text draw|frame {\n  /** make sure frames are above the main text. */\n  z-index: 1;\n}\noffice|spreadsheet {\n  display: block;\n  border-collapse: collapse;\n  empty-cells: show;\n  font-family: sans-serif;\n  font-size: 10pt;\n  text-align: left;\n  page-break-inside: avoid;\n  overflow: hidden;\n}\noffice|presentation {\n  display: inline-block;\n  text-align: left;\n}\n#shadowContent {\n  display: inline-block;\n  text-align: left;\n}\ndraw|page {\n  display: block;\n  position: relative;\n  overflow: hidden;\n}\npresentation|notes, presentation|footer-decl, presentation|date-time-decl {\n    display: none;\n}\n@media print {\n  draw|page {\n    border: 1pt solid black;\n    page-break-inside: avoid;\n  }\n  presentation|notes {\n    /*TODO*/\n  }\n}\noffice|spreadsheet text|p {\n  border: 0px;\n  padding: 1px;\n  margin: 0px;\n}\noffice|spreadsheet table|table {\n  margin: 3px;\n}\noffice|spreadsheet table|table:after {\n  /* show sheet name the end of the sheet */\n  /*content: attr(table|name);*/ /* gives parsing error in opera */\n}\noffice|spreadsheet table|table-row {\n  counter-increment: row;\n}\noffice|spreadsheet table|table-row:before {\n  width: 3em;\n  background: #cccccc;\n  border: 1px solid black;\n  text-align: center;\n  content: counter(row);\n  display: table-cell;\n}\noffice|spreadsheet table|table-cell {\n  border: 1px solid #cccccc;\n}\ntable|table {\n  display: table;\n}\ndraw|frame table|table {\n  width: 100%;\n  height: 100%;\n  background: white;\n}\ntable|table-header-rows {\n  display: table-header-group;\n}\ntable|table-row {\n  display: table-row;\n}\ntable|table-column {\n  display: table-column;\n}\ntable|table-cell {\n  width: 0.889in;\n  display: table-cell;\n  word-break: break-all; /* prevent long words from extending out the table cell */\n}\ndraw|frame {\n  display: block;\n}\ndraw|image {\n  display: block;\n  width: 100%;\n  height: 100%;\n  top: 0px;\n  left: 0px;\n  background-repeat: no-repeat;\n  background-size: 100% 100%;\n  -moz-background-size: 100% 100%;\n  background-color: #CCC;\n}\n/* only show the first image in frame */\ndraw|frame > draw|image:nth-of-type(n+2) {\n  display: none;\n}\ntext|list:before {\n    display: none;\n    content:\"\";\n}\ntext|list {\n    display: block;\n    counter-reset: list;\n}\ntext|list-item {\n    display: block;\n}\ntext|number {\n    display:none;\n}\n\ntext|a {\n    color: blue;\n    text-decoration: underline;\n    cursor: pointer;\n}\n.webodf-inactiveLinks text|a {\n    cursor: text;\n}\ntext|note-citation {\n    vertical-align: super;\n    font-size: smaller;\n}\ntext|note-body {\n    display: none;\n}\ntext|note:hover text|note-citation {\n    background: #dddddd;\n}\ntext|note:hover text|note-body {\n    display: block;\n    left:1em;\n    max-width: 80%;\n    position: absolute;\n    background: #ffffaa;\n}\ntext|bibliography-source {\n  display: none;\n}\nsvg|title, svg|desc {\n    display: none;\n}\nvideo {\n    width: 100%;\n    height: 100%\n}\n\n/* below set up the cursor */\ncursor|anchor {\n    display: none;\n}\n\ncursor|cursor {\n    display: none;\n}\n\n.webodf-caretOverlay {\n    position: absolute;\n    top: 5%; /* push down the caret; 0px can do the job, 5% looks better, 10% is a bit over */\n    height: 1em;\n    margin-left: -1px;\n    z-index: 10;\n    pointer-events: none;\n}\n\n.webodf-caretOverlay .caret {\n    position: absolute;\n    border-left: 2px solid black;\n    top: 0;\n    bottom: 0;\n}\n\n.webodf-caretOverlay .handle {\n    margin-top: 5px;\n    padding-top: 3px;\n    margin-left: auto;\n    margin-right: auto;\n    width: 64px !important;\n    height: 68px !important;\n    border-radius: 5px;\n    opacity: 0.3;\n    text-align: center;\n    background-color: black !important;\n    box-shadow: 0px 0px 5px rgb(90, 90, 90);\n    border: 1px solid black;\n\n    top: -85px !important;\n    left: -32px !important;\n}\n\n.webodf-caretOverlay .handle > img {\n    box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;\n    background-color: rgb(200, 200, 200);\n    border-radius: 5px;\n    border: 2px solid;\n    height: 60px !important;\n    width: 60px !important;\n    display: block;\n    margin: auto;\n}\n\n.webodf-caretOverlay .handle.active {\n    opacity: 0.8;\n}\n\n.webodf-caretOverlay .handle:after {\n    content: ' ';\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: black transparent transparent transparent;\n\n    top: 100%;\n    left: 43%;\n}\n\n.webodf-caretSizer {\n    display: inline-block; /* inline-block is necessary so the width can be set to 0 */\n    width: 0; /* the caret sizer shouldn't take up any horizontal space */\n    visibility: hidden; /* \"hidden\" means the client rects are still calculated, but the node content is not shown */\n}\n\n/** Input Method Editor input pane & behaviours */\n/* not within a cursor */\n#eventTrap {\n    height: auto;\n    display: block;\n    position: absolute;\n    bottom: 0;\n    right: 0;\n    width: 1px;\n    outline: none;\n    opacity: 0;\n    color: rgba(255, 255, 255, 0); /* hide the blinking caret by setting the colour to fully transparent */\n    overflow: hidden; /* The overflow visibility is used to hide and show characters being entered */\n    pointer-events: none;\n}\n\n/* within a cursor */\ncursor|cursor > #composer {\n    text-decoration: underline;\n}\n\ncursor|cursor[cursor|caret-sizer-active=\"true\"],\ncursor|cursor[cursor|composing=\"true\"] {\n    display: inline;\n}\n\neditinfo|editinfo {\n    /* Empty or invisible display:inline elements respond very badly to mouse selection.\n       Inline blocks are much more reliably selectable in Chrome & friends */\n    display: inline-block;\n}\n\n.editInfoMarker {\n    position: absolute;\n    width: 10px;\n    height: 100%;\n    left: -20px;\n    opacity: 0.8;\n    top: 0;\n    border-radius: 5px;\n    background-color: transparent;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n}\n.editInfoMarker:hover {\n    box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);\n}\n\n.editInfoHandle {\n    position: absolute;\n    background-color: black;\n    padding: 5px;\n    border-radius: 5px;\n    opacity: 0.8;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    bottom: 100%;\n    margin-bottom: 10px;\n    z-index: 3;\n    left: -25px;\n}\n.editInfoHandle:after {\n    content: ' ';\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: black transparent transparent transparent;\n\n    top: 100%;\n    left: 5px;\n}\n.editInfo {\n    font-family: sans-serif;\n    font-weight: normal;\n    font-style: normal;\n    text-decoration: none;\n    color: white;\n    width: 100%;\n    height: 12pt;\n}\n.editInfoColor {\n    float: left;\n    width: 10pt;\n    height: 10pt;\n    border: 1px solid white;\n}\n.editInfoAuthor {\n    float: left;\n    margin-left: 5pt;\n    font-size: 10pt;\n    text-align: left;\n    height: 12pt;\n    line-height: 12pt;\n}\n.editInfoTime {\n    float: right;\n    margin-left: 30pt;\n    font-size: 8pt;\n    font-style: italic;\n    color: yellow;\n    height: 12pt;\n    line-height: 12pt;\n}\n\n.annotationWrapper {\n    display: inline;\n    position: relative;\n}\n\n.annotationRemoveButton:before {\n    content: '\u00d7';\n    color: white;\n    padding: 5px;\n    line-height: 1em;\n}\n\n.annotationRemoveButton {\n    width: 20px;\n    height: 20px;\n    border-radius: 10px;\n    background-color: black;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    position: absolute;\n    top: -10px;\n    left: -10px;\n    z-index: 3;\n    text-align: center;\n    font-family: sans-serif;\n    font-style: normal;\n    font-weight: normal;\n    text-decoration: none;\n    font-size: 15px;\n}\n.annotationRemoveButton:hover {\n    cursor: pointer;\n    box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);\n}\n\n.annotationNote {\n    width: 4cm;\n    position: absolute;\n    display: inline;\n    z-index: 10;\n    top: 0;\n}\n.annotationNote > office|annotation {\n    display: block;\n    text-align: left;\n}\n\n.annotationConnector {\n    position: absolute;\n    display: inline;\n    top: 0;\n    z-index: 2;\n    border-top: 1px dashed brown;\n}\n.annotationConnector.angular {\n    -moz-transform-origin: left top;\n    -webkit-transform-origin: left top;\n    -ms-transform-origin: left top;\n    transform-origin: left top;\n}\n.annotationConnector.horizontal {\n    left: 0;\n}\n.annotationConnector.horizontal:before {\n    content: '';\n    display: inline;\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: brown transparent transparent transparent;\n    top: -1px;\n    left: -5px;\n}\n\noffice|annotation {\n    width: 100%;\n    height: 100%;\n    display: none;\n    background: rgb(198, 238, 184);\n    background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    box-shadow: 0 3px 4px -3px #ccc;\n}\n\noffice|annotation > dc|creator {\n    display: block;\n    font-size: 10pt;\n    font-weight: normal;\n    font-style: normal;\n    font-family: sans-serif;\n    color: white;\n    background-color: brown;\n    padding: 4px;\n}\noffice|annotation > dc|date {\n    display: block;\n    font-size: 10pt;\n    font-weight: normal;\n    font-style: normal;\n    font-family: sans-serif;\n    border: 4px solid transparent;\n    color: black;\n}\noffice|annotation > text|list {\n    display: block;\n    padding: 5px;\n}\n\n/* This is very temporary CSS. This must go once\n * we start bundling webodf-default ODF styles for annotations.\n */\noffice|annotation text|p {\n    font-size: 10pt;\n    color: black;\n    font-weight: normal;\n    font-style: normal;\n    text-decoration: none;\n    font-family: sans-serif;\n}\n\n#annotationsPane {\n    background-color: #EAEAEA;\n    width: 4cm;\n    height: 100%;\n    display: none;\n    position: absolute;\n    outline: 1px solid #ccc;\n}\n\n.webodf-annotationHighlight {\n    background-color: yellow;\n    position: relative;\n}\n\n.webodf-selectionOverlay {\n    position: absolute;\n    pointer-events: none;\n    top: 0;\n    left: 0;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 15;\n}\n.webodf-selectionOverlay > polygon {\n    fill-opacity: 0.3;\n    stroke-opacity: 0.8;\n    stroke-width: 1;\n    fill-rule: evenodd;\n}\n\n.webodf-selectionOverlay > .webodf-draggable {\n    fill-opacity: 0.8;\n    stroke-opacity: 0;\n    stroke-width: 8;\n    pointer-events: all;\n    display: none;\n\n    -moz-transform-origin: center center;\n    -webkit-transform-origin: center center;\n    -ms-transform-origin: center center;\n    transform-origin: center center;\n}\n\n#imageSelector {\n    display: none;\n    position: absolute;\n    border-style: solid;\n    border-color: black;\n}\n\n#imageSelector > div {\n    width: 5px;\n    height: 5px;\n    display: block;\n    position: absolute;\n    border: 1px solid black;\n    background-color: #ffffff;\n}\n\n#imageSelector > .topLeft {\n    top: -4px;\n    left: -4px;\n}\n\n#imageSelector > .topRight {\n    top: -4px;\n    right: -4px;\n}\n\n#imageSelector > .bottomRight {\n    right: -4px;\n    bottom: -4px;\n}\n\n#imageSelector > .bottomLeft {\n    bottom: -4px;\n    left: -4px;\n}\n\n#imageSelector > .topMiddle {\n    top: -4px;\n    left: 50%;\n    margin-left: -2.5px; /* half of the width defined in #imageSelector > div */\n}\n\n#imageSelector > .rightMiddle {\n    top: 50%;\n    right: -4px;\n    margin-top: -2.5px; /* half of the height defined in #imageSelector > div */\n}\n\n#imageSelector > .bottomMiddle {\n    bottom: -4px;\n    left: 50%;\n    margin-left: -2.5px; /* half of the width defined in #imageSelector > div */\n}\n\n#imageSelector > .leftMiddle {\n    top: 50%;\n    left: -4px;\n    margin-top: -2.5px; /* half of the height defined in #imageSelector > div */\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar\n{\n    width: 8px;\n    height: 8px;\n    background-color: transparent;\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar-track\n{\n    background-color: transparent;\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar-thumb\n{\n    background-color: #444;\n    border-radius: 4px;\n}\n\n.webodf-hyperlinkTooltip {\n    display: none;\n    color: white;\n    background-color: black;\n    border-radius: 5px;\n    box-shadow: 2px 2px 5px gray;\n    padding: 3px;\n    position: absolute;\n    max-width: 210px;\n    text-align: left;\n    word-break: break-all;\n    z-index: 16;\n}\n\n.webodf-hyperlinkTooltipText {\n    display: block;\n    font-weight: bold;\n}\n";
